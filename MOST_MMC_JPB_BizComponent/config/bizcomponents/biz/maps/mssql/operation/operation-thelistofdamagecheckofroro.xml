<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="theListOfDamageCheckOfRORO">
	<resultMap 	id="resultComboList" 	type="theListOfDamageCheckOfROROItem">
   		<result property = "cd"			column = "CD"/>
   		<result property = "cdNm"		column = "CD_NM"/>
 	</resultMap>
 	

 	<resultMap 	id="resultRoRoDamageCheckMap" type="theListOfDamageCheckOfROROItem">
   		<result property = "vslCallId"		column = "VSL_CALL_ID"/>
   		<result property = "vslCd"			column = "VSL_CD"/>
   		<result property = "callSeq"		column = "CALL_SEQ"/>
   		<result property = "callYear"		column = "CALL_YEAR"/>
		<result property = "docNo" 			column = "MF_DOC_ID"/>
		<result property = "delvTpNm" 		column = "DELV_TP_CD"/>
		<result property = "statNm" 		column = "STAT_CD"/>
		<result property = "locId"			column = "PLAN_LOC_ID"/>
		<result property = "cgNo" 			column = "CG_NO"/>
		<result property = "ixCd" 			column = "IX_CD"/>
		<result property = "ixNm" 			column = "IX_NM"/>
		<result property = "brandCd" 		column = "BRAND_CD"/>
		<result property = "brandNm" 		column = "BRAND_NM"/>
		<result property = "modelCd" 		column = "MODEL_CD"/>
		<result property = "modelNm" 		column = "MODEL_NM"/>
		<result property = "unitNo" 		column = "CHAS_NO"/>
		<result property = "checkedDt" 		column = "CHK_DT"/>
		<result property = "checkedBy" 		column = "UPD_BY"/>
		<result property = "cgTpCd" 		column = "CG_TP_CD"/>
		<result property = "cgTpNm" 		column = "CG_TP_NM"/>
		<result property = "catgCd" 		column = "CATG_CD"/>
		<result property = "catgNm" 		column = "CATG_NM"/>
		<result property = "shaCd" 			column = "SHIPG_AGENT"/>
		<result property = "shaNm" 			column = "SHA_NM"/>
		<result property = "fwdCd" 			column = "FWRD"/>
		<result property = "fwdNm" 			column = "FWD_NM"/>
		<result property = "remark" 		column = "RMK"/>
		<result property = "dmgDetailCount" column = "DMG_DETAIL_COUNT"/>
		<result property = "invDetailCount" column = "INV_DETAIL_COUNT"/>
 	</resultMap>
 	
 	<resultMap 	id="resultCargoPopupMap" type="theListOfDamageCheckOfROROItem">
   		<result property = "vslCallId"		column = "VSL_CALL_ID"/>
		<result property = "catgCd" 		column = "CATG_CD"/>
		<result property = "catgNm" 		column = "CATG_NM"/>
		<result property = "docNo" 			column = "MF_DOC_ID"/>
		<result property = "cgNo" 			column = "CG_NO"/>
		<result property = "brandCd" 		column = "BRAND_CD"/>
		<result property = "brandNm" 		column = "BRAND_NM"/>
		<result property = "modelCd" 		column = "MODEL_CD"/>
		<result property = "modelNm" 		column = "MODEL_NM"/>
		<result property = "cgTpCd" 		column = "CG_TP_CD"/>
		<result property = "cgTpNm" 		column = "CG_TP_NM"/>
		<result property = "ixCd" 			column = "IX_CD"/>
		
 	</resultMap>
 	
 	<resultMap 	id="resultUnitPopupMap" type="theListOfDamageCheckOfROROItem">
   		<result property = "vslCallId"		column = "VSL_CALL_ID"/>
   		<result property = "vslCd"			column = "VSL_CD"/>
   		<result property = "callSeq"		column = "CALL_SEQ"/>
   		<result property = "callYear"		column = "CALL_YEAR"/>
		<result property = "catgCd" 		column = "CATG_CD"/>
		<result property = "docNo" 			column = "MF_DOC_ID"/>
		<result property = "cgNo" 			column = "CG_NO"/>
		<result property = "unitNo" 		column = "CHAS_NO"/>
		<result property = "brandCd" 		column = "BRAND_CD"/>
		<result property = "brandNm" 		column = "BRAND_NM"/>
		<result property = "modelCd" 		column = "MODEL_CD"/>
		<result property = "modelNm" 		column = "MODEL_NM"/>
		<result property = "statNm" 		column = "STAT_CD"/>
		<result property = "cgTpCd" 		column = "CG_TP_CD"/>
		<result property = "inDate" 		column = "IN_DTM"/>
		<result property = "yardLoc" 		column = "LOC_ID"/>
		<result property = "ixCd" 			column = "IX_CD"/>
 	</resultMap>
 	
 	<resultMap 	id="resultRoRoDmgDtlInvMap" type="theListOfDamageCheckOfROROItem">
   		<result property = "invCd"			column = "S_CD"/>
		<result property = "invNm" 			column = "S_CD_NM"/>
		<result property = "invDesc" 		column = "S_CD_DESC"/>
		<result property = "invCnt" 		column = "INV_CNT"/>
		<!-- <result property = "cdNum" 			column = "S_CD_ST"/> -->
		<result property = "remark" 		column = "S_CD_RMK"/>
 	</resultMap>
 	
 	<resultMap 	id="resultRoRoDmgDtlDmgMap" type="theListOfDamageCheckOfROROItem">
   		<result property = "vslCallId"		column = "VSL_CALL_ID"/>
		<result property = "catgCd" 		column = "CATG_CD"/>
		<result property = "docNo" 			column = "MF_DOC_ID"/>
		<result property = "cgNo" 			column = "CG_NO"/>
		<result property = "unitNo" 		column = "CHAS_NO"/>
		<result property = "brandCd" 		column = "BRAND_CD"/>
		<result property = "brandNm" 		column = "BRAND_NM"/>
		<result property = "modelCd" 		column = "MODEL_CD"/>
		<result property = "modelNm" 		column = "MODEL_NM"/>
		<result property = "dmgPart" 		column = "DMG_PART"/>
		<result property = "dmgPartNm" 		column = "DMG_PART_NM"/>
		<result property = "dmgLevel" 		column = "DMG_LEVEL"/>
		<result property = "dmgLevelNm" 	column = "DMG_LEVEL_NM"/>
		<result property = "remark" 		column = "RMK"/>
		<result property = "ixCd" 			column = "IX_CD"/>
		<result property = "locCd" 			column = "CHK_LOC"/>
		<result property = "locNm" 			column = "CHK_LOC_NM"/>
		<result property = "dmgDetailCount" column = "DETAIL_COUNT"/>
 	</resultMap>
 	
	<select id="selectBlComboBoxItems" parameterType="theListOfDamageCheckOfROROParm" resultMap="resultComboList">
		SELECT	/* RoRoDamageCheck.getBlComboBoxItems */
			DISTINCT
			BL_NO CD,
			BL_NO CD_NM
		FROM	
			TMT_BL
		WHERE
			VSL_CALL_ID = #{vslCallId}
			AND CG_TP_CD IN ('RCV')
	</select>
	
	<select id="selectCategoryComboBoxItems" parameterType="theListOfDamageCheckOfROROParm" resultMap="resultComboList">
		SELECT	/* RoRoDamageCheck.getBlComboBoxItems */
			DISTINCT
			S_CD CD,
			S_CD_NM CD_NM
		FROM	
			TMT_CD_MSTD
		WHERE
			M_CD = 'CATGTP'
	</select>
	
	<select id="selectShipgNoteNoComboBoxItems" parameterType="theListOfDamageCheckOfROROParm" resultMap="resultComboList">
		SELECT	/* RoRoDamageCheck.getSNComboBoxItems */
			DISTINCT
			SHIPG_NOTE_NO CD,
			SHIPG_NOTE_NO CD_NM
		FROM	
			TMT_SHIPG_NOTE
		WHERE
			VSL_CALL_ID = #{vslCallId}
			AND STAT_CD = 'AP'
			AND CG_TP_CD IN ('RCV')
			
			 <choose>
				<when test="vslCallId == 'STRG'">
					<if test="estArrvFromDt != null and estArrvFromDt != ''">
						AND EST_ARRV_DT BETWEEN CONVERT(DATETIME, #{estArrvFromDt},103) AND CONVERT(DATETIME, #{estArrvToDt},103)
					</if>
				</when>
			</choose>
	</select>
	<select id="selectRoRoDamageCheckItems" parameterType="theListOfDamageCheckOfROROParm" resultMap="resultRoRoDamageCheckMap">
	 	<if test="pageNo != 0"> 
			SELECT /* RoRoDamageCheck.selectRoRoDamageCheckItems */
				* 
			FROM 
				(SELECT 
					inner_querry.*, ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) row_num 
				FROM ( 
		</if>
				<include refid="getRoRoDamageCheckListItems"/>
		<if test="pageNo != 0"> 
				)inner_querry 
			)inner_querry 
			WHERE 
				inner_querry.row_num <![CDATA[>]]> (CASE WHEN #{pageNo} = '0' THEN 1 ELSE CAST(#{pageNo} AS INT) END - 1) * CAST(#{sizePerPage} AS INT)
				AND inner_querry.row_num <![CDATA[<=]]> CASE WHEN #{pageNo} = '0' THEN 1 ELSE CAST(#{pageNo} AS INT) END * CAST(#{sizePerPage} AS INT)
		</if>
	 </select>
	 <select id="selectRoRoDamageCheckItemsCount" parameterType="theListOfDamageCheckOfROROParm" resultType="java.lang.String">
	 	SELECT  /* RoRoDamageCheck.selectRoRoDamageCheckItemsCount */
			COUNT(*)
		FROM 
			(<include refid="getRoRoDamageCheckListItems"/>) AS getRoRoDamageCheckListItems
	 </select>
	<sql id="getRoRoDamageCheckListItems">
		SELECT	/* RoRoDamageCheck.getRoRoDamageCheckListItems */
			DISTINCT
			DC.VSL_CALL_ID,
			R.VSL_CD,
			R.CALL_SEQ,
			R.CALL_YEAR,
			R.MF_DOC_ID,
			R.CG_NO,
			R.CATG_CD,
			DC.IX_CD,
			DBO.F_CM_CODE_NM('MT', 'IXCD', DC.IX_CD) 	AS IX_NM,
			DBO.F_CM_CODE_NM('MT', 'CATGTP', R.CATG_CD) AS CATG_NM,
			BR.BRAND_CD,
			BR.BRAND_NM,
			MD.MODEL_CD,
			MD.MODEL_NM,
			DC.CHAS_NO,
			FORMAT(DC.CHK_DT, 'dd/MM/yyyy HH:mm:ss') 	AS CHK_DT,
			DC.STAFF_CD	 								AS UPD_BY,
			R.CG_TP_CD,
			DBO.F_CM_CODE_NM('MT', 'CGTP', R.CG_TP_CD) 	AS CG_TP_NM,
			CASE     
				WHEN DC.IX_CD = 'I'
					THEN (SELECT TOP(1)
							*
						FROM 
							(SELECT 
								BL.FWRD 
							FROM 
								TMT_BL BL 
							WHERE 
								BL.VSL_CALL_ID = DC.VSL_CALL_ID 
								AND BL.BL_NO = R.CG_NO) AS sub_query)
				ELSE (SELECT TOP(1)
						* 
					FROM 
						(SELECT 
							SN.FWRD 
						FROM 
							TMT_SHIPG_NOTE SN 
						WHERE 
							SN.VSL_CALL_ID = DC.VSL_CALL_ID 
							AND SN.SHIPG_NOTE_NO = R.CG_NO) AS sub_query)
			END 										AS FWRD,
			CASE     
				WHEN DC.IX_CD = 'I'
					THEN (
						SELECT TOP(1) 
							DBO.F_GET_PARTNER_INFO(BL.FWRD, 'ENG_SNM') AS Eng_SNM
						FROM 
							TMT_BL BL 
						WHERE
							BL.VSL_CALL_ID = DC.VSL_CALL_ID 
							AND BL.BL_NO = R.CG_NO
					)
				ELSE (
					SELECT TOP(1) 
						DBO.F_GET_PARTNER_INFO(SN.FWRD, 'ENG_SNM') AS Eng_SNM
					FROM 
						TMT_SHIPG_NOTE SN 
					WHERE
						SN.VSL_CALL_ID = DC.VSL_CALL_ID 
						AND SN.SHIPG_NOTE_NO = R.CG_NO
				)
			END 										AS FWD_NM,
			DC.RMK,
			(SELECT 
				COUNT(1) 
			FROM 
				TMT_DAMAGE_CHECK DC1 
			WHERE 
				DC1.VSL_CALL_ID = DC.VSL_CALL_ID 
				AND DC1.CG_NO 	= DC.CG_NO 
				AND DC1.CHAS_NO = DC.CHAS_NO 
				AND DC1.DMG_CHK = 'DMG') 				AS DMG_DETAIL_COUNT,
			(SELECT 
				COUNT(1) 
			FROM 
				TMT_DAMAGE_CHECK DC1 
			WHERE 
				DC1.VSL_CALL_ID = DC.VSL_CALL_ID 
				AND DC1.CG_NO 	= DC.CG_NO 
				AND DC1.CHAS_NO = DC.CHAS_NO 
				AND DC1.DMG_CHK = 'INV') 				AS INV_DETAIL_COUNT
		FROM    
			TMT_DAMAGE_CHECK DC
		INNER JOIN 
			TMT_BL_DTL R
		ON 	
			DC.VSL_CALL_ID 	= R.VSL_CALL_ID 
			AND DC.CG_NO 	= R.CG_NO 
			AND DC.CHAS_NO 	= R.CHAS_NO
		LEFT OUTER JOIN 
			TMT_BRAND BR 
		ON 
			DC.BRAND_CD 	= BR.BRAND_CD
		LEFT OUTER JOIN 
			TMT_BRAND_DTL MD
		ON 
			DC.MODEL_CD 	= MD.MODEL_CD 
			AND DC.BRAND_CD = MD.BRAND_CD
		 <where>
		 	<if test="vslCallId != null and vslCallId != ''">
		 		AND DC.VSL_CALL_ID = #{vslCallId}
		 	</if>
		 	<if test="checkDtFrom != null and checkDtFrom != ''">
				AND DC.CHK_DT BETWEEN BETWEEN CONVERT(DATETIME, #{checkDtFrom},103) AND CONVERT(DATETIME, #{checkDtTo},103)
			</if>
		 	<if test="blNo != null and blNo != ''">
		 		AND R.CG_NO = #{blNo}
		 	</if>
		 	<if test="blNo == null or blNo == ''">
		 		<if test="snNo != null and snNo != ''">
		 			AND R.CG_NO = #{snNo}
		 		</if>
		 	</if>
		 	
		 	<if test="ixCd != null and ixCd != ''">
		 		AND DC.IX_CD = #{ixCd}
		 	</if>
		 	
		 	<if test="cgNo != null and cgNo != ''">
		 		AND DC.CG_NO = #{cgNo}
		 	</if>
		 	
		 	<if test="unitNo != null and unitNo != ''">
		 		<if test="searchType == 'HHT'">
		 			AND DC.CHAS_NO LIKE '%' + #{unitNo} + '%'
		 		</if>
		 		<if test="searchType != 'HHT'">
		 			AND DC.CHAS_NO = #{unitNo}
		 		</if>
		 	</if>
		 	<if test="dmgSearchType == 'Dmg'">
		   	    AND DC.DMG_CHK = 'DMG'
		    </if>
		    <if test="dmgSearchType == 'Inv'">
		   	    AND DC.DMG_CHK = 'INV'
		    </if>
		 </where>
		 
		UNION ALL
		SELECT	/* RoRoDamageCheck.getRoRoDamageCheckListItems */
			DISTINCT
			DC.VSL_CALL_ID,
			R.VSL_CD,
			R.CALL_SEQ,
			R.CALL_YEAR,
			R.MF_DOC_ID,
			R.CG_NO,
			R.CATG_CD,
			DC.IX_CD,
			DBO.F_CM_CODE_NM('MT', 'IXCD', DC.IX_CD) 	AS IX_NM,
			DBO.F_CM_CODE_NM('MT', 'CATGTP', R.CATG_CD) AS CATG_NM,
			BR.BRAND_CD,
			BR.BRAND_NM,
			MD.MODEL_CD,
			MD.MODEL_NM,
			DC.CHAS_NO,
			FORMAT(DC.CHK_DT, 'dd/MM/yyyy HH:mm:ss') 	AS CHK_DT,
			DC.STAFF_CD 								AS UPD_BY,
			R.CG_TP_CD,
			DBO.F_CM_CODE_NM('MT', 'CGTP', R.CG_TP_CD) 	AS CG_TP_NM,
			CASE     
				WHEN DC.IX_CD = 'I'
					THEN (SELECT TOP(1)
							* 
						FROM 
							(SELECT 
								BL.FWRD 
							FROM
								TMT_BL BL 
							WHERE 
								BL.VSL_CALL_ID 	= DC.VSL_CALL_ID 
								AND BL.BL_NO 	= R.CG_NO) AS sub_query)
				ELSE (SELECT TOP(1)
						* 
					FROM 
						(SELECT 
							SN.FWRD 
						FROM 
							TMT_SHIPG_NOTE SN 
						WHERE 
							SN.VSL_CALL_ID 			= DC.VSL_CALL_ID 
							AND SN.SHIPG_NOTE_NO 	= R.CG_NO) AS sub_query)
			END 										AS FWRD,
			CASE     
				WHEN DC.IX_CD = 'I'
					THEN 
							(SELECT TOP(1)
								DBO.F_GET_PARTNER_INFO(BL.FWRD, 'ENG_SNM') 
							FROM 	
								TMT_BL BL 
							WHERE 
								BL.VSL_CALL_ID 		= DC.VSL_CALL_ID 
								AND BL.BL_NO 		= R.CG_NO)
				ELSE 
						(SELECT 
							DBO.F_GET_PARTNER_INFO(SN.FWRD, 'ENG_SNM') 
						FROM 
							TMT_SHIPG_NOTE SN 
						WHERE 
							SN.VSL_CALL_ID 			= DC.VSL_CALL_ID 
							AND SN.SHIPG_NOTE_NO 	= R.CG_NO)
			END 										AS FWD_NM,
			DC.RMK,
			(SELECT 
				COUNT(1) 
			FROM 
				TMT_DAMAGE_CHECK DC1 
			WHERE 
				DC1.VSL_CALL_ID = DC.VSL_CALL_ID 
				AND DC1.CG_NO 	= DC.CG_NO 
				AND DC1.CHAS_NO = DC.CHAS_NO
				AND DC1.DMG_CHK = 'DMG') AS DMG_DETAIL_COUNT,
			(SELECT 
				COUNT(1) 
			FROM 
				TMT_DAMAGE_CHECK DC1 
			WHERE 
				DC1.VSL_CALL_ID = DC.VSL_CALL_ID 
				AND DC1.CG_NO 	= DC.CG_NO 
				AND DC1.CHAS_NO = DC.CHAS_NO 
				AND DC1.DMG_CHK = 'INV') AS INV_DETAIL_COUNT
		FROM   
			TMT_DAMAGE_CHECK DC
		INNER JOIN 
			TMT_SHIPG_NOTE_DTL R
		ON 
			DC.VSL_CALL_ID 	= R.VSL_CALL_ID 
			AND DC.CG_NO 	= R.CG_NO 
			AND DC.CHAS_NO 	= R.CHAS_NO
		LEFT OUTER JOIN 
			TMT_BRAND BR 
		ON 
			DC.BRAND_CD 	= BR.BRAND_CD
		LEFT OUTER JOIN 
			TMT_BRAND_DTL MD
		ON 
			DC.MODEL_CD 	= MD.MODEL_CD 
			AND DC.BRAND_CD = MD.BRAND_CD
		 <where>
		 	<if test="vslCallId != null and vslCallId != ''">
		 		AND DC.VSL_CALL_ID = #{vslCallId}
		 	</if>
		 	<if test="checkDtFrom != null and checkDtFrom != ''">
				AND DC.CHK_DT BETWEEN CONVERT(DATETIME, #{checkDtFrom},103) AND CONVERT(DATETIME, #{checkDtTo},103)
			</if>
		 	<if test="snNo != null and snNo != ''">
	 			AND R.CG_NO = #{snNo}
	 		</if>
		 	
		 	<if test="ixCd != null and ixCd != ''">
		 		AND DC.IX_CD = #{ixCd}
		 	</if>
		 	
		 	<if test="cgNo != null and cgNo != ''">
		 		AND DC.CG_NO = #{cgNo}
		 	</if>
		 	
		 	<if test="unitNo != null and unitNo != ''">
		 		<if test="searchType == 'HHT'">
		 			AND DC.CHAS_NO LIKE '%' + #{unitNo} + '%'
		 		</if>
		 		<if test="searchType != 'HHT'">
		 			AND DC.CHAS_NO = #{unitNo}
		 		</if>
		 	</if>
		 	<if test="dmgSearchType == 'Dmg'">
		   	    AND DC.DMG_CHK = 'DMG'
		    </if>
		    <if test="dmgSearchType == 'Inv'">
		   	    AND DC.DMG_CHK = 'INV'
		    </if>
		 </where>
	</sql>
	
	<select id="selectCargoPopupItems" parameterType="theListOfDamageCheckOfROROParm" resultMap="resultCargoPopupMap">
		<choose>
			<when test='ixCd == "I"'>
				SELECT  /* theListOfDamageCheckOfRORO.getCargoPopupItems */
					DISTINCT BL.VSL_CALL_ID,
					BL.MF_DOC_ID,
					BL.BL_NO 										AS CG_NO,
					BL.CATG_CD,
					DBO.F_CM_CODE_NM ('MT', 'CATGTP', BL.CATG_CD) 	AS CATG_NM,
					BR.BRAND_CD,
					BR.BRAND_NM,
					M.MODEL_CD,
					M.MODEL_NM,
					BL.CG_TP_CD,
					DBO.F_CM_CODE_NM ('MT', 'CGTP', BL.CG_TP_CD) 	AS CG_TP_NM,
					DT.IX_CD
			FROM 	
				TMT_BL_DTL DT
			INNER JOIN 
				TMT_BL BL 
			ON 
				BL.VSL_CALL_ID 	= DT.VSL_CALL_ID 
				AND BL.BL_NO 	= DT.BL_NO
			LEFT OUTER JOIN 
				TMT_BRAND BR 
			ON 
				DT.BRAND_CD = BR.BRAND_CD
			LEFT OUTER JOIN 
				TMT_BRAND_DTL M
			ON 
				DT.MODEL_CD 	= M.MODEL_CD 
				AND DT.BRAND_CD = M.BRAND_CD
			 WHERE 	
				BL.VSL_CALL_ID 	= #{vslCallId}
				AND BL.CG_TP_CD IN ('RCV') 
				AND (DT.CHAS_NO IS NOT NULL AND DT.CHAS_NO <![CDATA[ <> ]]>'')
				AND BL.STAT_CD 	= 'AP'
				<if test="brandCd != null and brandCd != ''">
					AND BR.BRAND_CD = #{brandCd}
				</if>
				<if test="catgCd != null and catgCd != ''">
					AND BL.CATG_CD = #{catgCd}
				</if>
			</when>
			<otherwise>
			SELECT  /* theListOfDamageCheckOfRORO.getCargoPopupItems */
				DISTINCT SN.VSL_CALL_ID,
				SN.MF_DOC_ID,
				SN.SHIPG_NOTE_NO 								AS CG_NO,
				SN.CATG_CD,
				DBO.F_CM_CODE_NM ('MT', 'CATGTP', SN.CATG_CD) 	AS CATG_NM,
				BR.BRAND_CD,
				BR.BRAND_NM,
				M.MODEL_CD,
				M.MODEL_NM,
				SN.CG_TP_CD,
				DBO.F_CM_CODE_NM ('MT', 'CGTP', SN.CG_TP_CD) 	AS CG_TP_NM,
				DT.IX_CD
			FROM 	
				TMT_SHIPG_NOTE_DTL DT
			INNER JOIN 
				TMT_SHIPG_NOTE SN 
			ON 
				SN.VSL_CALL_ID 			= DT.VSL_CALL_ID 
				AND SN.SHIPG_NOTE_NO 	= DT.SHIPG_NOTE_NO
			LEFT OUTER JOIN 
				TMT_BRAND BR 
			ON 
				DT.BRAND_CD = BR.BRAND_CD
			LEFT OUTER JOIN 
				TMT_BRAND_DTL M
			ON 
				DT.MODEL_CD 		= M.MODEL_CD 
				AND DT.BRAND_CD 	= M.BRAND_CD
			WHERE 	
				SN.VSL_CALL_ID 		= #{vslCallId} 
				AND SN.CG_TP_CD IN ('RCV') 
				AND (DT.CHAS_NO IS NOT NULL AND DT.CHAS_NO <![CDATA[ <> ]]>'')
				AND SN.STAT_CD 		= 'AP'
				<if test="brandCd != null and brandCd != ''">
					AND BR.BRAND_CD = #{brandCd}
				</if>
				<if test="catgCd != null and catgCd != ''">
					AND SN.CATG_CD 	= #{catgCd}
				</if>
			</otherwise>
		</choose>
	</select>
	
	<select id="selectTheDamagePartItems" parameterType="theListOfDamageCheckOfROROParm" resultMap="resultRoRoDmgDtlInvMap">
		SELECT	/* RoRoDamageCheck.selectTheDamagePartItems */
			S_CD,
			S_CD_NM,
			S_CD_DESC
		FROM
			TMT_CD_MSTD    
		WHERE   
			M_CD 			= 'DMGCHK' 
			AND S_CD_LGV 	= 'DMG_PART'
		ORDER BY 
			S_CD_NM
	</select>
	
	<select id="selectTheDamageLevelItems" parameterType="theListOfDamageCheckOfROROParm" resultMap="resultRoRoDmgDtlInvMap">
		SELECT	/* RoRoDamageCheck.selectTheDamageLevelItems */
			S_CD,
			S_CD_NM,
			S_CD_DESC
		FROM    
			TMT_CD_MSTD   
		WHERE   
			M_CD 			= 'DMGCHK' 
			AND S_CD_LGV 	= 'DMG_LEVEL'
		ORDER BY 
			S_CD_NM
	</select>
	
	<select id="selectUnitPopupItems" parameterType="theListOfDamageCheckOfROROParm" resultMap="resultUnitPopupMap">
		<choose>
			<when test='ixCd == "I"'>
				SELECT	/* theListOfDamageCheckOfRORO.getUnitPopupItems */
					DT.VSL_CALL_ID,
					DT.VSL_CD,
					DT.CALL_SEQ,
					DT.CALL_YEAR,
					DT.CATG_CD,
					DT.MF_DOC_ID,
					DT.CG_NO,
					DT.CHAS_NO,
					BR.BRAND_CD,
					BR.BRAND_NM,
					MD.MODEL_CD,
					MD.MODEL_NM,
					DT.CG_TP_CD,
					FORMAT(RR.IN_DTM, 'dd/MM/yyyy HH:mm:ss') AS IN_DTM,
					RR.LOC_ID,
					DT.IX_CD
			  	FROM 	
					TMT_BL_DTL DT
				LEFT OUTER JOIN 
					TMT_RORO_MST RR
				ON  
					RR.VSL_CALL_ID 		= DT.VSL_CALL_ID
					AND RR.MF_DOC_ID 	= DT.MF_DOC_ID
					AND RR.CG_NO 		= DT.BL_NO
					AND RR.CHASSIS_NO 		= DT.CHAS_NO
					<!-- AND RR.RORO_SEQ 	= DT.SEQ -->
				LEFT OUTER JOIN 
					TMT_BRAND BR 
				ON 
					DT.BRAND_CD = BR.BRAND_CD
				LEFT OUTER JOIN 
					TMT_BRAND_DTL MD
				ON
					BR.BRAND_CD 	= MD.BRAND_CD 
					AND DT.MODEL_CD = MD.MODEL_CD
			 	WHERE  
					DT.VSL_CALL_ID = #{vslCallId}
					AND DT.CG_TP_CD IN ('RCV')
					AND DT.CHAS_NO NOT IN (SELECT 
												CHAS_NO
											FROM 
												TMT_DAMAGE_CHECK
											WHERE    
												VSL_CALL_ID = #{vslCallId}
												AND (CHAS_NO IS NOT NULL AND CHAS_NO <![CDATA[ <> ]]>''))
					AND ISNULL(RR.STAT_CD, DT.STAT_CD) != 'RH'
					<if test="cgNo != null and cgNo != ''">
						AND DT.BL_NO 	= #{cgNo}
					</if>
					<if test="brandCd != null and brandCd != ''">
						AND BR.BRAND_CD = #{brandCd}
					</if>
					<if test="catgCd != null and catgCd != ''">
						AND DT.CATG_CD 	= #{catgCd}
					</if>
			</when>
			<otherwise>
				SELECT  /* theListOfDamageCheckOfRORO.getUnitPopupItems */
					DT.VSL_CALL_ID,
					DT.VSL_CD,
					DT.CALL_SEQ,
					DT.CALL_YEAR,
					DT.CATG_CD,
					DT.MF_DOC_ID,
					DT.CG_NO,
					DT.CHAS_NO,
					BR.BRAND_CD,
					BR.BRAND_NM,
					MD.MODEL_CD,
					MD.MODEL_NM,
					DT.CG_TP_CD,
					FORMAT(RR.IN_DTM, 'dd/MM/yyyy HH:mm:ss') AS IN_DTM,
					RR.LOC_ID,
					DT.IX_CD
			  	FROM 	
					TMT_SHIPG_NOTE_DTL DT
				LEFT OUTER JOIN 
					TMT_RORO_MST RR
				ON
					RR.VSL_CALL_ID 		= DT.VSL_CALL_ID
					AND RR.MF_DOC_ID 	= DT.MF_DOC_ID
					AND RR.CG_NO 		= DT.SHIPG_NOTE_NO
					AND RR.CHASSIS_NO 		= DT.CHAS_NO
					<!-- AND RR.RORO_SEQ 	= DT.SEQ -->
				LEFT OUTER JOIN 
					TMT_BRAND BR 
				ON 
					DT.BRAND_CD 		= BR.BRAND_CD
				LEFT OUTER JOIN 
					TMT_BRAND_DTL MD
				ON
					BR.BRAND_CD 		= MD.BRAND_CD 
					AND DT.MODEL_CD 	= MD.MODEL_CD
			 	WHERE
					DT.VSL_CALL_ID 		= #{vslCallId}
					AND DT.CG_TP_CD IN ('RCV')
					AND DT.CHAS_NO NOT IN (SELECT 
												CHAS_NO
											FROM
												TMT_DAMAGE_CHECK
											WHERE
												VSL_CALL_ID = #{vslCallId}
												AND (CHAS_NO IS NOT NULL AND CHAS_NO <![CDATA[ <> ]]>''))
					AND ISNULL(RR.STAT_CD, DT.STAT_CD) != 'RH'
				   <if test="cgNo != null and cgNo != ''">
						AND DT.SHIPG_NOTE_NO = #{cgNo}
					</if>
					<if test="brandCd != null and brandCd != ''">
						AND BR.BRAND_CD 	= #{brandCd}
					</if>
					<if test="catgCd != null and catgCd != ''">
						AND DT.CATG_CD	 	= #{catgCd}
					</if>
			</otherwise>
		</choose>
	</select>
	
	<select id="selectROROInventoryItems" parameterType="theListOfDamageCheckOfROROParm" resultMap="resultRoRoDmgDtlInvMap">
		SELECT /* theListOfDamageCheckOfRORO.selectROROInventoryItems */
			*
		FROM
			TMT_DAMAGE_CHECK
		WHERE 
			DMG_CHK 		= 'INV' 
			AND INV_CD 		= #{invCd}
			AND VSL_CALL_ID = #{vslCallId}
			AND CG_NO 		= #{cgNo}
			AND CHAS_NO 	= #{unitNo}
	</select>
		<select id="getOneUnitItem" parameterType="theListOfDamageCheckOfROROParm" resultMap="resultUnitPopupMap">
		SELECT	/* RoRoDamageCheck.getOneUnitItem */
			TOP 1
			RR.VSL_CALL_ID,
			RR.CATG_CD,
			RR.MF_DOC_ID,
			RR.CG_NO,
			RR.CHASSIS_NO,
			BR.BRAND_CD,
			BR.BRAND_NM,
			MD.MODEL_CD,
			MD.MODEL_NM,
			RR.CG_TP_CD,
			FORMAT(RR.IN_DTM, 'dd/MM/yyyy HH:mm:ss') AS IN_DTM,
			RR.LOC_ID,
			RR.IX_CD
		FROM    
			TMT_RORO_MST RR
		
		<choose>
			<when test="vslCallId == 'NonCallId'">
				INNER JOIN 
					TMT_SHIPG_NOTE S 
				ON 
					RR.VSL_CALL_ID 	= S.VSL_CALL_ID 
					AND RR.CG_NO 	= S.SHIPG_NOTE_NO
			</when>
		</choose>
				
		
		LEFT OUTER JOIN 
			TMT_BRAND BR 
		ON
			RR.BRAND_CD = BR.BRAND_CD
		LEFT OUTER JOIN
			TMT_BRAND_DTL MD
		ON 
			BR.BRAND_CD 	= MD.BRAND_CD 
			AND RR.MODEL_CD = MD.MODEL_CD 
		WHERE   
			RR.VSL_CALL_ID = #{vslCallId}
			<if test="cgNo != null and cgNo != ''">
				AND CG_NO = #{cgNo}
			</if>
			<if test="unitNo != null and unitNo != ''">
				AND CHAS_NO = #{unitNo}
			</if>
			
			<choose>
				<when test="vslCallId == 'NonCallId'">
					<if test="estArrvFromDt != null and estArrvFromDt != ''">
						AND EST_ARRV_DT BETWEEN CONVERT(DATETIME, #{estArrvFromDt},103) AND CONVERT(DATETIME, #{estArrvToDt},103)
					</if>
					<if test="snNo != null and snNo != ''">
						AND S.SHIPG_NOTE_NO = #{snNo}
					</if>
				</when>
			</choose>
			
			AND RR.CG_TP_CD IN ('RCV')
			
			AND RR.CHASSIS_NO NOT IN (SELECT 
										CHAS_NO 
									FROM 
										TMT_DAMAGE_CHECK 
									WHERE 
										VSL_CALL_ID = #{vslCallId})
			AND RR.STAT_CD != 'RH'
	</select>
	
	<select id="selectRoRoDmgDtlInvItems" parameterType="theListOfDamageCheckOfROROParm" resultMap="resultRoRoDmgDtlInvMap">
	 	<if test="pageNo != 0"> 
             SELECT /* theListOfDamageCheckOfRORO.selectRoRoDmgDtlInvItems */
				* 
			FROM 
				(SELECT 
					inner_querry.*, ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) row_num 
				FROM ( 
		</if>
				<include refid="getRoRoDmgDtlInvItems"/>
		<if test="pageNo != 0"> 
				)inner_querry 
			)inner_querry 
			WHERE 
				inner_querry.row_num <![CDATA[>]]> (CASE WHEN #{pageNo} = '0' THEN 1 ELSE CAST(#{pageNo} AS INT) END - 1) * CAST(#{sizePerPage} AS INT)
				AND inner_querry.row_num <![CDATA[<=]]> CASE WHEN #{pageNo} = '0' THEN 1 ELSE CAST(#{pageNo} AS INT) END * CAST(#{sizePerPage} AS INT)
		</if>
	 </select>
	 <select id="selectRoRoDmgDtlInvItemsCount" parameterType="theListOfDamageCheckOfROROParm" resultType="java.lang.String">
	 	SELECT /* theListOfDamageCheckOfRORO.selectRoRoDmgDtlInvItemsCount */
			COUNT(*)
		FROM
			(<include refid="getRoRoDmgDtlInvItems"/>) AS getRoRoDmgDtlInvItems
	 </select>
	<sql id="getRoRoDmgDtlInvItems">
		SELECT	/* RoRoDamageCheck.getRoRoDmgDtlInvItems */
			CD.S_CD,
			CD.S_CD_NM,
			CD.S_CD_DESC
			<choose>	
				<when test="vslCallId != null and vslCallId != ''
								and cgNo != null and cgNo != ''
								and unitNo != null and unitNo != ''">
					,ISNULL(DM.INV_CNT, '0') AS INV_CNT
				</when>
				<otherwise>
					,'0' AS INV_CNT
				</otherwise>
			</choose>
		FROM    
			TMT_CD_MSTD CD
			<if test="vslCallId != null and vslCallId != ''
								and cgNo != null and cgNo != ''
								and unitNo != null and unitNo != ''">
				LEFT OUTER JOIN 
					TMT_DAMAGE_CHECK DM 
				ON  
					CD.S_CD = DM.INV_CD 
					AND DM.DMG_CHK = 'INV'
					AND DM.VSL_CALL_ID = #{vslCallId}
					AND DM.CG_NO = #{cgNo}
					AND DM.CHAS_NO = #{unitNo}
			</if>

		WHERE   
			CD.L_CD 		= 'MT'
			AND CD.M_CD 	= 'DMGCHK'
			AND CD.S_CD_LGV = 'INV'
			AND CD.S_CD_USE = 'Y'
		        
		<!-- ORDER BY CAST(CD.S_CD_ST AS NUMERIC(15)) -->
	</sql>
	
	<select id="selectRoRoDmgDtlDmgItems" parameterType="theListOfDamageCheckOfROROParm" resultMap="resultRoRoDmgDtlDmgMap">
	 	<if test="pageNo != 0"> 
			SELECT /* theListOfDamageCheckOfRORO.selectRoRoDmgDtlDmgItems */
				*
			FROM 
				(SELECT 
					inner_querry.*, ROW_NUMBER() OVER(ORDER BY (SELECT NULL)) row_num 
				FROM ( 
		</if>
				<include refid="getRoRoDmgDtlDmgItems"/>
		<if test="pageNo != 0"> 
				)inner_querry 
			)inner_querry 
			WHERE 
				inner_querry.row_num <![CDATA[>]]> (CASE WHEN #{pageNo} = '0' THEN 1 ELSE CAST(#{pageNo} AS INT) END - 1) * CAST(#{sizePerPage} AS INT)
				AND inner_querry.row_num <![CDATA[<=]]> CASE WHEN #{pageNo} = '0' THEN 1 ELSE CAST(#{pageNo} AS INT) END * CAST(#{sizePerPage} AS INT)
		</if>
	 </select>
	 <select id="selectRoRoDmgDtlDmgItemsCount" parameterType="theListOfDamageCheckOfROROParm" resultType="java.lang.String">
	 	SELECT /* theListOfDamageCheckOfRORO.selectRoRoDmgDtlDmgItemsCount */
			COUNT(*)
		FROM 
			(<include refid="getRoRoDmgDtlDmgItems"/>) AS getRoRoDmgDtlDmgItems
	 </select>
	
	<sql id="getRoRoDmgDtlDmgItems">
		SELECT	/* RoRoDamageCheck.getRoRoDmgDtlDmgItems */
			DM.VSL_CALL_ID,
			DM.CG_NO,
			DM.CHAS_NO,
			DM.DMG_PART,
			DBO.F_CM_CODE_NM('MT', 'DMGCHK', DM.DMG_PART) 								AS DMG_PART_NM,
			DM.DMG_LEVEL,
			DBO.F_CM_CODE_NM('MT', 'DMGCHK', DM.DMG_LEVEL) 								AS DMG_LEVEL_NM,
			DM.RMK 																		AS remark,
			DM.BRAND_CD,
			BR.BRAND_NM,
			DM.MODEL_CD,
			MD.MODEL_NM,
			DM.CATG_CD,
			DM.IX_CD,
			DM.CHK_LOC,
			DBO.F_CM_CODE_NM('MT', 'DMGCHK', DM.CHK_LOC)	 							AS CHK_LOC_NM,
			COUNT(DM.DMG_PART) OVER (PARTITION BY DM.VSL_CALL_ID, DM.CG_NO, DM.CHAS_NO) AS DETAIL_COUNT
		FROM    
			TMT_DAMAGE_CHECK DM
		LEFT OUTER JOIN 
			TMT_BRAND BR 
		ON 
			DM.BRAND_CD 	= BR.BRAND_CD
		LEFT OUTER JOIN 
			TMT_BRAND_DTL MD 
		ON
			DM.BRAND_CD 	= MD.BRAND_CD 
			AND DM.MODEL_CD = MD.MODEL_CD
		WHERE   
			DM.DMG_CHK 			= 'DMG'
			AND DM.VSL_CALL_ID 	= #{vslCallId}
			<if test="cgNo != null and cgNo != ''">
				AND DM.CG_NO 	= #{cgNo}
			</if>
			<if test="unitNo != null and unitNo != ''">
				AND DM.CHAS_NO 	= #{unitNo}
			</if>
			<if test="chkLoc != null and chkLoc != ''">
				AND DM.CHK_LOC 	= #{chkLoc}
			</if>
	</sql>
	
	<insert id="insertRoRoDmgItem" parameterType="theListOfDamageCheckOfROROItem">
		INSERT INTO /* RoRoDamageCheck.insertRoRoDmgItem */
		TMT_DAMAGE_CHECK (
			VSL_CALL_ID
		   	,VSL_CD
		   	,CALL_SEQ
		   	,CALL_YEAR
		   	,MF_DOC_ID
		  	,CG_NO
		  	,CHAS_NO
		  	,SEQ
		  	,IX_CD
		  	,CATG_CD
		  	,DMG_CHK
		  	,CHK_LOC
		  	,DMG_PART
		  	,DMG_LEVEL
		  	,INV_CD
		  	,INV_CNT
		  	,BRAND_CD
		  	,MODEL_CD
		  	,RMK
		  	,CRT_DT
		  	,CRT_BY
		  	,UPDATE_TIME
		  	,STAFF_CD
		  
		) VALUES (
		   	#{vslCallId}
		   	,#{vslCd}
		   	,#{callSeq}
		   	,#{callYear}
		   	,#{docNo}
		  	,#{cgNo}
		  	,#{unitNo}
			,(SELECT 
				ISNULL(MAX(CAST(SEQ AS INT)),0) + 1 
			FROM 
				TMT_DAMAGE_CHECK 
			WHERE 
				VSL_CALL_ID = #{vslCallId} AND CG_NO = #{cgNo})
			,#{ixCd}
			,#{catgCd}
			,#{dmgChkCd}
			,#{locCd}
			,#{dmgPart}
			,#{dmgLevel}
			,#{invCd}
			,CASE WHEN #{invCnt} IS NULL OR #{invCnt} = '' THEN NULL ELSE CAST(#{invCnt} AS NUMERIC(12,0)) END
			,#{brandCd}
			,#{modelCd}
			,#{remark}
			,SYSDATETIME()
			,#{userId}
			,SYSDATETIME()
			,#{userId}
		  
		)
	</insert>
	
	<update id="updateRoRoDmgItem" parameterType="theListOfDamageCheckOfROROItem">
		UPDATE	/* TheListOfDamageCheckOfROROMap.updateRoRoDmgItem */
			TMT_DAMAGE_CHECK
		SET	
			CHK_LOC 		= #{locCd}
			,DMG_PART 		= #{dmgPart}
			,DMG_LEVEL		= #{dmgLevel}
			,RMK 			= #{remark}
			,UPDATE_TIME 	= SYSDATETIME()
			,STAFF_CD 		= #{userId}
    	WHERE
			DMG_CHK 		= 'DMG'
			AND VSL_CALL_ID = #{vslCallId}
			AND CG_NO 		= #{cgNo}
			AND CHAS_NO		= #{unitNo}
	</update>
	
	<update id="updateCheckTimeItem" parameterType="theListOfDamageCheckOfROROItem">
		UPDATE	/* TheListOfDamageCheckOfROROMap.updateCheckTimeItem */
			TMT_DAMAGE_CHECK
		SET		
			CHK_DT 			= SYSDATETIME()
				
    	WHERE 
			VSL_CALL_ID 	= #{vslCallId}
			AND CG_NO 		= #{cgNo}
			AND CHAS_NO 	= #{unitNo}
	</update>
	
	<update id="updateRoRoInvItem" parameterType="theListOfDamageCheckOfROROItem">
		UPDATE	/* TheListOfDamageCheckOfROROMap.updateCheckTimeItem */
			TMT_DAMAGE_CHECK
		SET	
			INV_CNT 		= #{invCnt}
			,UPDATE_TIME 	= SYSDATETIME()
			,STAFF_CD 		= #{userId}
				
    	WHERE 
			VSL_CALL_ID = #{vslCallId}
			AND CG_NO 	= #{cgNo}
			AND CHAS_NO = #{unitNo}
			AND DMG_CHK = 'INV' 
			AND INV_CD 	= #{invCd}
	</update>
	
	<delete id="deleteRoRoDmgItem" parameterType="theListOfDamageCheckOfROROItem">
		DELETE	
			TMT_DAMAGE_CHECK
		WHERE
			VSL_CALL_ID = #{vslCallId}
			AND CG_NO 	= #{cgNo}
			AND CHAS_NO = #{unitNo}
			<if test = "dmgChkCd != null and dmgChkCd != ''" >
				AND DMG_CHK=#{dmgChkCd}
			</if>
			
			<if test='workingStatus == "D"'>
				<if test = "locCd != null and locCd != ''" >
					AND CHK_LOC=#{locCd}
				</if>
			</if>
			
	</delete>
	
	
	
	<select id="selectBrandComboBoxItemsHHT" parameterType="theListOfDamageCheckOfROROParm" resultMap="resultComboList">
		SELECT	/* RoRoDamageCheck.selectBrandComboBoxItemsHHT */
			DISTINCT
			BRAND_CD CD,
			BRAND_CD CD_NM
		FROM	
			TMT_RORO_MST
		WHERE
			VSL_CALL_ID = #{vslCallId}
	</select>
	<select id="selectBlComboBoxItemsHHT" parameterType="theListOfDamageCheckOfROROParm" resultMap="resultComboList">
		SELECT	/* RoRoDamageCheck.getBlComboBoxItemsHHT */
			DISTINCT
			BL_NO CD,
			BL_NO CD_NM
		FROM	
			TMT_BL
		WHERE
			VSL_CALL_ID = #{vslCallId}
			AND CG_TP_CD IN ('RCV')
	</select>
	<select id="selectShipgNoteNoComboBoxItemsHHT" parameterType="theListOfDamageCheckOfROROParm" resultMap="resultComboList">
		SELECT	/* RoRoDamageCheck.getSNComboBoxItemsHHT */
			DISTINCT
			SHIPG_NOTE_NO CD,
			SHIPG_NOTE_NO CD_NM
		FROM	
			TMT_SHIPG_NOTE
		WHERE
			VSL_CALL_ID = #{vslCallId}
			AND STAT_CD = 'AP'
			AND CG_TP_CD IN ('RCV')
			
			 <choose>
				<when test="vslCallId == 'STRG'">
					<if test="estArrvFromDt != null and estArrvFromDt != ''">
						AND EST_ARRV_DT BETWEEN CONVERT(DATETIME, #{estArrvFromDt},103) AND CONVERT(DATETIME, #{estArrvToDt},103)
					</if>
				</when>
			</choose>
	</select>
	<select id="selectUnitPopupItemsHHT" parameterType="theListOfDamageCheckOfROROParm" resultMap="resultUnitPopupMap">
		SELECT	/* RoRoDamageCheck.getUnitPopupItemsHHT */
			RR.VSL_CALL_ID,
			RR.VSL_CD,
			RR.CALL_SEQ,
			RR.CALL_YEAR,
			RR.CATG_CD,
			RR.MF_DOC_ID 								AS docNo,
			RR.CG_NO 									AS cgNo,
			RR.CHASSIS_NO 									AS unitNo,
			BR.BRAND_CD 								AS brandCd,
			BR.BRAND_NM 								AS brandNm,
			MD.MODEL_CD 								AS modelCd,
			MD.MODEL_NM 								AS modelNm,
			RR.CG_TP_CD,
			RR.STAT_CD 									AS statNm,
			FORMAT(RR.IN_DTM, 'dd/MM/yyyy HH:mm:ss') 	AS IN_DTM,
			RR.LOC_ID AS yardLoc,
			RR.IX_CD
		FROM    
			TMT_RORO_MST RR
		LEFT OUTER JOIN 
			TMT_BRAND BR 
		ON
			RR.BRAND_CD = BR.BRAND_CD
		LEFT OUTER JOIN 
			TMT_BRAND_DTL MD
		ON 
			BR.BRAND_CD 	= MD.BRAND_CD 
			AND RR.MODEL_CD = MD.MODEL_CD 
		WHERE   
			VSL_CALL_ID = #{vslCallId}
			<if test="cgNo != null and cgNo != ''">
				AND CG_NO = #{cgNo}
			</if>
			<if test="brandCd != null and brandCd != ''">
				AND BR.BRAND_CD = #{brandCd}
			</if>
			<if test="catgCd != null and catgCd != ''">
				AND RR.CATG_CD = #{catgCd}
			</if>
			AND RR.CG_TP_CD IN ('RCV')
			
			AND RR.CHASSIS_NO NOT IN (SELECT 
										CHAS_NO 
									FROM 
										TMT_DAMAGE_CHECK 
									WHERE 
										VSL_CALL_ID = #{vslCallId})
			AND RR.STAT_CD != 'RH'
			AND RR.IX_CD = 'X' 
	</select>
	
	<select id="selectRoRoDamageCheckItemsHHT" parameterType="theListOfDamageCheckOfROROParm" resultMap="resultRoRoDamageCheckMap">
		<include refid="getRoRoDamageCheckListItemsHHT"/>
	</select>
	<sql id="getRoRoDamageCheckListItemsHHT">
		SELECT	/* ---------------------------------------------
			RoRoDamageCheck.getRoRoDamageCheckListItemsHHT 
			-----------------------------------------------	*/
			DISTINCT
			DC.VSL_CALL_ID,
			R.VSL_CD,
			R.CALL_SEQ,
			R.CALL_YEAR,
			R.MF_DOC_ID,
			R.CG_NO,
			R.CATG_CD,
			DC.IX_CD,
			DBO.F_CM_CODE_NM('MT', 'IXCD', DC.IX_CD) 		AS IX_NM,
			DBO.F_CM_CODE_NM('MT', 'CATGTP', R.CATG_CD) 	AS CATG_NM,
			DBO.F_CM_CODE_NM ('MT', 'DELVTP', R.DELV_TP_CD) AS DELVTPNM,
			DBO.F_CM_CODE_NM ('MT', 'CGSTATUS', R.STAT_CD) 	AS STATNM,
			R.PLAN_LOC_ID 									AS LOCID,
			BR.BRAND_CD,
			BR.BRAND_NM,
			MD.MODEL_CD,
			MD.MODEL_NM,
			DC.CHAS_NO,
			FORMAT(DC.CHK_DT, 'dd/MM/yyyy HH:mm:ss') 		AS CHK_DT,
			DC.STAFF_CD AS UPD_BY,
			R.CG_TP_CD,
			DBO.F_CM_CODE_NM('MT', 'CGTP', R.CG_TP_CD) 		AS CG_TP_NM,
<!-- 		      	CASE    WHEN DC.IX_CD = 'I' -->
<!--                         THEN (SELECT * FROM (SELECT BL.SHIPG_AGENT FROM TMT_BL BL WHERE BL.VSL_CALL_ID = DC.VSL_CALL_ID AND BL.BL_NO = R.CG_NO) WHERE ROWNUM = 1) -->
<!--                         ELSE (SELECT * FROM (SELECT SN.SHIPG_AGNCY FROM TMT_SHIPG_NOTE SN WHERE SN.VSL_CALL_ID = DC.VSL_CALL_ID AND SN.SHIPG_NOTE_NO = R.CG_NO) WHERE ROWNUM = 1) -->
<!--                 END AS SHA_CD, -->
<!--                 CASE     WHEN DC.IX_CD = 'I' -->
<!--                         THEN (SELECT * FROM (SELECT DBO.F_GET_PARTNER_INFO(BL.SHIPG_AGENT, 'ENG_SNM') FROM TMT_BL BL WHERE BL.VSL_CALL_ID = DC.VSL_CALL_ID AND BL.BL_NO = R.CG_NO) WHERE ROWNUM = 1) -->
<!--                         ELSE (SELECT * FROM (SELECT DBO.F_GET_PARTNER_INFO(SN.SHIPG_AGNCY, 'ENG_SNM') FROM TMT_SHIPG_NOTE SN WHERE SN.VSL_CALL_ID = DC.VSL_CALL_ID AND SN.SHIPG_NOTE_NO = R.CG_NO) WHERE ROWNUM = 1) -->
<!--                 END AS SHA_NM, -->
			CASE     
				WHEN DC.IX_CD = 'I'
					THEN (SELECT TOP(1)
							* 
						FROM 
							(SELECT 
								BL.FWRD 
							FROM 
								TMT_BL BL 
							WHERE 
								BL.VSL_CALL_ID 	= DC.VSL_CALL_ID 
								AND BL.BL_NO 	= R.CG_NO) AS sub_query)
				ELSE (SELECT TOP(1)
						* 
					FROM 
						(SELECT 
							SN.FWRD 
						FROM 
							TMT_SHIPG_NOTE SN 
						WHERE 
							SN.VSL_CALL_ID 			= DC.VSL_CALL_ID 
							AND SN.SHIPG_NOTE_NO 	= R.CG_NO) AS sub_query)
			END AS FWRD,
			CASE
				WHEN DC.IX_CD = 'I'
					THEN 
						(SELECT 
							DBO.F_GET_PARTNER_INFO(BL.FWRD, 'ENG_SNM') 
						FROM 
							TMT_BL BL 
						WHERE 
							BL.VSL_CALL_ID 	= DC.VSL_CALL_ID 
							AND BL.BL_NO 	= R.CG_NO)
				ELSE 
					(SELECT 
						DBO.F_GET_PARTNER_INFO(SN.FWRD, 'ENG_SNM') 
					FROM 
						TMT_SHIPG_NOTE SN 
					WHERE 
						SN.VSL_CALL_ID = DC.VSL_CALL_ID 
						AND SN.SHIPG_NOTE_NO = R.CG_NO)
			END AS FWD_NM,
			DC.RMK,
			(SELECT 
				COUNT(1) 
			FROM 
				TMT_DAMAGE_CHECK DC1 
			WHERE 
				DC1.VSL_CALL_ID = DC.VSL_CALL_ID 
				AND DC1.CG_NO 	= DC.CG_NO 
				AND DC1.CHAS_NO = DC.CHAS_NO 
				AND DC1.DMG_CHK = 'DMG') AS DMG_DETAIL_COUNT,
			(SELECT 
				COUNT(1) 
			FROM 
				TMT_DAMAGE_CHECK DC1 
			WHERE 
				DC1.VSL_CALL_ID = DC.VSL_CALL_ID 
				AND DC1.CG_NO 	= DC.CG_NO 
				AND DC1.CHAS_NO = DC.CHAS_NO 
				AND DC1.DMG_CHK = 'INV') AS INV_DETAIL_COUNT
		FROM    	
			TMT_DAMAGE_CHECK DC
		INNER JOIN 
			TMT_RORO_MST R
		ON 
			DC.VSL_CALL_ID = R.VSL_CALL_ID 
			AND DC.CG_NO 	= R.CG_NO 
			AND DC.CHAS_NO = R.CHASSIS_NO

			 <choose>
				<when test="vslCallId == 'STRG'">
					INNER 
						JOIN TMT_SHIPG_NOTE S 
					ON 
						R.VSL_CALL_ID 	= S.VSL_CALL_ID 
						AND R.CG_NO 	= S.SHIPG_NOTE_NO
				</when>
			</choose>

		LEFT OUTER JOIN 
			TMT_BRAND BR 
		ON 
			DC.BRAND_CD = BR.BRAND_CD
		LEFT OUTER JOIN 
			TMT_BRAND_DTL MD
		ON 
			DC.MODEL_CD 	= MD.MODEL_CD 
			AND DC.BRAND_CD = MD.BRAND_CD
		 <where>
		 	<if test="vslCallId != null and vslCallId != ''">
		 		AND DC.VSL_CALL_ID = #{vslCallId}
		 	</if>
		 	<if test="checkDtFrom != null and checkDtFrom != ''">
				AND DC.CHK_DT BETWEEN BETWEEN CONVERT(DATETIME, #{checkDtFrom},103) AND CONVERT(DATETIME, #{checkDtTo},103)
			</if>
		 	<if test="blNo != null and blNo != ''">
		 		<if test="snNo != null and snNo != ''">
		 			AND (R.CG_NO = #{blNo} OR R.CG_NO = #{snNo})
		 		</if>
		 		<if test="snNo == null or snNo == ''">
		 			AND R.CG_NO = #{blNo}
		 		</if>
		 	</if>
		 	<if test="blNo == null or blNo == ''">
		 		<if test="snNo != null and snNo != ''">
		 			AND R.CG_NO = #{snNo}
		 		</if>
		 	</if>
		 	
		 	<if test="ixCd != null and ixCd != ''">
		 		AND DC.IX_CD = #{ixCd}
		 	</if>
		 	
		 	<if test="cgNo != null and cgNo != ''">
		 		AND DC.CG_NO = #{cgNo}
		 	</if>
		 	
		 	<if test="unitNo != null and unitNo != ''">
		 		<if test="searchType == 'HHT'">
		 			AND DC.CHAS_NO LIKE '%' + #{unitNo} + '%'
		 		</if>
		 		<if test="searchType != 'HHT'">
		 			AND DC.CHAS_NO = #{unitNo}
		 		</if>
		 	</if>
		 	<if test="dmgSearchType == 'Dmg'">
		   	    AND DC.DMG_CHK = 'DMG'
		    </if>
		    <if test="dmgSearchType == 'Inv'">
		   	    AND DC.DMG_CHK = 'INV'
		    </if>
		    
		     <choose>
					<when test="vslCallId == 'STRG'">
						<if test="estArrvFromDt != null and estArrvFromDt != ''">
							AND EST_ARRV_DT BETWEEN CONVERT(DATETIME, #{estArrvFromDt},103) AND CONVERT(DATETIME, #{estArrvToDt},103)
							
						</if>
					</when>
				</choose>
		 </where>
	</sql>
	 <select id="selectROROInventoryItemsHHT" parameterType="theListOfDamageCheckOfROROParm" resultMap="resultRoRoDmgDtlInvMap">
	 /*  ========= selectROROInventoryItemsHTT =========  */
		SELECT 
			* 
		FROM 
			TMT_DAMAGE_CHECK
		WHERE
			DMG_CHK 		= 'INV' 
			AND VSL_CALL_ID = #{vslCallId}
			AND CG_NO 		= #{cgNo}
			AND CHAS_NO 	= #{unitNo}	
			AND INV_CD 		= #{invCd}
	</select>
	<select id="selectRoRoDmgDtlInvItemsHHT" parameterType="theListOfDamageCheckOfROROParm" resultMap="resultRoRoDmgDtlInvMap">
		SELECT	/* =============== RoRoDamageCheck.selectRoRoDmgDtlInvItemsHHT =============== */
			CD.S_CD,
			CD.S_CD 		AS invCd,
			CD.S_CD_NM,
			CD.S_CD_NM 		AS invNm,
			CD.S_CD_DESC,
			<!-- CD.S_CD_ST, -->
			<!-- CD.S_CD_ST AS cdNum, -->
			CD.S_CD_RMK 	AS remark
			<choose>	
				<when test="vslCallId != null and vslCallId != ''
								and cgNo != null and cgNo != ''
								and unitNo != null and unitNo != ''">
					,ISNULL(DM.INV_CNT, '0') AS INV_CNT
				</when>
				<otherwise>
					,'0' 	AS INV_CNT
				</otherwise>
			</choose>
		FROM    
			TMT_CD_MSTD CD
			<if test="vslCallId != null and vslCallId != ''
								and cgNo != null and cgNo != ''
								and unitNo != null and unitNo != ''">
				LEFT OUTER JOIN 
					TMT_DAMAGE_CHECK DM 
				ON
					CD.S_CD 			= DM.INV_CD 
					AND DM.DMG_CHK 		= 'INV'
					AND DM.VSL_CALL_ID 	= #{vslCallId}
					AND DM.CG_NO	 	= #{cgNo}
					AND DM.CHAS_NO 	= #{unitNo}
			</if>

		WHERE   
			CD.L_CD 		= 'MT'
			AND CD.M_CD 	= 'DMGCHK'
			AND CD.S_CD_LGV = 'INV'
			AND CD.S_CD_USE = 'Y'
		        
		<!-- ORDER BY CAST(CD.S_CD_ST AS NUMERIC(15)) -->
	</select>
	<insert id="insertRoRoDmgItemHHT" parameterType="theListOfDamageCheckOfROROItem">
		/* insertRoRoDmgItemHHT */
		INSERT INTO 
		TMT_DAMAGE_CHECK (
			/*MISSING COLUMN*/
				MF_DOC_ID,
			/*MISSING COLUMN*/
		   VSL_CALL_ID
		   ,VSL_CD
		   ,CALL_SEQ
		   ,CALL_YEAR
		  ,CG_NO
		  ,CHAS_NO
		  ,SEQ
		  ,IX_CD
		  ,CATG_CD
		  ,DMG_CHK
		  ,CHK_LOC
		  ,DMG_PART
		  ,DMG_LEVEL
		  ,INV_CD
		  ,INV_CNT
		  <!-- ,CODE_NUM -->
<!-- 		  ,CHK_DT -->
		  ,BRAND_CD
		  ,MODEL_CD
		  ,RMK
		  ,CRT_DT
		  ,CRT_BY
		  ,UPDATE_TIME
		  ,STAFF_CD
		  
		) VALUES (
			/* MF_DOC_ID*/,
		   #{vslCallId}
		   ,#{vslCd}
		   ,#{callSeq}
		   ,#{callYear}
		  ,#{cgNo}
		  ,#{unitNo}
		  ,(SELECT 
				ISNULL(MAX(CAST(SEQ AS INT)),0) + 1 
			FROM 
				TMT_DAMAGE_CHECK 
			WHERE 
				VSL_CALL_ID = #{vslCallId} 
				AND CG_NO 	= #{cgNo} 
				AND CHAS_NO = #{unitNo})
		  ,#{ixCd}
		  ,#{catgCd}
		  ,#{dmgChkCd}
		  ,#{locCd}
		  ,#{dmgPart}
		  ,#{dmgLevel}
		  ,#{invCd}
		  ,CASE WHEN #{invCnt} IS NULL OR #{invCnt} = '' THEN NULL ELSE CAST(#{invCnt} AS NUMERIC(12,0)) END
		  ,#{brandCd}
		  ,#{modelCd}
		  ,#{remark}
	  	  ,SYSDATETIME()
	 	  ,#{userId}
	 	  ,SYSDATETIME()
	   	  ,#{userId}
		)
	</insert>
	<update id="updateRoRoDmgItemHHT" parameterType="theListOfDamageCheckOfROROItem">
		UPDATE	/* TheListOfDamageCheckOfROROMap.updateRoRoDmgItem */
			TMT_DAMAGE_CHECK
		SET		
			CHK_LOC 	= #{locCd}
			,DMG_PART 	= #{dmgPart}
			,DMG_LEVEL 	= #{dmgLevel}
			,RMK 		= #{remark}
			,UPDATE_TIME = SYSDATETIME()
			,STAFF_CD 	= #{userId}
    	WHERE 
			DMG_CHK 		= 'DMG'
			AND VSL_CALL_ID = #{vslCallId}
			AND CG_NO 		= #{cgNo}
			AND CHAS_NO 	= #{unitNo}
	</update>
	
	<update id="updateCheckTimeItemHHT" parameterType="theListOfDamageCheckOfROROItem">
		UPDATE	/* -----------------------------
		 TheListOfDamageCheckOfROROMap.updateCheckTimeItemHHT 
		  -----------------------------  ----------------------------- */
			TMT_DAMAGE_CHECK
		SET		
			CHK_DT = SYSDATETIME()
				
    	WHERE 
			VSL_CALL_ID = #{vslCallId}
			AND CG_NO 	= #{cgNo}
			AND CHAS_NO = #{unitNo}
	</update>
	
	<insert id="insertRoRoInvItemHHT" parameterType="theListOfDamageCheckOfROROItem">
		/* -----------------------------
			TheListOfDamageCheckOfROROMap.insertRoRoInvItemHHT 
			 -----------------------------  ----------------------------- */
		INSERT INTO 
		TMT_DAMAGE_CHECK (
			/*MISSING COLUMN*/
				MF_DOC_ID,
			/*MISSING COLUMN*/
			VSL_CALL_ID
			, VSL_CD
		    , CALL_SEQ
		    , CALL_YEAR
		    , SEQ
			, CG_NO
			, CHAS_NO
			, INV_CD
			, INV_CNT
			 ,UPDATE_TIME
			, STAFF_CD
			, DMG_CHK
		) VALUES (
			/* MF_DOC_ID */,
			#{vslCallId}
			, #{vslCd}
		    , #{callSeq}
		    , #{callYear}
		    ,(SELECT 
				ISNULL(MAX(CAST(SEQ AS INT)),0) + 1 
			FROM 
				TMT_DAMAGE_CHECK 
			WHERE
				VSL_CALL_ID = #{vslCallId} 
				AND CG_NO 	= #{cgNo} 
				AND CHAS_NO = #{unitNo})
			, #{cgNo}
			, #{unitNo}
			, #{invCd}
			, #{invCnt}
			, SYSDATETIME()
			, #{userId}
			, 'INV'
		)
	</insert>
	
	<update id="updateRoRoInvItemHHT" parameterType="theListOfDamageCheckOfROROItem">
		UPDATE	/* -----------------------------
			TheListOfDamageCheckOfROROMap.updateRoRoInvItemHHT 
			 -----------------------------  ----------------------------- */
			TMT_DAMAGE_CHECK
		SET	
			INV_CNT 		= #{invCnt}
			, UPDATE_TIME 	= SYSDATETIME()
			,STAFF_CD 		= #{userId}
			,DMG_CHK 		= 'INV'
    	WHERE
			VSL_CALL_ID = #{vslCallId}
			AND CG_NO 	= #{cgNo}
			AND CHAS_NO = #{unitNo}
			AND INV_CD 	= #{invCd}
	</update>
	
	<delete id="deleteRoRoDmgItemHHT" parameterType="theListOfDamageCheckOfROROItem">
		DELETE	/*TheListOfDamageCheckOfROROMap.deleteRoRoDmgItemHHT */
			TMT_DAMAGE_CHECK
		WHERE
			VSL_CALL_ID = #{vslCallId}
			AND CG_NO 	= #{cgNo}
			AND CHAS_NO = #{unitNo}
			<if test = "dmgChkCd != null and dmgChkCd != ''" >
				AND DMG_CHK=#{dmgChkCd}
			</if>
	</delete>
</mapper>