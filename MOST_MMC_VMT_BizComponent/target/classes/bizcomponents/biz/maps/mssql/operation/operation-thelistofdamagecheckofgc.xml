<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="theListOfDamageCheckOfGC">
	<resultMap 	id="resultComboList" 	type="theListOfDamageCheckOfGCItem">
		<result property = "vslCallId"	column = "VSLCALLID"/>
   		<result property = "cd"			column = "CD"/>
   		<result property = "cdNm"		column = "CD_NM"/>
		<result property = "cgTpCd" 	column = "CG_TP_CD"/>
		<result property = "cmdtGrpCd" 	column = "CMDT_GRP_CD"/>
		<result property = "cmdtCd" 	column = "CMDT_CD"/>
		<result property = "docWgt" 	column = "CG_WGT"/>
		<result property = "docMsrmt" 	column = "CG_MSRMT"/>
		<result property = "docQty" 	column = "PKG_QTY"/>
		<result property = "eachWgt" 	column = "EACH_WGT"/>
		<result property = "eachVol" 	column = "EACH_VOL"/>
		<result property = "unitNo" 	column = "UNIT_NO"/>
		<result property = "catgCd" 	column = "CATG_CD"/>
 	</resultMap>
 	
 	<resultMap 	id="resultGCDamageCheckMap" type="theListOfDamageCheckOfGCItem">
   		<result property = "vslCallId"		column = "VSL_CALL_ID"/>
   		<result property = "vslCd"			column = "VSL_CD"/>
   		<result property = "callSeq"		column = "CALL_SEQ"/> 
   		<result property = "callYear"		column = "CALL_YEAR"/>
		<result property = "blNo" 			column = "BLNO"/>
		<result property = "snNo" 			column = "SNNO"/>
		<result property = "cgNo" 			column = "CG_NO"/>
		<result property = "lorryNo" 		column = "LORRY_NO"/>
		<result property = "dmgQty" 		column = "DMGQTY"/>
		<result property = "dmgMt" 			column = "DMGMT"/>
		<result property = "dmgM3" 			column = "DMGM3"/>
		<result property = "checkedDt" 		column = "CHK_DT"/>
		<result property = "checkedBy" 		column = "UPD_BY"/>
		<result property = "cgTpCd" 		column = "CG_TP_CD"/>
		<result property = "cgTpNm" 		column = "CG_TP_NM"/>
		<result property = "catgCd" 		column = "CATG_CD"/>
		<result property = "catgNm" 		column = "CATG_NM"/>
		<result property = "shaCd" 			column = "SHIPG_AGNT"/>
		<result property = "shaNm" 			column = "SHA_NM"/>
		<result property = "fwdCd" 			column = "FWRD"/>
		<result property = "fwdNm" 			column = "FWRD_NM"/>
		<result property = "remark" 		column = "RMK"/>
		<result property = "regNo" 			column = "REG_NO"/>
		<result property = "jobNo" 			column = "JOB_NO"/>
		<result property = "dmgPartNm" 		column = "DMG_PART"/>
		<result property = "dmgLevelNm" 	column = "DMG_LEVEL"/>
		
		<result property = "mfDocId" 		column = "MF_DOC_ID"/>
		<result property = "masterBlNo" 	column = "MASTER_BL"/>
		<result property = "bookingNo" 		column = "BOOKING_NO"/>
		<result property = "unitNo" 		column = "CHAS_NO"/>
		<result property = "locCd" 			column = "CHK_LOC"/>
		<result property = "dmgCount" 		column = "DAMAGE_COUNT"/>
		<result property = "cmdtGrpCd" 		column = "CMDT_GRP_CD"/>
		<result property = "cmdtGrpNm" 		column = "CMDT_GRP_NM"/>
		<result property = "cmdtCd" 		column = "CMDT_CD"/>
		<result property = "cmdtNm" 		column = "CMDT_NM"/>
		<result property = "pkgTpCd" 		column = "PKG_TP_CD"/>
		<result property = "pkgTpNm" 		column = "PKG_TP_NM"/>
		<result property = "brandCd" 		column = "BRAND_CD"/>
		<result property = "modelCd" 		column = "MODEL_CD"/>
		<result property = "marksNo" 		column = "MARK_NO"/>
		<result property = "descGoods" 		column = "GDS_RMK"/>
		<result property = "cnsne" 		    column = "CNSNE"/>
		<result property = "cnsneNm" 		column = "CNSNE_NM"/>
		<result property = "fileCount" 		column = "FILE_ATTACH_COUNT"/>
		<result property = "createBy" 		column = "CRT_BY"/>
		<result property = "createDt" 	    column = "CRT_DT"/>
		<result property = "updateBy" 		column = "UPD_BY"/>
		<result property = "updateDt" 		column = "UPD_DT"/>
		<result property = "dmgDesc" 		column = "DMG_DESC"/>
		<result property = "workingStatus" 	column = "WORKING_STATUS"/>
 	</resultMap>
 	
 	<resultMap 	id="resultGCDmgDtlDmgMap" type="theListOfDamageCheckOfGCItem">
   		<result property = "vslCallId"		column = "VSL_CALL_ID"/>				
		<result property = "cgNo" 			column = "CG_NO"/>
		<result property = "dmgQty" 		column = "QTY"/>
		<result property = "dmgMt" 			column = "MT"/>
		<result property = "dmgM3" 			column = "M3"/>
		<result property = "checkedDt" 		column = "CHK_DT"/>		
		<result property = "dmgPart" 		column = "DMG_PART"/>
		<result property = "dmgPartNm" 		column = "DMG_PART_NM"/>
		<result property = "dmgLevel" 		column = "DMG_LEVEL"/>
		<result property = "dmgLevelNm" 	column = "DMG_LEVEL_NM"/>
		<result property = "remark" 		column = "RMK"/>
		<result property = "seq" 			column = "SEQ"/>
		<result property = "workingStatus" 	column = "WORKING_STATUS"/>
		<result property = "dmgDesc" 		column = "DMG_DESC"/>
		<result property = "dmgRemark" 		column = "RMK"/>
		<result property = "regNo" 			column = "REG_NO"/>
		<result property = "locCd" 			column = "CHK_LOC"/>
		<result property = "brandCd" 		column = "BRAND_CD"/>
		<result property = "modelCd" 		column = "MODEL_CD"/>
		<result property = "unitNo" 		column = "CHAS_NO"/>
		<result property = "catgCd" 		column = "CATG_CD"/>
		<result property = "mfDocId" 		column = "MF_DOC_ID"/>
 	</resultMap>
 	
 	
 	<resultMap 	id="resultGCDimensionCheckMap" type="theListOfDamageCheckOfGCItem">
   		<result property = "vslCallId"		column = "VSL_CALL_ID"/>
   		<result property = "vslCd"			column = "VSL_CD"/>
   		<result property = "callSeq"		column = "CALL_SEQ"/> 
   		<result property = "callYear"		column = "CALL_YEAR"/>
		<result property = "blNo" 			column = "BLNO"/>
		<result property = "snNo" 			column = "SNNO"/>
		<result property = "cgNo" 			column = "CG_NO"/>
		<result property = "lorryNo" 		column = "LORRY_NO"/>
		<result property = "snDocLength" 	column = "SN_DOC_LENGTH"/>
		<result property = "snDocWidth" 	column = "SN_DOC_WIDTH"/>
		<result property = "snDocHeight" 	column = "SN_DOC_HEIGHT"/>
		<result property = "blDocLength" 	column = "BL_DOC_LENGTH"/>
		<result property = "blDocWidth" 	column = "BL_DOC_WIDTH"/>
		<result property = "blDocHeight" 	column = "BL_DOC_HEIGHT"/>
		<result property = "actLength" 		column = "ACT_LENGTH"/>
		<result property = "actWidth" 		column = "ACT_WIDTH"/>
		<result property = "actHeight" 		column = "ACT_HEIGHT"/>
		<result property = "checkedDt" 		column = "CHK_DT"/>
		<result property = "checkedBy" 		column = "UPD_BY"/>
		<result property = "ixNm" 			column = "IX_CD"/>
		<result property = "cgTpCd" 		column = "CG_TP_CD"/>
		<result property = "cgTpNm" 		column = "CG_TP_NM"/>
		<result property = "catgCd" 		column = "CATG_CD"/>
		<result property = "catgNm" 		column = "CATG_NM"/>
		<result property = "shaCd" 			column = "SHIPG_AGNT"/>
		<result property = "shaNm" 			column = "SHA_NM"/>
		<result property = "fwdCd" 			column = "FWRD"/>
		<result property = "fwdNm" 			column = "FWRD_NM"/>
		<result property = "remark" 		column = "RMK"/>
 	</resultMap>
 	
 	<resultMap 	id="resultGCDimensionDtlDmgMap" type="theListOfDamageCheckOfGCItem">
   		<result property = "vslCallId"		column = "VSL_CALL_ID"/>				
		<result property = "cgNo" 			column = "CG_NO"/>
		<result property = "actLength" 		column = "LENGTH"/>
		<result property = "actWidth" 		column = "WIDTH"/>
		<result property = "actHeight" 		column = "HEIGHT"/>
		<result property = "checkedDt" 		column = "CHK_DT"/>		
		<result property = "remark" 		column = "RMK"/>		
 	</resultMap>
 	
 	<select id="selectBlComboBoxItems" parameterType="theListOfDamageCheckOfGCParm" resultMap="resultComboList">
		SELECT	/* CargoDamageCheck.getBlComboBoxItems */
				DISTINCT
				BL_NO CD,
				BL_NO CD_NM
		FROM	TMT_BL
		WHERE	VSL_CALL_ID = #{vslCallId}
				AND CATG_CD != 'V'
	</select>
	
	<select id="selectCategoryComboBoxItems" parameterType="theListOfDamageCheckOfGCParm" resultMap="resultComboList">
		SELECT	/* CargoDamageCheck.getBlComboBoxItems */
				DISTINCT
				S_CD CD,
				S_CD_NM CD_NM
		FROM	TMT_CD_MSTD
		WHERE	M_CD = 'CATGTP'
	</select>
		
	<select id="selectShipgNoteNoComboBoxItems" parameterType="theListOfDamageCheckOfGCParm" resultMap="resultComboList">
		SELECT	/* CargoDamageCheck.getSNComboBoxItems */
				DISTINCT
				SHIPG_NOTE_NO CD,
				SHIPG_NOTE_NO CD_NM
		FROM	TMT_SHIPG_NOTE
		WHERE	VSL_CALL_ID = #{vslCallId}
				AND STAT_CD = 'AP'
				AND CG_TP_CD NOT IN ('RCV')				
	</select>
	
	<select id="selectGCDamageCheckItems" parameterType="theListOfDamageCheckOfGCParm" resultMap="resultGCDamageCheckMap">
	 	<if test="pageNo != 0"> 
             SELECT * FROM (SELECT inner.*, rownum row_num FROM ( 
		</if>
				<include refid="getGCDamageCheckListItems"/>
		<if test="pageNo != 0"> 
				)inner 
			)inner 
			WHERE inner.row_num <![CDATA[>]]> (TO_NUMBER(DECODE(#{pageNo},'0', '1', #{pageNo}))-1)* TO_NUMBER(#{sizePerPage}) 
		  	AND inner.row_num <![CDATA[<=]]> TO_NUMBER(DECODE(#{pageNo},'0', '1', #{pageNo})) * TO_NUMBER(#{sizePerPage})
		</if>
	 </select>
	 <select id="selectGCDamageCheckItemsCount" parameterType="theListOfDamageCheckOfGCParm" resultType="java.lang.String">
	 	SELECT COUNT(*)
          FROM (<include refid="getGCDamageCheckListItems"/>)
	 </select>
	 <sql id="getGCDamageCheckListItems">
		 SELECT DMG.VSL_CALL_ID,
	       DMG.VSL_CD,
	       DMG.CALL_SEQ,
	       DMG.CALL_YEAR,
      	   DOC.BL_NO AS BLNO,
	       DOC.SHIPG_NOTE_NO AS SNNO,
	       DMG.CG_NO,
	       DMG.CHAS_NO,
	       DMG.REG_NO,
	       DMG.BRAND_CD,
	       DMG.MODEL_CD,
	       DOC.CATG_CD,
	       F_CM_001 ('MT', 'CATGTP', DOC.CATG_CD) AS CATG_NM,
	       DOC.CG_TP_CD,
	       F_CM_001 ('MT', 'CGTP', DOC.CG_TP_CD) AS CG_TP_NM,
	       DOC.CMDT_GRP_CD,
	       F_CM_001 ('MT', 'CMDTGRP', DOC.CMDT_GRP_CD) AS CMDT_GRP_NM,
	       DOC.CMDT_CD,
	       F_GET_CMDT_DESC (DOC.CMDT_CD) AS CMDT_NM,
	       DOC.PKG_TP_CD,
	       F_CM_001 ('MT', 'PKGTP', DOC.PKG_TP_CD) AS PKG_TP_NM,
	       DOC.SHIPG_AGENT,
	       F_GET_PARTNET_INFO (DOC.SHIPG_AGENT, 'ENG_SNM') AS SHA_NM,
	       DOC.FWRD,
	       F_GET_PARTNET_INFO (DOC.FWRD, 'ENG_SNM') AS FWRD_NM,
	       DOC.CNSNE,
	       F_GET_PARTNET_INFO (DOC.CNSNE, 'ENG_SNM') AS CNSNE_NM,
	       DMG.QTY AS DMGQTY,
	       DMG.MT AS DMGMT,
	       DMG.M3 AS DMGM3,
	       DMG.RMK,
	       DMG.DMG_DESC,
	       (SELECT	S_CD_NM
				FROM    TMT_CD_MSTD 
				WHERE   M_CD = 'DMGGCCHK' 
					AND L_CD = 'MT' AND S_CD = DMG.DMG_DESC AND ROWNUM = 1) dmgDescNm,
	       TO_CHAR (DMG.CHK_DT, 'DD/MM/YYYY HH24:MI') AS CHK_DT,
	       CRT_BY,
	       TO_CHAR (DMG.CRT_DT, 'DD/MM/YYYY HH24:MI') AS CRT_DT,
	       UPD_BY,
	       TO_CHAR (DMG.UPD_DT, 'DD/MM/YYYY HH24:MI') AS UPD_DT,
	       DMG.CHK_LOC,
	       NULL AS FILE_ATTACH_COUNT,
	       'R' AS WORKING_STATUS,
	       DMG.JOB_NO,
	       DMG.DMG_PART dmgPart,
	       (SELECT S_CD_DESC
	          FROM TMT_CD_MSTD
	         WHERE M_CD = 'DMGCHK' AND S_CD_LGV = 'DMG_PART' AND S_CD = DMG.DMG_PART)
	          dmgPartNm,
	       DMG_LEVEL dmgLevel,
	       (SELECT S_CD_DESC
	          FROM TMT_CD_MSTD
	         WHERE     M_CD = 'DMGCHK'
	               AND S_CD_LGV = 'DMG_LEVEL'
	               AND S_CD = DMG.DMG_LEVEL)
	          dmgLevelNm,
	       DECODE (DMG.CHK_LOC,  'VSL', 'Vessel',  'YARD', 'Yard',  'GATE', 'Gate')
	          AS locNm,
	       DMG.CHK_LOC locCd
		FROM TMT_DAMAGE_CHECK DMG
		INNER JOIN (SELECT VSL_CALL_ID,
                       CATG_CD,
                       MF_DOC_ID,
                       BL_NO,
                       NULL AS SHIPG_NOTE_NO,
                       BL_NO AS BLSN,
                       CG_TP_CD,
                       CMDT_GRP_CD,
                       CMDT_CD,
                       PKG_TP_CD,
                       SHIPG_AGENT,
                       FWRD,
                       CNSNE,
                       SHPR,
                       PKG_MARK AS MARK_NO,
                       GDS_RMK
                  FROM TMT_BL
                 WHERE 1 = 1
                 <if test="vslCallId != null and vslCallId != ''">
                      AND VSL_CALL_ID = #{vslCallId}
                 </if>
                UNION
                SELECT VSL_CALL_ID,
                       CATG_CD,
                       MF_DOC_ID,
                       NULL AS BL_NO,
                       SHIPG_NOTE_NO,
                       SHIPG_NOTE_NO AS BLSN,
                       CG_TP_CD,
                       CMDT_GRP_CD,
                       CMDT_CD,
                       PKG_TP_CD,
                       SHIPG_AGNCY AS SHIPG_AGENT,
                       FWRD,
                       CNSNE,
                       SHPR,
                       MARK_NO,
                       GDS_RMK
                  FROM TMT_SHIPG_NOTE
                 WHERE 1 = 1
                	<if test="vslCallId != null and vslCallId != ''">
                      AND VSL_CALL_ID = #{vslCallId}
                	</if>
                 ) DOC
          ON     DMG.VSL_CALL_ID = DOC.VSL_CALL_ID
             AND DMG.CATG_CD = DOC.CATG_CD
             AND DMG.CG_NO = DOC.BLSN 
		<where>
			<choose>
			   	<when test="vslCallId != null and vslCallId != ''">
                         AND DMG.VSL_CALL_ID = #{vslCallId}
                </when>
				<when test=' masterBlNo != null and masterBlNo != "" '>
					AND DOC.MF_DOC_ID = #{masterBlNo}
				</when>
				<when test=' bookingNo != null and bookingNo != "" '>
					AND DOC.MF_DOC_ID = #{bookingNo}
				</when>
				<otherwise></otherwise>
			</choose>
			<choose>
				<when test=' blNo != null and blNo != "" '>
					AND DOC.BL_NO = #{blNo}
				</when>
				<when test=' snNo != null and snNo != "" '>
					AND DOC.SHIPG_NOTE_NO = #{snNo}
				</when>
				<otherwise></otherwise>
			</choose>
			<if test = ' unitNo != null and unitNo != "" '> AND DMG.CHAS_NO LIKE '%' || #{unitNo} || '%' </if>
			<if test = ' searchType != null and searchType = "duplicate" '>
				<if test = ' cgTpCd != null and cgTpCd != "RCV" '> AND DMG.CHAS_NO IS NULL </if>
			</if>
			<if test="checkDtFrom != null and checkDtFrom != ''">
					AND DMG.CHK_DT BETWEEN TO_DATE(#{checkDtFrom},'DD/MM/YYYY') AND TO_DATE(#{checkDtTo}, 'DD/MM/YYYY')
			</if>
			<if test="catgCd != null and catgCd != ''">
		 		AND DOC.CATG_CD = #{catgCd}
		 	</if>	
		</where>
		 ORDER BY CAST(DMG.REG_NO AS INT)  ASC
	 </sql>
	 
	 <sql id="getGCDamageCheckListItems_old">
	 SELECT * FROM (
		SELECT	/* CargoDamageCheck.getCargoDamageCheckListItems */
		   DC.VSL_CALL_ID,
	       DC.VSL_CD,
	       DC.CALL_SEQ,
	       DC.CALL_YEAR,
	       R.BL_NO AS BLNO,
	       R.SHIPG_NOTE_NO AS SNNO,
	       DC.CG_NO,
	       R.LORRY_NO,  
	       DC.QTY AS DMGQTY,
	       DC.MT AS DMGMT,
	       DC.M3 AS DMGM3,
	       TO_CHAR(DC.CHK_DT, 'DD/MM/YYYY HH24:MI') AS CHK_DT,
	       DC.UPD_BY,
	       R.OPE_CLASS_CD CATG_CD,
	       F_CM_001('MT', 'CATGTP', R.OPE_CLASS_CD) AS CATG_NM,
	       R.CG_TP_CD,
	       F_CM_001('MT', 'CGTP', R.CG_TP_CD) AS CG_TP_NM,
	       R.SHIPG_AGNT,
	       F_GET_PARTNET_INFO(R.SHIPG_AGNT, 'ENG_SNM') AS SHA_NM,
	       R.FWR_AGNT AS FWRD,
	       F_GET_PARTNET_INFO(R.FWR_AGNT, 'ENG_SNM') AS FWRD_NM,
	       DC.RMK  
	    FROM TMT_DAMAGE_CHECK DC
        LEFT JOIN TMT_CG_MST R ON DC.VSL_CALL_ID = R.VSL_CALL_ID AND DC.CG_NO = R.CG_NO 
         <where>
		 	<if test="vslCallId != null and vslCallId != ''">
		 		AND DC.VSL_CALL_ID = #{vslCallId}
		 	</if>
		 	<if test="checkDtFrom != null and checkDtFrom != ''">
					AND DC.CHK_DT BETWEEN TO_DATE(#{checkDtFrom},'DD/MM/YYYY') AND TO_DATE(#{checkDtTo}, 'DD/MM/YYYY')
			</if>
		 	<if test="blNo != null and blNo != ''">
		 		<if test="snNo != null and snNo != ''">
		 			AND (R.BL_NO = #{blNo} OR R.SHIPG_NOTE_NO = #{snNo})
		 		</if>
		 		<if test="snNo == null or snNo == ''">
		 			AND R.BL_NO = #{blNo}
		 		</if>
		 	</if>
		 	<if test="blNo == null or blNo == ''">
		 		<if test="snNo != null and snNo != ''">
		 			AND R.SHIPG_NOTE_NO = #{snNo}
		 		</if>
		 	</if>		 	
		 	<if test="catgCd != null and catgCd != ''">
		 		AND DC.CATG_CD = #{catgCd}
		 	</if>		 			 			   
		 </where>
		 )
		 GROUP BY 
           VSL_CALL_ID,
           VSL_CD,
           CALL_SEQ,
           CALL_YEAR,   
           BLNO,
           SNNO,                          
           CG_NO,
           LORRY_NO,
           DMGQTY,
           DMGMT,
           DMGM3,
           CHK_DT,
           UPD_BY,
           CATG_CD,
           CATG_NM,
           CG_TP_CD,
           CG_TP_NM,
           SHIPG_AGNT,
           SHA_NM,
           FWRD,
           FWRD_NM,
           RMK
	</sql>
	
	<select id="selectGCDmgDtlDmgItems" parameterType="theListOfDamageCheckOfGCParm" resultMap="resultGCDmgDtlDmgMap">
	 	<if test="pageNo != 0"> 
             SELECT * FROM (SELECT inner.*, rownum row_num FROM ( 
		</if>
				<include refid="getGCDmgDtlDmgItems"/>
		<if test="pageNo != 0"> 
				)inner 
			)inner 
			WHERE inner.row_num <![CDATA[>]]> (TO_NUMBER(DECODE(#{pageNo},'0', '1', #{pageNo}))-1)* TO_NUMBER(#{sizePerPage}) 
		  	AND inner.row_num <![CDATA[<=]]> TO_NUMBER(DECODE(#{pageNo},'0', '1', #{pageNo})) * TO_NUMBER(#{sizePerPage})
		</if>
	 </select>
	<select id="selectGCDmgDtlDmgItemsCount" parameterType="theListOfDamageCheckOfGCParm" resultType="java.lang.String">
	 	SELECT COUNT(*)
          FROM (<include refid="getGCDmgDtlDmgItems"/>)
	 </select>
	 
	 <sql id="getGCDmgDtlDmgItems">
		SELECT    /* CargoDamageCheck.getGCDmgDtlDmgItems */
                DM.VSL_CALL_ID,
                DM.CG_NO,
                DM.QTY,
                DM.MT,
                DM.M3,
                TO_CHAR (DM.CHK_DT, 'DD/MM/YYYY HH24:MI') AS CHK_DT,           
                DM.DMG_PART,
                F_CM_001('MT', 'DMGCHK', DM.DMG_PART) AS DMG_PART_NM,
                DM.DMG_LEVEL,
                F_CM_001('MT', 'DMGCHK', DM.DMG_LEVEL) AS DMG_LEVEL_NM,                
                DM.RMK,
                DM.DMG_DESC,
                DM.REG_NO,
                DM.CHK_LOC,
                DM.CHAS_NO,
                DM.BRAND_CD,
                DM.MODEL_CD                                                
        FROM    TMT_DAMAGE_CHECK DM               
        WHERE   DM.VSL_CALL_ID = #{vslCallId}
                AND DM.CG_NO = #{cgNo}
                ORDER BY SEQ
				
	</sql>	
	 
	<select id="selectGCDimensionCheckItems" parameterType="theListOfDamageCheckOfGCParm" resultMap="resultGCDimensionCheckMap">
	 	<if test="pageNo != 0"> 
             SELECT * FROM (SELECT inner.*, rownum row_num FROM ( 
		</if>
				<include refid="getGCDimensionCheckListItems"/>
		<if test="pageNo != 0"> 
				)inner 
			)inner 
			WHERE inner.row_num <![CDATA[>]]> (TO_NUMBER(DECODE(#{pageNo},'0', '1', #{pageNo}))-1)* TO_NUMBER(#{sizePerPage}) 
		  	AND inner.row_num <![CDATA[<=]]> TO_NUMBER(DECODE(#{pageNo},'0', '1', #{pageNo})) * TO_NUMBER(#{sizePerPage})
		</if>
	 </select>
	 <select id="selectGCDimensionCheckItemsCount" parameterType="theListOfDamageCheckOfGCParm" resultType="java.lang.String">
	 	SELECT COUNT(*)
          FROM (<include refid="getGCDimensionCheckListItems"/>)
	 </select>
	 <sql id="getGCDimensionCheckListItems">
	 SELECT * FROM 
	 (
	 	SELECT    /* CargoDimensionCheck.getCargoDimensionCheckListItems */
           DC.VSL_CALL_ID,
           DC.VSL_CD,
           DC.CALL_SEQ,
           DC.CALL_YEAR,
           R.BL_NO AS BLNO,
           R.SHIPG_NOTE_NO AS SNNO,
           DC.CG_NO,
           R.LORRY_NO,
           SN.LENGTH AS SN_DOC_LENGTH,
           SN.WIDTH AS SN_DOC_WIDTH,
           SN.HEIGHT AS SN_DOC_HEIGHT,
           BL.LENGTH AS BL_DOC_LENGTH,
           BL.WIDTH AS BL_DOC_WIDTH,
           BL.HEIGHT AS BL_DOC_HEIGHT,  
           DC.LENGTH AS ACT_LENGTH,
           DC.WIDTH AS ACT_WIDTH,
           DC.HEIGHT AS ACT_HEIGHT,
           TO_CHAR(DC.CHK_DT, 'DD/MM/YYYY HH24:MI') AS CHK_DT,
           DC.UPD_BY,
           DC.IX_CD,
           R.OPE_CLASS_CD CATG_CD,
           F_CM_001('MT', 'CATGTP', R.OPE_CLASS_CD) AS CATG_NM,
           R.CG_TP_CD,
           F_CM_001('MT', 'CGTP', R.CG_TP_CD) AS CG_TP_NM,
           R.SHIPG_AGNT,
           F_GET_PARTNET_INFO(R.SHIPG_AGNT, 'ENG_SNM') AS SHA_NM,
           R.FWR_AGNT AS FWRD,
           F_GET_PARTNET_INFO(R.FWR_AGNT, 'ENG_SNM') AS FWRD_NM,
           DC.RMK  
        FROM TMT_DIMENSION_CHECK DC
        INNER JOIN TMT_CG_MST R ON DC.VSL_CALL_ID = R.VSL_CALL_ID AND DC.CG_NO = R.CG_NO
        LEFT JOIN TMT_BL BL ON DC.VSL_CALL_ID = BL.VSL_CALL_ID AND BL.BL_NO = R.BL_NO
        LEFT JOIN TMT_SHIPG_NOTE SN ON SN.VSL_CALL_ID = SN.VSL_CALL_ID AND SN.SHIPG_NOTE_NO = R.SHIPG_NOTE_NO
        
        <if test="checkDtFrom != null and checkDtFrom != ''">
			WHERE CHK_DT BETWEEN TO_DATE(#{checkDtFrom},'DD/MM/YYYY HH24:MI') AND TO_DATE(#{checkDtTo}, 'DD/MM/YYYY HH24:MI')		
		</if>          	
	 )
	  <where>	 		 		
		 	<if test="vslCallId != null and vslCallId != ''">
		 		VSL_CALL_ID = #{vslCallId}
		 	</if>		 	
		 	<if test="blNo != null and blNo != ''">
		 		<if test="snNo != null and snNo != ''">
		 			AND (BLNO = #{blNo} OR SNNO = #{snNo})
		 		</if>
		 		<if test="snNo == null or snNo == ''">
		 			AND BLNO = #{blNo}
		 		</if>
		 	</if>		 	
		 	<if test="blNo == null or blNo == ''">
		 		<if test="snNo != null and snNo != ''">
		 			AND SNNO = #{snNo}
		 		</if>
		 	</if>		 	
		 	<if test="catgCd != null and catgCd != ''">
		 		AND CATG_CD = #{catgCd}
		 	</if>		 			 			   
	 </where>			 	 	
	</sql>
		
	
	<select id="selectGCDimensionDtlDmgItems" parameterType="theListOfDamageCheckOfGCParm" resultMap="resultGCDimensionDtlDmgMap">
	 	<if test="pageNo != 0"> 
             SELECT * FROM (SELECT inner.*, rownum row_num FROM ( 
		</if>
				<include refid="getGCDimensionDtlDmgItems"/>
		<if test="pageNo != 0"> 
				)inner 
			)inner 
			WHERE inner.row_num <![CDATA[>]]> (TO_NUMBER(DECODE(#{pageNo},'0', '1', #{pageNo}))-1)* TO_NUMBER(#{sizePerPage}) 
		  	AND inner.row_num <![CDATA[<=]]> TO_NUMBER(DECODE(#{pageNo},'0', '1', #{pageNo})) * TO_NUMBER(#{sizePerPage})
		</if>
	 </select>
	<select id="selectGCDimensionDtlDmgItemsCount" parameterType="theListOfDamageCheckOfGCParm" resultType="java.lang.String">
	 	SELECT COUNT(*)
          FROM (<include refid="getGCDmgDtlDmgItems"/>)
	 </select>
	 
	 <sql id="getGCDimensionDtlDmgItems">
		SELECT    /* CargoDimensionCheck.getGCDimensionDtlDmgItems */
                DM.VSL_CALL_ID,                
                DM.CG_NO,
                DM.LENGTH,
                DM.WIDTH,
                DM.HEIGHT,
                DM.CHK_DT,                                             
                DM.RMK                                                
        FROM    TMT_DIMENSION_CHECK DM               
        WHERE   DM.VSL_CALL_ID = #{vslCallId}
                AND DM.CG_NO = #{cgNo}				
	</sql>
	
	<delete id="deleteGCDmgItem" parameterType="theListOfDamageCheckOfGCItem">
		DELETE	TMT_DAMAGE_CHECK
		WHERE   VSL_CALL_ID = #{vslCallId}
				AND CG_NO = #{cgNo}		
				AND REG_NO = #{regNo}		
	</delete>
	
	<delete id="deleteGCDimensionItem" parameterType="theListOfDamageCheckOfGCItem">
		DELETE	TMT_DIMENSION_CHECK
		WHERE   VSL_CALL_ID = #{vslCallId}
				AND CG_NO = #{cgNo}				
	</delete>
	
	<!-- ############################################################### HHT ############################################################### -->
	
	<select id="selectTblDamageCheckItems" parameterType="theListOfDamageCheckOfGCParm" resultMap="resultGCDamageCheckMap"> 
		 SELECT  DMG.VSL_CALL_ID,
		         DMG.VSL_CD,
		         DMG.CALL_SEQ,
		         DMG.CALL_YEAR,
		         DOC.MF_DOC_ID,
		         DECODE( DOC.CATG_CD, 'I', DOC.MF_DOC_ID, NULL  ) AS MASTER_BL,
		         DECODE( DOC.CATG_CD, 'E', DOC.MF_DOC_ID, NULL  ) AS BOOKING_NO,
		         DOC.BL_NO AS BLNO,
		         DOC.SHIPG_NOTE_NO AS SNNO,
		         DMG.CG_NO,
		         DMG.CHAS_NO,
		         DMG.REG_NO,
		         DMG.BRAND_CD,
		         DMG.MODEL_CD,
		         DOC.CATG_CD,
		         DOC.MARK_NO,
		       	 DOC.GDS_RMK,
		         F_CM_001 ('MT', 'CATGTP', DOC.CATG_CD) AS CATG_NM,
		         DOC.CG_TP_CD,
		         F_CM_001 ('MT', 'CGTP', DOC.CG_TP_CD) AS CG_TP_NM,
		         DOC.CMDT_GRP_CD,
		         F_CM_001 ('MT', 'CMDTGRP', DOC.CMDT_GRP_CD) AS CMDT_GRP_NM,
		         DOC.CMDT_CD,
		         F_GET_CMDT_DESC (DOC.CMDT_CD) AS CMDT_NM,
		         DOC.PKG_TP_CD,
		         F_CM_001 ('MT', 'PKGTP', DOC.PKG_TP_CD) AS PKG_TP_NM,
		         DOC.SHIPG_AGENT,
		         F_GET_PARTNET_INFO (DOC.SHIPG_AGENT, 'ENG_SNM') AS SHA_NM,
		         DOC.FWRD,
		         F_GET_PARTNET_INFO (DOC.FWRD, 'ENG_SNM') AS FWRD_NM,
		         DOC.CNSNE,
		         F_GET_PARTNET_INFO (DOC.CNSNE, 'ENG_SNM') AS CNSNE_NM,
		         DMG.QTY AS DMGQTY,
		         DMG.MT AS DMGMT,
		         DMG.M3 AS DMGM3,
		         DMG.RMK,
		         DMG.DMG_DESC,
		         (SELECT	S_CD_NM
					FROM    TMT_CD_MSTD 
					WHERE   M_CD = 'DMGGCCHK' 
						AND L_CD = 'MT' AND S_CD = DMG.DMG_DESC AND ROWNUM = 1) dmgDescNm,
		         TO_CHAR (DMG.CHK_DT, 'DD/MM/YYYY HH24:MI') AS CHK_DT,
		         CRT_BY,
		         TO_CHAR (CRT_DT, 'DD/MM/YYYY HH24:MI') AS CRT_DT,
		         UPD_BY,
		         TO_CHAR (UPD_DT, 'DD/MM/YYYY HH24:MI') AS UPD_DT,
		         DMG.CHK_LOC,
		         (SELECT COUNT(*) FROM TMT_FILE_INFO WHERE CATG_CD = DMG.JOB_NO) AS FILE_ATTACH_COUNT,
		         'R' AS WORKING_STATUS,
		         DMG.JOB_NO,
		         (SELECT S_CD_DESC FROM TMT_CD_MSTD WHERE M_CD = 'DMGCHK' AND S_CD_LGV = 'DMG_PART' AND S_CD = DMG.DMG_PART AND ROWNUM = 1) AS DMG_PART, 
		         (SELECT S_CD_DESC FROM TMT_CD_MSTD WHERE M_CD = 'DMGCHK' AND S_CD_LGV = 'DMG_LEVEL' AND S_CD = DMG.DMG_LEVEL AND ROWNUM = 1) AS DMG_LEVEL
		    FROM TMT_DAMAGE_CHECK DMG
		         INNER JOIN (SELECT VSL_CALL_ID,
		                            CATG_CD,
		                            MF_DOC_ID,
		                            BL_NO,
		                            NULL AS SHIPG_NOTE_NO,
		                            BL_NO AS BLSN,
		                            CG_TP_CD,
		                            CMDT_GRP_CD,
		                            CMDT_CD,
		                            PKG_TP_CD,
		                            SHIPG_AGENT,
		                            FWRD,
		                            CNSNE,
		                            SHPR,
		                            PKG_MARK AS MARK_NO,
		                            GDS_RMK
		                       FROM TMT_BL
		                      WHERE 1 = 1
		                     	<if test="vslCallId != null and vslCallId != ''">
				                      AND VSL_CALL_ID = #{vslCallId}
				                </if>
		                     UNION
		                     SELECT VSL_CALL_ID,
		                            CATG_CD,
		                            MF_DOC_ID,
		                            NULL AS BL_NO,
		                            SHIPG_NOTE_NO,
		                            SHIPG_NOTE_NO AS BLSN,
		                            CG_TP_CD,
		                            CMDT_GRP_CD,
		                            CMDT_CD,
		                            PKG_TP_CD,
		                            SHIPG_AGNCY AS SHIPG_AGENT,
		                            FWRD,
		                            CNSNE,
		                            SHPR,
		                            MARK_NO,
		                            GDS_RMK
		                       FROM TMT_SHIPG_NOTE
		                      WHERE 1 = 1
		                       	<if test="vslCallId != null and vslCallId != ''">
			                      AND VSL_CALL_ID = #{vslCallId}
			                 	</if>
		                      ) DOC
		            ON     DMG.VSL_CALL_ID = DOC.VSL_CALL_ID
		               AND DMG.CATG_CD = DOC.CATG_CD
		               AND DMG.CG_NO = DOC.BLSN 
		<where>
			<choose>
				<when test=' masterBlNo != null and masterBlNo != "" '>
					AND DOC.MF_DOC_ID = #{masterBlNo}
				</when>
				<when test=' bookingNo != null and bookingNo != "" '>
					AND DOC.MF_DOC_ID = #{bookingNo}
				</when>
				<otherwise></otherwise>
			</choose>
			<choose>
				<when test=' blNo != null and blNo != "" '>
					AND DOC.BL_NO = #{blNo}
				</when>
				<when test=' snNo != null and snNo != "" '>
					AND DOC.SHIPG_NOTE_NO = #{snNo}
				</when>
				<otherwise></otherwise>
			</choose>
			<if test = ' unitNo != null and unitNo != "" '> AND DMG.CHAS_NO LIKE '%' || #{unitNo} || '%' </if>
			<if test = ' searchType != null and searchType = "duplicate" '>
				<if test = ' cgTpCd != null and cgTpCd != "RCV" '> AND DMG.CHAS_NO IS NULL </if>
			</if>
		</where>
		ORDER BY LENGTH(DMG.REG_NO), DMG.REG_NO ASC
	</select>
	
	<select id="selectTblMfDocId" parameterType="theListOfDamageCheckOfGCParm" resultMap="resultComboList"> 
		SELECT 
		     VSL_CALL_ID	AS VSLCALLID
		    ,MF_DOC_ID		AS CD 
		    ,MF_DOC_ID		AS CD_NM 
		    <choose>
				<when test=' catgCd != null and catgCd != "" and catgCd == "I" '>
					FROM TMT_BL	
				</when>
				<otherwise>
					FROM TMT_SHIPG_NOTE
				</otherwise>
			</choose>
		WHERE VSL_CALL_ID = #{vslCallId}
		<if  test=' catgCd != null and catgCd != "" and catgCd == "I" '> AND CATG_CD != 'V' </if>
		GROUP BY VSL_CALL_ID, MF_DOC_ID
	</select>
	
	<select id="selectTblBlCombo" parameterType="theListOfDamageCheckOfGCParm" resultMap="resultComboList"> 
		  SELECT 
             BL.VSL_CALL_ID
            ,BL.MF_DOC_ID
            ,BL.BL_NO            AS CD
            ,BL.BL_NO            AS CD_NM
            ,BL.CATG_CD          AS CATG_CD
            ,BL.CG_TP_CD
            ,BL.CMDT_GRP_CD
            ,BL.CMDT_CD
            ,ISNULL(BL.CG_WGT, 0) - ISNULL(DMG.MT, 0) AS CG_WGT
		    ,ISNULL(BL.CG_VOL, 0) - ISNULL(DMG.M3, 0) AS CG_MSRMT
		    ,ISNULL(BL.PKG_QTY, 0) - ISNULL(DMG.QTY, 0) AS PKG_QTY
            ,BL.EACH_WGT
            ,BL.EACH_VOL
            ,BL.BL_NO AS UNIT_NO
            ,DT.BRAND_CD AS BRANDCD
       	    ,DT.MODEL_CD AS MODELCD
	        ,(SELECT TOP 1 BRAND_NM FROM TMT_BRAND WHERE BRAND_CD = DT.BRAND_CD) AS BRANDNM
	        ,(SELECT TOP 1 MODEL_NM FROM TMT_BRAND_DTL WHERE BRAND_CD = DT.BRAND_CD AND MODEL_CD = DT.MODEL_CD) AS MODELNM
        FROM TMT_BL BL
        LEFT JOIN TMT_BL_DTL DT
		          ON DT.VSL_CALL_ID = BL.VSL_CALL_ID AND DT.BL_NO = BL.BL_NO
		LEFT JOIN
        ( SELECT    VSL_CALL_ID,
                                 CG_NO,
                                 SUM (PKG_QTY) AS QTY,
                                 SUM (CG_WGT) AS MT,
                                 SUM (CG_VOL) AS M3
                            FROM TMT_DAMAGE_CHECK
                           WHERE VSL_CALL_ID = #{vslCallId} AND CHK_LOC = #{locCd} AND CHAS_NO IS NULL
                        GROUP BY VSL_CALL_ID, CG_NO) DMG ON BL.VSL_CALL_ID = DMG.VSL_CALL_ID
          AND BL.BL_NO = DMG.CG_NO
        WHERE BL.VSL_CALL_ID = #{vslCallId}
          AND BL.MF_DOC_ID = #{masterBlNo}
          AND BL.CATG_CD != 'V'
          	<if test="blNo != null and blNo != ''">
                AND BL.BL_NO = #{blNo}
           	</if>
	</select>
	
	<select id="selectTblSnCombo" parameterType="theListOfDamageCheckOfGCParm" resultMap="resultComboList"> 
		  SELECT   SN.VSL_CALL_ID,
			       SN.MF_DOC_ID,
			       SN.CATG_CD,
			       SN.SHIPG_NOTE_NO CD,
			       SN.SHIPG_NOTE_NO CD_NM,
			       SN.CG_TP_CD,
			       SN.CMDT_GRP_CD,
			       SN.CMDT_CD,
			       ISNULL(SN.CG_WGT, 0) - ISNULL(DMG.MT, 0) AS CG_WGT,
			       ISNULL(SN.CG_VOL, 0) - ISNULL(DMG.M3, 0) AS CG_MSRMT,
			       ISNULL(SN.PKG_QTY, 0) - ISNULL(DMG.QTY, 0) AS PKG_QTY,
			       SN.EACH_WGT,
			       SN.EACH_VOL,
			       SN.SHIPG_NOTE_NO AS UNIT_NO,
			       DT.BRAND_CD AS BRANDCD,
		       	   DT.MODEL_CD AS MODELCD,
			       (SELECT TOP 1 BRAND_NM FROM TMT_BRAND WHERE BRAND_CD = DT.BRAND_CD) AS BRANDNM,
			       (SELECT TOP 1 MODEL_NM FROM TMT_BRAND_DTL WHERE BRAND_CD = DT.BRAND_CD AND MODEL_CD = DT.MODEL_CD) AS MODELNM
			  FROM TMT_SHIPG_NOTE SN
			  LEFT JOIN TMT_SHIPG_NOTE_DTL DT
		          ON     SN.VSL_CALL_ID = DT.VSL_CALL_ID
		             AND SN.SHIPG_NOTE_NO = DT.SHIPG_NOTE_NO
		            LEFT JOIN 
			       (  SELECT VSL_CALL_ID,
			                 CG_NO,
			                 SUM (PKG_QTY) AS QTY,
                             SUM (CG_WGT) AS MT,
                             SUM (CG_VOL) AS M3
			            FROM TMT_DAMAGE_CHECK
			           WHERE VSL_CALL_ID = #{vslCallId} AND CHK_LOC = #{locCd} AND CHAS_NO IS NULL
			        GROUP BY VSL_CALL_ID, CG_NO) DMG ON SN.VSL_CALL_ID = DMG.VSL_CALL_ID  AND SN.SHIPG_NOTE_NO = DMG.CG_NO
			 WHERE     SN.VSL_CALL_ID = #{vslCallId}
			       AND SN.MF_DOC_ID = #{bookingNo}
			       <if test="snNo != null and snNo != ''">
		                AND SN.SHIPG_NOTE_NO = #{snNo}
		           </if>
	</select>
	
	<select id="selectTblDamageCheckDetailItems"  parameterType="theListOfDamageCheckOfGCParm" resultMap="resultGCDmgDtlDmgMap">
			SELECT    /* CargoDamageCheck.getGCDmgDtlDmgItems */
                DM.VSL_CALL_ID,
                CASE 
			        WHEN DM.CATG_CD = 'I' THEN (SELECT TOP 1 MF_DOC_ID FROM TMT_BL WHERE BL_NO = DM.CG_NO)
			        WHEN DM.CATG_CD = 'E' THEN (SELECT TOP 1 MF_DOC_ID FROM TMT_SHIPG_NOTE WHERE SHIPG_NOTE_NO = DM.CG_NO)
			    END AS MF_DOC_ID,
                DM.CATG_CD catgCd,
                DM.CG_NO cgNo,
                DM.PKG_QTY dmgQty,
                DM.CG_WGT dmgMt,
                DM.CG_VOL dmgM3,
                CONVERT(VARCHAR, DM.CHK_DT, 103) AS checkedDt,           
                DM.DMG_PART dmgPart,
                dbo.F_CM_CODE_NM('MT', 'DMGCHK', DM.DMG_PART) AS dmgPartNm,
                DM.DMG_LEVEL dmgLevel,
                dbo.F_CM_CODE_NM('MT', 'DMGCHK', DM.DMG_LEVEL) AS dmgLevelNm,                
                DM.RMK,
                <!-- DM.DMG_DESC, -->
                 <!-- (SELECT TOP 1 S_CD_NM
				     FROM TMT_CD_MSTD 
				     WHERE M_CD = 'DMGGCCHK' 
				       AND L_CD = 'MT' AND S_CD = DM.DMG_DESC) dmgDescNm, -->
				<!--DM.REG_NO, -->
                DM.CHK_LOC locCd,
                DM.CHAS_NO,
                DM.BRAND_CD,
                DM.MODEL_CD                                                
        FROM    TMT_DAMAGE_CHECK DM               
        WHERE   DM.VSL_CALL_ID = #{vslCallId}
                AND DM.CG_NO = #{cgNo}
                ORDER BY SEQ
	</select>
	
	<insert id="insertTblDamageCheckDetailItems" parameterType="theListOfDamageCheckOfGCItem">
		<selectKey order="BEFORE" resultType="String" keyProperty="seq">
			SELECT
			   NVL(MAX(DC.SEQ), 0) + 1 AS SEQ
			FROM
			    TMT_DAMAGE_CHECK DC
			WHERE
			    DC.VSL_CALL_ID = #{vslCallId}
			    AND CATG_CD = #{catgCd}
			    AND CG_NO = #{cgNo})
			    <!-- <choose>
					<when test=' cgTpCd != null and cgTpCd != "" and cgTpCd == "RCV" '>
				    	AND CHAS_NO = #{unitNo}
				   	</when>
				   	<when test=' cgTpCd != null and cgTpCd != "" and cgTpCd != "RCV" '>
				    	AND CHAS_NO IS NULL
				   	</when>
				</choose> -->
		</selectKey>
		
		INSERT INTO TMT_DAMAGE_CHECK (
		    VSL_CALL_ID
		   ,VSL_CD
		   ,CALL_SEQ
		   ,CALL_YEAR
		   ,CG_NO
		   ,CHAS_NO
		   ,SEQ
		   ,IX_CD
		   ,CATG_CD
		   ,DMG_CHK
		   ,CHK_LOC
		   ,DMG_PART
		   ,DMG_LEVEL
		   ,DMG_DESC
		   ,QTY
  		   ,MT
  		   ,M3
  		   <!-- ,JOB_NO -->
		   ,INV_CD
		   ,INV_CNT
		   ,CODE_NUM
	       ,CHK_DT
		   ,BRAND_CD
		   ,MODEL_CD
		   ,RMK
		   ,CRT_DT
		   ,CRT_BY
		   ,UPD_DT
		   ,UPD_BY
		) VALUES (
		    #{vslCallId}
		   ,#{vslCd}
		   ,#{callSeq}
		   ,#{callYear}
		   ,DECODE(#{catgCd}, 'I', #{blNo}, 'E', #{snNo})
		   ,#{unitNo}
		   ,#{seq}
		   ,#{ixCd}
		   ,#{catgCd}
		   ,#{dmgChkCd}
		   ,#{locCd}
		   ,#{dmgPart}
		   ,#{dmgLevel}
		   ,#{dmgDesc}
		   ,#{dmgQty}
		   ,#{dmgMt}
		   ,#{dmgM3}
		   <!-- ,#{jobNo} -->
		   ,#{invCd}
		   ,CASE WHEN #{invCnt} IS NULL OR #{invCnt} = '' THEN NULL ELSE CAST(#{invCnt} AS NUMERIC(12,0)) END
		   ,#{cdNum}
		   ,TO_DATE(#{checkedDt}, 'DD/MM/YYYY HH24:MI')
		   ,#{brandCd}
		   ,#{modelCd}
		   ,#{remark}
		   ,SYSDATE
		   ,#{userId}
		   ,SYSDATE
		   ,#{userId}
		)
	</insert>
	
	<update id="updateTblDamageCheckDetailItems" parameterType="theListOfDamageCheckOfGCItem">
		UPDATE TMT_DAMAGE_CHECK	/* theListOfDamageCheckOfGC.updateTblDamageCheckDetailItems */
		   SET
	         DMG_CHK = #{dmgChkCd}
	        ,CHK_LOC = #{locCd}
	        ,DMG_PART = #{dmgPart}
	        ,DMG_LEVEL = #{dmgLevel}
	        ,DMG_DESC = #{dmgDesc}
	        ,QTY = #{dmgQty}
	        ,MT = #{dmgMt}
	        ,M3 = #{dmgM3}
	        ,CHK_DT = TO_DATE(#{checkedDt}, 'DD/MM/YYYY HH24:MI')
	        ,BRAND_CD = #{brandCd}
	        ,MODEL_CD = #{modelCd}
	        ,RMK = #{remark}
	        ,UPD_DT = SYSDATE
	        ,UPD_BY = #{userId}
		WHERE VSL_CALL_ID = #{vslCallId}
		  AND CATG_CD = #{catgCd}
		  AND CG_NO = DECODE(#{catgCd}, 'I', #{blNo}, 'E', #{snNo})
		  AND SEQ = #{seq}
		  <choose>
			<when test=' cgTpCd != null and cgTpCd != "" and cgTpCd == "RCV" '>
		    	AND CHAS_NO = #{unitNo}
		   	</when>
		   	<when test=' cgTpCd != null and cgTpCd != "" and cgTpCd != "RCV" '>
		    	AND CHAS_NO IS NULL
		   	</when>
		</choose>
	</update>
	
	<delete id="deleteTblDamageCheckDetailItems" parameterType="theListOfDamageCheckOfGCItem">
		DELETE TMT_DAMAGE_CHECK
		WHERE VSL_CALL_ID = #{vslCallId}
		  AND CATG_CD = #{catgCd}
		  AND CG_NO = DECODE(#{catgCd}, 'I', #{blNo}, 'E', #{snNo})
		  AND SEQ = #{seq}
		  <choose>
			<when test=' cgTpCd != null and cgTpCd != "" and cgTpCd == "RCV" '>
		    	AND CHAS_NO = #{unitNo}
		   	</when>
		   	<when test=' cgTpCd != null and cgTpCd != "" and cgTpCd != "RCV" '>
		    	AND CHAS_NO IS NULL
		   	</when>
		</choose>
	</delete>
	
	<delete id="deleteTblDamageCheckList">
		DELETE TMT_DAMAGE_CHECK
		WHERE 	VSL_CALL_ID = #{vslCallId}
		    	AND REG_NO = #{regNo}
	</delete>
	
	<select id="selectTheDamageDesc"   parameterType="theListOfDamageCheckOfGCParm"  resultType="theListOfDamageCheckOfGCItem">
		SELECT 	S_CD AS CD,
                S_CD_NM AS cdNm
        FROM TMT_CD_MSTD
        WHERE M_CD = 'DMGGCCHK'
	 </select>
	 
	 <select id="selectTheDamagePartItems" parameterType="theListOfDamageCheckOfGCParm" resultType="theListOfDamageCheckOfGCItem">
		SELECT	/* RoRoDamageCheck.selectTheDamagePartItems */
				S_CD as cd,
				S_CD_NM as cdNm
		FROM    TMT_CD_MSTD 
		       
		WHERE   M_CD = 'DMGCHK' 
				AND S_CD_LGV = 'DMG_PART'
				ORDER BY S_CD_NM
	</select>
	
	<select id="selectTheDamageLevelItems"  parameterType="theListOfDamageCheckOfGCParm" resultType="theListOfDamageCheckOfGCItem">
		SELECT	/* RoRoDamageCheck.selectTheDamageLevelItems */
				S_CD as cd,
				S_CD_NM as cdNm
		FROM    TMT_CD_MSTD 
		       
		WHERE   M_CD = 'DMGCHK' 
				AND S_CD_LGV = 'DMG_LEVEL'
				ORDER BY S_CD_NM
	</select>
	
	<select id="selectUniqueJobNoDamageCheck"   parameterType="theListOfDamageCheckOfGCParm"  resultType="theListOfDamageCheckOfGCItem">
		SELECT 
			JOB_NO as jobNo
		FROM TMT_DAMAGE_CHECK
		WHERE 
			VSL_CALL_ID = #{vslCallId}
			AND CG_NO = #{cgNo}
		GROUP BY 
			VSL_CALL_ID, CG_NO, JOB_NO
	 </select>
	
	<select id="selectJobNoDamageCheck"   parameterType="theListOfDamageCheckOfGCParm"  resultType="theListOfDamageCheckOfGCItem">
		<if test='searchType == "UPDATE"'>
	        SELECT TOP 1 JOB_NO AS JOBNO 
	        FROM TMT_DAMAGE_CHECK 
	        WHERE VSL_CALL_ID = #{vslCallId} 
	          AND CG_NO = #{cgNo}
	    </if>
	
	    <if test='searchType == "INSERT"'>
	        SELECT 
	            ISNULL(
	                (SELECT TOP 1 JOB_NO 
	                 FROM TMT_DAMAGE_CHECK 
	                 WHERE VSL_CALL_ID = #{vslCallId} 
	                   AND CG_NO = #{cgNo}),
	                'J' + FORMAT(GETDATE(), 'yyMMdd') +
	                ISNULL(
	                    (SELECT RIGHT('000000000' + CAST(CAST(SUBSTRING(MAX(JOB_NO), 8, 9) AS INT) + 1 AS VARCHAR(9)), 9)
	                     FROM TMT_DAMAGE_CHECK 
	                     WHERE SUBSTRING(JOB_NO, 1, 7) = 'J' + FORMAT(GETDATE(), 'yyMMdd')),
	                    '000000001')
	            ) AS JOBNO
	    </if>
	 </select>
	 
	 <!-- <insert id="insertDamageCheck" parameterType="theListOfDamageCheckOfGCItem">
		INSERT INTO TMT_DAMAGE_CHECK (
		   VSL_CALL_ID
		   ,VSL_CD
		   ,CALL_SEQ
		   ,CALL_YEAR
		   ,CG_NO
		   ,CHAS_NO 
		   ,SEQ
		   ,IX_CD
		   ,CATG_CD
		   ,DMG_CHK
		   ,CHK_LOC
		   ,DMG_PART
		   ,DMG_LEVEL
		   ,PKG_QTY
  		   ,CG_WGT
  		   ,CG_VOL
  		   ,JOB_NO
		  ,INV_CD
		  ,INV_CNT
		  ,CODE_NUM
	       ,CHK_DT
		  ,BRAND_CD
		  ,MODEL_CD
		   ,RMK
		   ,CRT_DT
		   ,CRT_BY
		   ,UPDATE_TIME
		   ,STAFF_CD
		   ,REG_NO
		   ,DMG_DESC
		  
		) VALUES (
		   #{vslCallId}
		   ,#{vslCd}
		   ,#{callSeq}
		   ,#{callYear}
		   ,#{cgNo}
		  ,#{unitNo}
		   ,(SELECT NVL(MAX(CAST(SEQ AS INT)),0) + 1 FROM TMT_DAMAGE_CHECK WHERE VSL_CALL_ID = #{vslCallId} AND CG_NO = #{cgNo})
		   ,#{ixCd}
		   ,#{catgCd}
		   ,#{dmgChkCd}
		   ,#{locCd}
		   ,#{dmgPart}
		   ,#{dmgLevel}
		   ,#{dmgQty}
		   ,#{dmgMt}
		   ,#{dmgM3}
		   ,#{jobNo}
		  ,#{invCd}
		  ,CASE WHEN #{invCnt} IS NULL OR #{invCnt} = '' THEN NULL ELSE CAST(#{invCnt} AS NUMERIC(12,0)) END
		  ,#{cdNum}
           ,TO_DATE(#{checkedDt}, 'DD/MM/YYYY HH24:MI')
		  ,#{brandCd}
		  ,#{modelCd}
		   ,#{dmgRemark}
		   ,SYSDATE
		   ,#{userId}
		   ,SYSDATE
		   ,#{userId}
		   ,(SELECT NVL(MAX(CAST(REG_NO AS INT)),0) + 1 FROM TMT_DAMAGE_CHECK)
		   ,#{dmgDesc}
		)
	</insert> -->
	
	<update id="updateDamageCheckDetail" parameterType="theListOfDamageCheckOfGCItem">
		UPDATE TMT_DAMAGE_CHECK
		SET 	CHK_LOC = #{locCd},
				DMG_PART = #{dmgPart},
				DMG_LEVEL = #{dmgLevel},
				CHK_DT = TO_DATE(#{checkedDt}, 'DD/MM/YYYY HH24:MI'),
				RMK = #{dmgRemark},
				UPD_DT = SYSDATE,
				PKG_QTY = #{dmgQty},
				CG_WGT = #{dmgMt},
				CG_VOL = #{dmgM3}, 
				DMG_DESC = #{dmgDesc},
				STAFF_CD = #{userId}
		WHERE 	VSL_CALL_ID = #{vslCallId} 
				AND CG_NO = #{cgNo} 
				AND REG_NO = #{regNo}
				<if test="jobNo != null and jobNo != ''">
					AND JOB_NO = #{jobNo}
				</if>
	</update>
	
	<delete id="deleteUploadFiles" parameterType="theListOfDamageCheckOfGCItem">
		DELETE FROM TMT_FILE_INFO
		WHERE CATG_CD = #{jobNo}
	</delete>
	
	<insert id="insertDamageCheck" parameterType="theListOfDamageCheckOfGCItem">
	  <!--   <selectKey order="BEFORE" resultType="String" keyProperty="jobNo">
	        SELECT 
	            ISNULL((SELECT TOP 1 JOB_NO FROM TMT_DAMAGE_CHECK WHERE VSL_CALL_ID = #{vslCallId} AND CG_NO = #{cgNo}),
	            ('J' + FORMAT(GETDATE(), 'yyMMdd') + 
	            ISNULL((SELECT RIGHT('000000000' + CAST(CAST(SUBSTRING(MAX(JOB_NO), 8, 9) AS INT) + 1 AS VARCHAR(9)), 9)
	            FROM TMT_DAMAGE_CHECK WHERE SUBSTRING(JOB_NO, 1, 7) = 'J' + FORMAT(GETDATE(), 'yyMMdd')), '000000001'))) AS JOBNO
	    </selectKey> -->
	
	    INSERT INTO TMT_DAMAGE_CHECK (
	        VSL_CALL_ID,
	        SHIP_CALL_NO,
	        VSL_CD,
	        CALL_SEQ,
	        CALL_YEAR,
	        MF_DOC_ID,
	        CG_NO,
	        CHAS_NO,
	        SEQ,
	        IX_CD,
	        CATG_CD,
	        DMG_CHK,
	        CHK_LOC,
	        DMG_PART,
	        DMG_LEVEL,
	        PKG_QTY,
	        CG_WGT,
	        CG_VOL,
	        JOB_NO,
	        CHK_DT,
	        BRAND_CD,
	        MODEL_CD,
	        RMK,
	        CRT_DT,
	        CRT_BY,
	        UPDATE_TIME,
	        STAFF_CD,
	        PKG_NO,
	        STEVEDORE_ID,
	        AGENT_ID
	        <!-- REG_NO, -->
	        <!-- DMG_DESC -->
	    )
	    VALUES (
	        #{vslCallId},
	        #{scn},
	        #{vslCd},
	        #{callSeq},
	        #{callYear},
	        #{mfDocId},
	        #{cgNo},
	        #{unitNo},
	        (SELECT ISNULL(MAX(CAST(SEQ AS INT)), 0) + 1 
	        	FROM 
	        		TMT_DAMAGE_CHECK 
	        	WHERE 
	        		VSL_CALL_ID = #{vslCallId} 
	        		AND CG_NO = #{cgNo}		
	        ),
	        #{ixCd},
	        #{catgCd},
	        #{dmgChkCd},
	        #{locCd},
	        #{dmgPart},
	        #{dmgLevel},
	        #{dmgQty},
	        #{dmgMt},
	        #{dmgM3},
	        #{jobNo},
	        CONVERT(DATETIME, #{checkedDt}, 103),
	        #{brandCd},
	        (SELECT TOP 1 MODEL_CD FROM TMT_BRAND_DTL WHERE MODEL_NM = #{modelCd}),
	        #{dmgRemark},
	        GETDATE(),
	        #{userId},
	        GETDATE(),
	        #{userId},
	        #{pkgNo},
	        #{stevedoreId},
	        #{agentId}
	        <!-- (SELECT ISNULL(MAX(CAST(REG_NO AS INT)), 0) + 1 FROM TMT_DAMAGE_CHECK), -->
	        <!-- #{dmgDesc} -->
	    )
	</insert>

		<update id="updateDamageCheck"  parameterType="theListOfDamageCheckOfGCItem">
			UPDATE TMT_DAMAGE_CHECK
			SET 	CHK_LOC = #{locCd},
					DMG_PART = #{dmgPart},
					DMG_LEVEL = #{dmgLevel},
					CHK_DT = CONVERT(DATETIME, #{checkedDt}, 103),
					RMK = #{dmgRemark},
					UPDATE_TIME = GETDATE(),
					PKG_QTY = #{dmgQty},
					CG_WGT = #{dmgMt},
					CG_VOL = #{dmgM3}, 
					STAFF_CD = #{userId}
			WHERE 	VSL_CALL_ID = #{vslCallId} 
					AND CG_NO = #{cgNo}
					AND JOB_NO = #{jobNo}
					AND SEQ = #{seq}
		</update>
		
		<delete id="deleteItems" parameterType="theListOfDamageCheckOfGCItem">
			DELETE FROM TMT_DAMAGE_CHECK 
			 WHERE VSL_CALL_ID= #{vslCallId}
			    AND REG_NO = #{regNo}
				<if test="jobNo != null and jobNo != ''">
						AND JOB_NO = #{jobNo}
				</if>
		</delete>
		
		<delete id="deleteDamageCheck" parameterType="theListOfDamageCheckOfGCItem">
			DELETE FROM TMT_DAMAGE_CHECK 
			 WHERE VSL_CALL_ID= #{vslCallId}
			    AND CG_NO = #{cgNo}
				AND SEQ = #{seq}
				AND JOB_NO = #{jobNo}
		</delete>
		
		<select id="searchDamageCheck" parameterType="theListOfDamageCheckOfGCParm" resultType="theListOfDamageCheckOfGCItem">
			SELECT	/* DamageDimensionCheckMap.searchGateInSDonoInfo */
					DMG_PART dmgPart,
					(SELECT	S_CD_DESC
					FROM    TMT_CD_MSTD 
					WHERE   M_CD = 'DMGCHK' 
						AND S_CD_LGV = 'DMG_PART' AND S_CD = DMG_PART) dmgPartNm,
					DMG_LEVEL dmgLevel,
					(SELECT	S_CD_DESC
					FROM    TMT_CD_MSTD 
					WHERE   M_CD = 'DMGCHK' 
						AND S_CD_LGV = 'DMG_LEVEL' AND S_CD = DMG_LEVEL) dmgLevelNm,
					CASE CHK_LOC
				        WHEN 'VSL' THEN 'Vessel'
				        WHEN 'YARD' THEN 'Yard'
				        WHEN 'GATE' THEN 'Gate'
				        ELSE CHK_LOC
				    END AS locNm,
					CHK_LOC	locCd,
					CONVERT(VARCHAR, CHK_DT, 103) AS checkedDt,
					RMK dmgRemark,
					PKG_QTY dmgQty,
					CG_WGT dmgMt,
					CG_VOL dmgM3,
					VSL_CD vslCd,
					CALL_YEAR callYear,
					CALL_SEQ callSeq,
					VSL_CALL_ID vslCallId,
					JOB_NO jobNo,
					<!-- DMG_DESC dmgDesc,
					(SELECT TOP 1 S_CD_NM
				     FROM TMT_CD_MSTD
				     WHERE M_CD = 'DMGGCCHK'
				       AND L_CD = 'MT' AND S_CD = DMG_DESC) AS dmgDescNm,
					REG_NO regNo, -->
					CG_NO cgNo,
					CHAS_NO unitNo,
	                BRAND_CD brandCd,
	                MODEL_CD modelCd,
	                CONVERT(VARCHAR, CRT_DT, 103) AS createDt,
			        CRT_BY createBy,
			        CONVERT(VARCHAR, UPDATE_TIME, 103) AS updateDt,
			        STAFF_CD updateBy,
			        SEQ seq,
			        STEVEDORE_ID stevedoreId,
			        AGENT_ID agentId,
			        PKG_NO pkgNo
			FROM TMT_DAMAGE_CHECK
			WHERE   VSL_CALL_ID = #{vslCallId}
					<if test="jobNo != null and jobNo != ''">
						AND JOB_NO = #{jobNo}
					</if>
					<if test="cgNo != null and cgNo != ''">
						AND CG_NO = #{cgNo}
					</if>
		</select>
	
</mapper>