<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="vorDryBreakBulk">
	
	<!--  ################ Query Statement Define ######################################### -->
	<select id="selectVesselInfomation"  parameterType="vorDryBreakBulkParm" resultType="vorDryBreakBulkItem">
		SELECT 	/* vorDryBreakBulk.xml  selectVesselInfomation CT104 */
				A.VSL_NM      						   AS VSLNM,	  		         		       
				     A.VSL_TP      						   AS VSLTP,	
				     F_CM_012('VC', 'VSLTP', A.VSL_TP) 		AS VSLTPNM,			   
				A.LOA                                   AS LOA,				   
				TO_CHAR (NVL (NVL(C.PST_STA, B.WHARF_MARK_FROM), 0))       AS WHARFMARKFROM,
				TO_CHAR (NVL (NVL(C.PST_END, B.WHARF_MARK_TO), 0))        AS WHARFMARKTO,
				(SELECT NVL(SUM(CG_WGT), 0) 
				  			FROM   TMT_SHIPG_NOTE 
				  			WHERE  VSL_CALL_ID = b.VSL_CALL_ID
				  			)                        			AS LOADCARGOQTY,
				(SELECT   NVL(SUM(CG_WGT), 0) 
				    			FROM     TMT_BL 
				    			WHERE VSL_CALL_ID = b.VSL_CALL_ID
				    			)                       			AS DISCHCARGOQTY,
				A.VSL_CD                                AS VSLCD,
				TO_CHAR(B.ATD,'DD/MM/YYYY HH24:MI')            AS ATD,
				TO_CHAR(B.ETA,'DD/MM/YYYY HH24:MI')             AS ETA,
				TO_CHAR(B.ETW,'DD/MM/YYYY HH24:MI') 	  		   AS ETW,
				TO_CHAR(B.ATA,'DD/MM/YYYY HH24:MI')             AS ATA,
				TO_CHAR(B.ATU,'DD/MM/YYYY HH24:MI')             AS ATU,
				B.ARRV_SA_ID							   AS SA,
				TO_CHAR(B.ATW,'DD/MM/YYYY HH24:MI')			   AS ATW,
				TO_CHAR(B.ATC,'DD/MM/YYYY HH24:MI')			   AS ATC,
				TO_CHAR(B.ATB,'DD/MM/YYYY HH24:MI')			   AS ATB,
				B.BERTH_LOC										AS BERTHLOC,
				B.CARGO_TP_MPTS									AS CARGOTP				   
		FROM 	TMT_VSL_PART A, TMT_VSL_SCH B, TMT_BERTH_LOC C
		WHERE 	A.VSL_CD = B.VSL_CD	  		   
		   		AND B.VSL_CALL_ID = #{vslCallId}
		   		AND B.BERTH_LOC = C.BERTH_CD(+)			   	   
	</select>
	
	<select id="selectVORList"  parameterType="vorDryBreakBulkParm" resultType="vorListItem">
		SELECT 
				A.VSL_CALL_ID AS VSLCALLID,
				'vorList' AS SEARCHTYPE,
		    	TO_CHAR(TO_DATE(A.WORK_YMD, 'YYYYMMDD'), 'DD/MM/YYYY') AS WORKYMD,
		    	A.SHFT_ID AS SHFTID,
		    	(SELECT SHFT_NM FROM TMT_SHFT SHFT WHERE SHFT.SHFT_ID = A.SHFT_ID AND ROWNUM = 1) AS SHFTNM,
		    	F_GET_VOR_HATCHS(A.VSL_CALL_ID, A.WORK_YMD, A.SHFT_ID) HATCHNO,
		    	(SELECT SUM(CASE  WHEN D.ROLE_CD ='MS' 
						THEN D.WKER_QTY ELSE 0 END)
		     		FROM TMT_VSL_OPE_RPT_DTL D
		     		WHERE A.VSL_CALL_ID = D.VSL_CALL_ID AND A.WORK_YMD = D.WORK_YMD AND A.SHFT_ID = D.SHFT_ID) SUPERVISOR,
		    	F_GET_VOR_STEVEDORE(A.VSL_CALL_ID, A.WORK_YMD, A.SHFT_ID) WORKCOMP,
		    	A.RMK,
		    	A.VERIFY_STATUS AS VERIFYST,
         		A.VERIFY_BY AS VERIFYBY,
         		TO_CHAR(a.verify_date,'DD/MM/YYYY HH24:MI')  AS verifydt,
         		to_number(TO_CHAR( ( nvl(F_GET_WGT_IMPORT(a.vsl_call_id, a.shft_id, a.work_ymd),0) + 
       			nvl( F_GET_WGT_EXPORT (a.vsl_call_id, a.shft_id, a.work_ymd),0) )))AS impWgt
		FROM 	TMT_VSL_OPE_RPT A
		WHERE 	A.VSL_CALL_ID = #{vslCallId}
		ORDER BY A.WORK_YMD, SHFTNM

	</select>
	
	<select id="selectHandlingList"  parameterType="vorDryBreakBulkParm" resultType="vorListItem">
		SELECT 
				A.HATCH_NO HATCHNO, 
				MAX(A.EQ_NO) EQFACNO,
               	TO_CHAR(MIN(A.WORK_ST_DT), 'DD/MM/YYYY HH24:MI') WORKSTDT, 
               	TO_CHAR(MAX(A.WORK_END_DT), 'DD/MM/YYYY HH24:MI') WORKENDDT, 
               	SUM(B.CG_WGT) LOADING,
               	SUM(C.CG_WGT) DISCHARGING,
               	F_CM_012('MT', 'VSLSHFTTP', MAX(D.SFT_TP)) SHIFTING
		FROM 	TMT_JOB A,
               	(SELECT JOB_NO, CG_WGT, HATCH_NO FROM TMT_JOB 
                   WHERE VSL_CALL_ID = #{vslCallId} 
                       AND JOB_TP_CD = 'LD' 
                       AND JOB_PURP_CD IN ('WV','GV','AV')) B,
               	(SELECT JOB_NO, CG_WGT, HATCH_NO FROM TMT_JOB 
                   WHERE VSL_CALL_ID = #{vslCallId} 
                       AND JOB_TP_CD = 'DS' 
                       AND JOB_PURP_CD IN ('VA','VG','VB','AB')) C,
                (SELECT HATCH_NO, MAX(SFT_TP) SFT_TP FROM TMT_CG_SHFT
                   WHERE VSL_CALL_ID = #{vslCallId}
                   GROUP BY HATCH_NO) D
		WHERE 	A.VSL_CALL_ID = #{vslCallId}
				AND A.HATCH_NO IS NOT NULL
				AND A.HATCH_NO = B.HATCH_NO (+)
				AND A.JOB_NO = B.JOB_NO (+)
				AND A.HATCH_NO = C.HATCH_NO (+)
				AND A.JOB_NO = C.JOB_NO (+)
				AND A.HATCH_NO = D.HATCH_NO (+)
           GROUP BY A.HATCH_NO, A.EQ_NO
           ORDER BY A.HATCH_NO
	</select>
	
	<select id="selectShiftingList"  parameterType="vorDryBreakBulkParm" resultType="vorListItem">
		SELECT  A.VSL_CALL_ID           AS VSLCALLID,
		        NVL(A.REQR, ' ')        AS REQR,
				NVL(TO_CHAR(A.ATU_DT, 'DD/MM/YYYY HH24:MI'),' ')     AS ATUDT,
				NVL(TO_CHAR(A.ATB_DT, 'DD/MM/YYYY HH24:MI'),' ')     AS ATBDT,
				NVL(TO_CHAR(A.ATW_DT, 'DD/MM/YYYY HH24:MI'),' ')     AS ATWDT,
				NVL(TO_CHAR(A.ATC_DT, 'DD/MM/YYYY HH24:MI'),' ')     AS ATCDT,
<!-- 				DECODE(NVL(A.CHAG_YN,'N'),'N','false','true')        AS CHAGYN, -->
				NVL(A.WHARF_MARK_FM, 0)  AS MARKFM,
				NVL(A.WHARF_MARK_TO, 0)  AS MARKTO, 
				(SELECT  BERTH_NM FROM TMT_BERTH_LOC WHERE BERTH_CD = A.NX_BERTH_NO AND (LOC_CD = 'BBT' OR LOC_CD='CT')) AS BERTHNM,	
							
				NVL(A.RSN_CD,' ')        AS RSNCD,
				NVL(A.RMK,' ')           AS RMK,
				A.NX_BERTH_NO    AS NXBERTHNO,
				A.SEQ            AS SEQ,
				(SELECT S_CD_NM FROM TMT_CD_MSTD WHERE L_CD = 'MT' AND M_CD = 'SFTRSN' AND S_CD_USE = 'Y' AND S_CD = A.RSN_CD ) AS RSNCDNM
		FROM 	TMT_VSL_SHFT A
		WHERE 	VSL_CALL_ID = #{vslCallId}	
	</select>
	
	<select id="selectBankingList"  parameterType="vorDryBreakBulkParm" resultType="vorListItem">
		SELECT 	A.VSL_CALL_ID AS VSLCALLID,
				A.SEQ AS SEQ,
				A.DBL_BNK_DIV_CD AS DBLBNKDIV,
				A.DBL_BNK_SHIP1 AS DBLBNKSHIP,
				NVL2(A.ST_DT,TO_CHAR(A.ST_DT, 'DD/MM/YYYY HH24:MI'),' ')	AS STARTDATE,
				NVL2(A.END_DT,TO_CHAR(A.END_DT, 'DD/MM/YYYY HH24:MI'),' ')  AS ENDDATE,
				(SELECT S_CD_NM FROM TMT_CD_MSTD WHERE L_CD = 'MT' AND M_CD = 'DBLBNKDIV' AND S_CD = A.DBL_BNK_DIV_CD) AS DBLBNKDIVNM
		FROM 	TMT_DBL_BNK A
		WHERE 	VSL_CALL_ID = #{vslCallId}	
	</select>
	
	<select id="selectShiftedLocList"  parameterType="vorDryBreakBulkParm" resultType="vorListItem">
		SELECT  BERTH_CD  AS BERTHCD,
		        BERTH_NM AS BERTHNM
		FROM 	TMT_BERTH_LOC 
		WHERE 	BERTH_TP IN ('NDJ','EDJ','WRF')
	</select>
	
	<select id="selectDetailOfHandingRpt" parameterType="vorDryBreakBulkParm" resultType="vorDryBreakBulkItem">
		SELECT   
				JB.HATCH_NO HATCHNO, 
		        SN.SHIPG_NOTE_NO SN, 
		        NULL BLNO,
		        MIN (TO_CHAR(JB.WORK_ST_DT, 'DD/MM/YYYY HH24:MI')) STDT, 
		        MIN (TO_CHAR(JB.WORK_END_DT, 'DD/MM/YYYY HH24:MI')) ENDDT, 
		        MAX(CM.DESCR) CMDTCD,
		        F_CM_012('MT', 'JOBTP', MAX(JB.JOB_TP_CD)) JOBTP,
		        '' TOPCLEAN,
		        SUM(JB.PKG_QTY) PKGQTY,
		        SUM(JB.CG_WGT) WGT,
		        (SELECT LISTAGG(EQ_FAC_NO, ', ') WITHIN GROUP (ORDER BY EQ_FAC_NO)
		         FROM(
		          SELECT DISTINCT OD.EQ_FAC_NO
		            FROM TMT_VSL_OPE_RPT_DTL OD
		           WHERE     OD.vsl_call_id = #{vslCallId}
		                <if test="workYmd != null and workYmd != ''">
		                AND OD.work_ymd = TO_CHAR (TO_DATE (#{workYmd}, 'DD/MM/YYYY'), 'YYYYMMDD')
		                </if>
		                <if test="shftId != null and shftId != ''">
		                AND OD.SHFT_ID = #{shftId}
		                </if>
		                AND OD.HATCH_NO = JB.HATCH_NO 
		                AND OD.EQ_FAC_NO IS NOT NULL))AS eqFacNo
		FROM 	TMT_GR A, TMT_JOB JB, TMT_SHIPG_NOTE SN, TMT_CMDT CM
		WHERE 	A.VSL_CALL_ID =  #{vslCallId}
				<if test="workYmd != null and workYmd != ''">
					AND TO_CHAR(F_GET_SHFT_DATE(JB.WORK_ST_DT), 'DD/MM/YYYY') = #{workYmd}
				</if>
				<if test="shftId != null and shftId != ''">
					AND F_GET_SHIFT_CD(JB.WORK_ST_DT) = #{shftId}
				</if>	
				AND SN.VSL_CALL_ID = A.VSL_CALL_ID
				AND SN.SHIPG_NOTE_NO = A.SHIPG_NOTE_NO
				AND A.GR_NO = JB.CG_NO
				AND A.VSL_CALL_ID = JB.VSL_CALL_ID
				AND JB.HATCH_NO IS NOT NULL
				AND JB.JOB_TP_CD IN ('LD')
		      	AND ((JB.DELV_TP_CD IN ( 'I') AND jb.JOB_PURP_CD = 'AV') OR ((JB.DELV_TP_CD IN ( 'D') AND jb.JOB_PURP_CD = 'GV')) )
		     	AND A.CMDT_CD = CM.CMDT_CD (+)
		GROUP BY SN.SHIPG_NOTE_NO, JB.HATCH_NO, JB.JOB_TP_CD
		
		UNION
		SELECT  JB.HATCH_NO HATCHNO, 
		        NULL SN, 
		        A.BL_NO, 
		        MIN (TO_CHAR(JB.WORK_ST_DT, 'DD/MM/YYYY HH24:MI')) STDT, 
		        MIN (TO_CHAR(JB.WORK_END_DT, 'DD/MM/YYYY HH24:MI')) ENDDT, 
		        MAX(CM.DESCR) CMDTCD,
		        F_CM_012('MT', 'JOBTP', MAX(JB.JOB_TP_CD)) JOBTP,
		        '' TOPCLEAN,
		        SUM(JB.PKG_QTY) PKGQTY,
		        SUM(JB.CG_WGT) WGT,
		        (SELECT LISTAGG(EQ_FAC_NO, ', ') WITHIN GROUP (ORDER BY EQ_FAC_NO)
		         FROM(
		          SELECT DISTINCT OD.EQ_FAC_NO
		            FROM TMT_VSL_OPE_RPT_DTL OD
		           WHERE     OD.vsl_call_id = #{vslCallId}
		                <if test="workYmd != null and workYmd != ''">
		                AND OD.work_ymd = TO_CHAR (TO_DATE (#{workYmd}, 'DD/MM/YYYY'), 'YYYYMMDD')
		                </if>
		                <if test="shftId != null and shftId != ''">
		                AND OD.SHFT_ID = #{shftId}
		                </if>
		                AND OD.HATCH_NO = JB.HATCH_NO 
		                AND OD.EQ_FAC_NO IS NOT NULL))AS eqFacNo
		FROM 	TMT_BL A, TMT_JOB JB, TMT_CMDT CM
		WHERE 	A.VSL_CALL_ID =  #{vslCallId}			     
				<if test="workYmd != null and workYmd != ''">
					AND TO_CHAR(F_GET_SHFT_DATE(JB.WORK_ST_DT), 'DD/MM/YYYY') = #{workYmd}
				</if>
				<if test="shftId != null and shftId != ''">
					AND F_GET_SHIFT_CD(JB.WORK_ST_DT) = #{shftId}	
				</if>
						
				AND A.BL_NO = JB.CG_NO
				AND A.VSL_CALL_ID = JB.VSL_CALL_ID
				AND JB.HATCH_NO IS NOT NULL
				AND JB.JOB_TP_CD IN ( 'DS')
		     	AND ((JB.DELV_TP_CD IN ( 'I') AND jb.JOB_PURP_CD = 'VA') OR ((JB.DELV_TP_CD IN ( 'D') AND jb.JOB_PURP_CD = 'VG')) )
		     	AND A.CMDT_CD = CM.CMDT_CD (+)
		GROUP BY A.BL_NO, JB.HATCH_NO, JB.JOB_TP_CD
		ORDER BY HATCHNO, SN, BLNO
	</select>
	
	<select id="selectDailyRosterRpt" parameterType="vorDryBreakBulkParm" resultType="vorDryBreakBulkItem">			
		SELECT	A.VSL_CALL_ID                                          AS VSLCALLID,
               	TO_CHAR(TO_DATE(A.WORK_YMD, 'YYYYMMDD'), 'DD/MM/YYYY') AS WORKYMD,
               	A.SHFT_ID                                              AS SHFTID,    
               	A.SEQ         AS SEQ,
               	A.DIV_CD      AS DIVCD,
               	SUBSTR(A.RS_NM,0, 2) AS ROLECD,
               	A.CNRT_CD     AS DRIVERID,
               	A.WORK_LOC_TP AS WORKLOC
		FROM 	TMT_VSL_SVC_RPT A, TMT_VSL_OPE_RPT B
		WHERE 	A.VSL_CALL_ID = B.VSL_CALL_ID
		  		AND A.WORK_YMD = B.WORK_YMD
				AND A.SHFT_ID = B.SHFT_ID			  
				AND A.VSL_CALL_ID = #{vslCallId}
				AND A.WORK_YMD = TO_CHAR(TO_DATE(#{workYmd}, 'DD/MM/YYYY'), 'YYYYMMDD')
				AND A.SHFT_ID = #{shftId}
	</select>
	
	<select id="selectDRStevedoreList" parameterType="vorDryBreakBulkParm" resultType="vorDryBreakBulkItem">
		SELECT 
				1 od,
			    'Supervisor' ROLECDNM,
			    NVL(SUM(WKER_QTY),0) WKERQTY
		FROM 	TMT_VSL_OPE_RPT_DTL
		WHERE 	VSL_CALL_ID = #{vslCallId}
			  	AND WORK_YMD = TO_CHAR(TO_DATE(#{workYmd}, 'DD/MM/YYYY'), 'YYYYMMDD')
			  	AND SHFT_ID = #{shftId}
			    AND CG_TP_CD = 'BBK'
			    AND RS_DIV_CD = 'WC'
			    AND ROLE_CD = 'MS'
		UNION
		SELECT 
			    2 od,
			    'Winch Men' ROLECDNM,
			    NVL(SUM(WKER_QTY),0) WKERQTY
		FROM 	TMT_VSL_OPE_RPT_DTL
		WHERE 	VSL_CALL_ID = #{vslCallId}
			  	AND WORK_YMD = TO_CHAR(TO_DATE(#{workYmd}, 'DD/MM/YYYY'), 'YYYYMMDD')
			  	AND SHFT_ID = #{shftId}
			    AND CG_TP_CD = 'BBK'
			    AND RS_DIV_CD = 'WC'
			    AND ROLE_CD = 'WM'
		UNION
		SELECT 
			    3 od,
			    'Gen.Workers' ROLECDNM,
			    NVL(SUM(WKER_QTY),0) WKERQTY
		FROM 	TMT_VSL_OPE_RPT_DTL
		WHERE 	VSL_CALL_ID = #{vslCallId}
			  	AND WORK_YMD = TO_CHAR(TO_DATE(#{workYmd}, 'DD/MM/YYYY'), 'YYYYMMDD')
			  	AND SHFT_ID = #{shftId}
			    AND CG_TP_CD = 'BBK'
			    AND RS_DIV_CD = 'WC'
			    AND ROLE_CD = 'GW'
		UNION
		SELECT 
			    4 od,
			    'Non Tonnage' ROLECDNM,
			    NVL(SUM(WKER_QTY),0) WKERQTY
		FROM 	TMT_VSL_OPE_RPT_DTL
		WHERE 	VSL_CALL_ID = #{vslCallId}
			  	AND WORK_YMD = TO_CHAR(TO_DATE(#{workYmd}, 'DD/MM/YYYY'), 'YYYYMMDD')
			  	AND SHFT_ID = #{shftId}
			    AND CG_TP_CD = 'BBK'
			    AND RS_DIV_CD = 'WC'
			    AND ROLE_CD = 'TW'
		UNION
		SELECT 
			    5 od,
			    'Forklift Driver' ROLECDNM,
			    NVL(COUNT(*),0) WKERQTY
		FROM 	TMT_VSL_SVC_RPT
		WHERE 	VSL_CALL_ID = #{vslCallId}
			  	AND WORK_YMD = TO_CHAR(TO_DATE(#{workYmd}, 'DD/MM/YYYY'), 'YYYYMMDD')
			  	AND SHFT_ID = #{shftId}
			    AND CG_TP_CD = 'BBK'
			    AND DIV_CD = 'FL'
	</select>
	
	<select id="selectDRTrimmingList" parameterType="vorDryBreakBulkParm" resultType="vorDryBreakBulkItem">
		SELECT 
			    1 od,
			    'Signal Men' ROLECDNM,
			    NVL(SUM(WKER_QTY),0) WKERQTY
		FROM 	TMT_VSL_OPE_RPT_DTL
		WHERE 	VSL_CALL_ID = #{vslCallId}
			  	AND WORK_YMD = TO_CHAR(TO_DATE(#{workYmd}, 'DD/MM/YYYY'), 'YYYYMMDD')
			  	AND SHFT_ID = #{shftId}
			    AND CG_TP_CD = 'DBK'
			    AND RS_DIV_CD = 'WC'
			    AND ROLE_CD = 'SM'
		UNION
		SELECT 
			    2 od,
			    'Deck Men' ROLECDNM,
			    NVL(SUM(WKER_QTY),0) WKERQTY
		FROM 	TMT_VSL_OPE_RPT_DTL
		WHERE 	VSL_CALL_ID = #{vslCallId}
			  	AND WORK_YMD = TO_CHAR(TO_DATE(#{workYmd}, 'DD/MM/YYYY'), 'YYYYMMDD')
			  	AND SHFT_ID = #{shftId}
			    AND CG_TP_CD = 'DBK'
			    AND RS_DIV_CD = 'WC'
			    AND ROLE_CD = 'DM'
		UNION
		SELECT 
			    3 od,
			    'Hopper Men' ROLECDNM,
			    NVL(SUM(WKER_QTY),0) WKERQTY
		FROM 	TMT_VSL_OPE_RPT_DTL
		WHERE 	VSL_CALL_ID = #{vslCallId}
			  	AND WORK_YMD = TO_CHAR(TO_DATE(#{workYmd}, 'DD/MM/YYYY'), 'YYYYMMDD')
			  	AND SHFT_ID = #{shftId}
			    AND CG_TP_CD = 'DBK'
			    AND RS_DIV_CD = 'WC'
			    AND ROLE_CD = 'HM'
		UNION
		SELECT 
			    4 od,
			    'No. of Workers' ROLECDNM,
			    NVL(SUM(WKER_QTY),0) WKERQTY
		FROM 	TMT_VSL_OPE_RPT_DTL
		WHERE 	VSL_CALL_ID = #{vslCallId}
			  	AND WORK_YMD = TO_CHAR(TO_DATE(#{workYmd}, 'DD/MM/YYYY'), 'YYYYMMDD')
			  	AND SHFT_ID = #{shftId}
			    AND CG_TP_CD = 'DBK'
			    AND RS_DIV_CD = 'WC'
			    AND ROLE_CD = 'GW'
	</select>
	
	<select id="selectEquipmentsRptBulk" parameterType="vorDryBreakBulkParm" resultType="vorDryBreakBulkItem">							
		SELECT 
			    1 OD,
			    'BG1' EQFACNM, 
			    DECODE(COUNT(*), 0, 'false', 'true') USEYN
		FROM 	TMT_VSL_SVC_RPT A, TMT_EQ_FAC B
		WHERE 	A.VSL_CALL_ID = #{vslCallId}
			  	AND A.WORK_YMD = TO_CHAR(TO_DATE(#{workYmd}, 'DD/MM/YYYY'), 'YYYYMMDD')
			  	AND A.SHFT_ID = #{shftId}
			    AND A.RS_NM = 'BG0001'
			    AND A.RS_NM = B.EQ_FAC_NO
			    AND B.VLD_YN = 'Y'
		UNION
		SELECT 
			    2 OD,
			    'BG2' EQFACNM, 
			    DECODE(COUNT(*), 0, 'false', 'true') USEYN
		FROM 	TMT_VSL_SVC_RPT A, TMT_EQ_FAC B
		WHERE 	A.VSL_CALL_ID = #{vslCallId}
			  	AND A.WORK_YMD = TO_CHAR(TO_DATE(#{workYmd}, 'DD/MM/YYYY'), 'YYYYMMDD')
			  	AND A.SHFT_ID = #{shftId}
			    AND A.RS_NM = 'BG0002'
			    AND A.RS_NM = B.EQ_FAC_NO
			    AND B.VLD_YN = 'Y'
		UNION
		SELECT
			    3 OD, 
			    'LL1' EQFACNM, 
			    DECODE(COUNT(*), 0, 'false', 'true') USEYN
		FROM 	TMT_VSL_SVC_RPT A, TMT_EQ_FAC B
		WHERE 	A.VSL_CALL_ID = #{vslCallId}
			  	AND A.WORK_YMD = TO_CHAR(TO_DATE(#{workYmd}, 'DD/MM/YYYY'), 'YYYYMMDD')
			  	AND A.SHFT_ID = #{shftId}
			    AND A.RS_NM = 'LL0001'
			    AND A.RS_NM = B.EQ_FAC_NO
			    AND B.VLD_YN = 'Y'
		UNION
		SELECT
			    4 OD, 
			    'LL2' EQFACNM, 
			    DECODE(COUNT(*), 0, 'false', 'true') USEYN
		FROM 	TMT_VSL_SVC_RPT A, TMT_EQ_FAC B
		WHERE 	A.VSL_CALL_ID = #{vslCallId}
			  	AND A.WORK_YMD = TO_CHAR(TO_DATE(#{workYmd}, 'DD/MM/YYYY'), 'YYYYMMDD')
			  	AND A.SHFT_ID = #{shftId}
			    AND A.RS_NM = 'LL0002'
			    AND A.RS_NM = B.EQ_FAC_NO
			    AND B.VLD_YN = 'Y'
		UNION
		SELECT
			    5 OD, 
			    'LL3' EQFACNM, 
			    DECODE(COUNT(*), 0, 'false', 'true') USEYN
		FROM 	TMT_VSL_SVC_RPT A, TMT_EQ_FAC B
		WHERE 	A.VSL_CALL_ID = #{vslCallId}
			  	AND A.WORK_YMD = TO_CHAR(TO_DATE(#{workYmd}, 'DD/MM/YYYY'), 'YYYYMMDD')
			  	AND A.SHFT_ID = #{shftId}
			    AND A.RS_NM = 'LL0003'
			    AND A.RS_NM = B.EQ_FAC_NO
			    AND B.VLD_YN = 'Y'
		UNION
		SELECT
			    6 OD, 
			    'C/Unloader' EQFACNM, 
			    DECODE(COUNT(*), 0, 'false', 'true') USEYN
		FROM 	TMT_VSL_SVC_RPT A, TMT_EQ_FAC B
		WHERE 	A.VSL_CALL_ID = #{vslCallId}
			  	AND A.WORK_YMD = TO_CHAR(TO_DATE(#{workYmd}, 'DD/MM/YYYY'), 'YYYYMMDD')
			  	AND A.SHFT_ID = #{shftId}
			    AND A.RS_NM = B.EQ_FAC_NO
			    AND B.EQ_TP_CD = 'CU'
			    AND B.VLD_YN = 'Y'
		UNION
		SELECT
			    7 OD, 
			    'Excavator' EQFACNM, 
			    DECODE(COUNT(*), 0, 'false', 'true') USEYN
		FROM 	TMT_VSL_SVC_RPT A, TMT_EQ_FAC B
		WHERE 	A.VSL_CALL_ID = #{vslCallId}
			  	AND A.WORK_YMD = TO_CHAR(TO_DATE(#{workYmd}, 'DD/MM/YYYY'), 'YYYYMMDD')
			  	AND A.SHFT_ID = #{shftId}
			    AND A.RS_NM = B.EQ_FAC_NO
			    AND B.EQ_TP_CD = 'EV'
			    AND B.VLD_YN = 'Y'
		UNION
		SELECT
			    8 OD, 
			    'Shovel' EQFACNM, 
			    DECODE(COUNT(*), 0, 'false', 'true') USEYN
		FROM 	TMT_VSL_SVC_RPT A, TMT_EQ_FAC B
		WHERE 	A.VSL_CALL_ID = #{vslCallId}
			  	AND A.WORK_YMD = TO_CHAR(TO_DATE(#{workYmd}, 'DD/MM/YYYY'), 'YYYYMMDD')
			  	AND A.SHFT_ID = #{shftId}
			    AND A.RS_NM = B.EQ_FAC_NO
			    AND B.EQ_TP_CD = 'SH'
			    AND B.VLD_YN = 'Y'
	</select>
	
	<select id="selectEquipmentsRptBreakBulk" parameterType="vorDryBreakBulkParm" resultType="vorDryBreakBulkItem">							
		SELECT
			    1 OD, 
			    'Ship Crane' EQFACNM, 
			    DECODE(COUNT(*), 0, 'false', 'true') USEYN
		FROM 	TMT_VSL_SVC_RPT A, TMT_EQ_FAC B
		WHERE 	A.VSL_CALL_ID = #{vslCallId}
			  	AND A.WORK_YMD = TO_CHAR(TO_DATE(#{workYmd}, 'DD/MM/YYYY'), 'YYYYMMDD')
			  	AND A.SHFT_ID = #{shftId}
			    AND A.RS_NM = B.EQ_FAC_NO
			    AND B.EQ_TP_CD = 'SR'
			    AND B.VLD_YN = 'Y'
		UNION
		SELECT
			    2 OD, 
			    'Shore Crane' EQFACNM, 
			    DECODE(COUNT(*), 0, 'false', 'true') USEYN
		FROM 	TMT_VSL_SVC_RPT A, TMT_EQ_FAC B
		WHERE 	A.VSL_CALL_ID = #{vslCallId}
			  	AND A.WORK_YMD = TO_CHAR(TO_DATE(#{workYmd}, 'DD/MM/YYYY'), 'YYYYMMDD')
			  	AND A.SHFT_ID = #{shftId}
			    AND A.RS_NM = B.EQ_FAC_NO
			    AND B.EQ_TP_CD = 'SC'
			    AND B.VLD_YN = 'Y'
		UNION
		SELECT
			    3 OD, 
			    'Forklift' EQFACNM, 
			    DECODE(COUNT(*), 0, 'false', 'true') USEYN
		FROM 	TMT_VSL_SVC_RPT A, TMT_EQ_FAC B
		WHERE 	A.VSL_CALL_ID = #{vslCallId}
			  	AND A.WORK_YMD = TO_CHAR(TO_DATE(#{workYmd}, 'DD/MM/YYYY'), 'YYYYMMDD')
			  	AND A.SHFT_ID = #{shftId}
			    AND A.RS_NM = B.EQ_FAC_NO
			    AND B.EQ_TP_CD = 'FL'
			    AND B.VLD_YN = 'Y'
		UNION
		SELECT
			    4 OD, 
			    'Trailer' EQFACNM, 
			    DECODE(COUNT(*), 0, 'false', 'true') USEYN
		FROM 	TMT_VSL_SVC_RPT A, TMT_EQ_FAC B
		WHERE 	A.VSL_CALL_ID = #{vslCallId}
			  	AND A.WORK_YMD = TO_CHAR(TO_DATE(#{workYmd}, 'DD/MM/YYYY'), 'YYYYMMDD')
			  	AND A.SHFT_ID = #{shftId}
			    AND A.RS_NM = B.EQ_FAC_NO
			    AND B.EQ_TP_CD = 'TR'
			    AND B.VLD_YN = 'Y'
	</select>
	
	<select id="selectEquipmentsRptFacility" parameterType="vorDryBreakBulkParm" resultType="vorDryBreakBulkItem">							
		SELECT
			    1 OD, 
			    'Conveyor' EQFACNM, 
			    DECODE(COUNT(*), 0, 'false', 'true') USEYN
		FROM 	TMT_VSL_SVC_RPT A, TMT_EQ_CAPA B
		WHERE 	A.VSL_CALL_ID = #{vslCallId}
			  	AND A.WORK_YMD = TO_CHAR(TO_DATE(#{workYmd}, 'DD/MM/YYYY'), 'YYYYMMDD')
			  	AND A.SHFT_ID = #{shftId}
			    AND A.CAPA = B.CAPA_CD
			    AND B.EQ_TP_CD = 'FC'
	            AND B.CAPA_CD &lt;&gt; 'CVCEM'
			    AND B.VLD_YN = 'Y'
        UNION
		SELECT
			    2 OD, 
			    'Pipeline' EQFACNM, 
			    DECODE(COUNT(*), 0, 'false', 'true') USEYN
		FROM 	TMT_VSL_SVC_RPT A, TMT_EQ_CAPA B
		WHERE 	A.VSL_CALL_ID = #{vslCallId}
			  	AND A.WORK_YMD = TO_CHAR(TO_DATE(#{workYmd}, 'DD/MM/YYYY'), 'YYYYMMDD')
			  	AND A.SHFT_ID = #{shftId}
			    AND A.CAPA = B.CAPA_CD
			    AND B.EQ_TP_CD = 'FC'
	            AND B.CAPA_CD = 'CVCEM'
			    AND B.VLD_YN = 'Y'
	</select>
	
	<select id="selectDelvMode" parameterType="vorDryBreakBulkParm" resultType="vorDryBreakBulkItem">							
		SELECT 
		    	DECODE(SUM(DECODE(DELV_TP_CD, 'D', 1, 0)), 0, 'false', 'true') ISDIRECT,
		    	DECODE(SUM(DECODE(DELV_TP_CD, 'I', 1, 0)), 0, 'false', 'true') ISINDIRECT
		FROM 	TMT_VSL_SVC_RPT
		WHERE 	VSL_CALL_ID = #{vslCallId}
			  	AND WORK_YMD = TO_CHAR(TO_DATE(#{workYmd}, 'DD/MM/YYYY'), 'YYYYMMDD')
			  	AND SHFT_ID = #{shftId}
			    AND DELV_TP_CD IS NOT NULL
			    AND ROWNUM = 1
		GROUP BY DELV_TP_CD
	</select>
	
	<select id="selectHandlingSum" parameterType="vorDryBreakBulkParm" resultType="vorDryBreakBulkItem">							
		SELECT 
			    HATCH_NO HATCHNO, 
			    SUM(DECODE(JB.JOB_TP_CD, 'LD', JB.CG_WGT, 0)) LDMTHS,
			    SUM(DECODE(JB.JOB_TP_CD, 'DS', JB.CG_WGT, 0)) DSMTHS
		FROM 	TMT_JOB JB
		WHERE 	JB.VSL_CALL_ID =  #{vslCallId}
				AND TO_CHAR(F_GET_SHFT_DATE(JB.WORK_ST_DT), 'DD/MM/YYYY') = #{workYmd}
				AND F_GET_SHIFT_CD(JB.WORK_ST_DT) = #{shftId}
				AND JB.HATCH_NO IS NOT NULL
				AND JB.JOB_TP_CD IN ('LD', 'DS')
				AND JB.JOB_PURP_CD IN ('GV', 'AV', 'VA', 'AG')
		GROUP BY HATCH_NO
	</select>
	
	<select id="selectHoliday" parameterType="vorDryBreakBulkParm" resultType="vorDryBreakBulkItem">
		SELECT	NVL(A.DESCR,'No')	as    holidayDescr                         
		FROM 	TMT_ANNUAL_HLDAY A
        WHERE 	A.HLDAY_DD = #{hlDayYmd}  AND A.HLDAY_MON = #{hlMonthYmd} AND ROWNUM=1
	</select>
	
	<select id="selectComp" parameterType="vorDryBreakBulkParm" resultType="vorDryBreakBulkItem">
		SELECT 	COMP_CD WORKCOMP 
		FROM 	TMT_VSL_OPE_RPT_DTL
		WHERE 	VSL_CALL_ID = #{vslCallId}
		  		AND WORK_YMD = TO_CHAR(TO_DATE(#{workYmd}, 'DD/MM/YYYY'), 'YYYYMMDD')
		  		AND SHFT_ID = #{shftId}
		    	AND CG_TP_CD = #{cgTpCd}
		    	AND COMP_CD IS NOT NULL
		    	AND ROWNUM = 1
		GROUP BY COMP_CD
	</select>
	
	<select id="selectRemark" parameterType="vorDryBreakBulkParm" resultType="vorDryBreakBulkItem">							
		SELECT 	RMK 
		FROM 	TMT_VSL_OPE_RPT
		WHERE 	VSL_CALL_ID = #{vslCallId}
		  		AND WORK_YMD = TO_CHAR(TO_DATE(#{workYmd}, 'DD/MM/YYYY'), 'YYYYMMDD')
		  		AND SHFT_ID = #{shftId}
	</select>
	
	<select id="isOverlappedWithFinitePeriodHHT" parameterType="vorDryBreakBulkParm" resultType="vorDryBreakBulkItem">
		SELECT 	COUNT(*) AS COUNT 
		FROM 	TMT_VSL_OPE_RPT_DTL
		WHERE 	ROWNUM = 1  
				<if test="vslCallId != null and vslCallId != ''">
					AND
					VSL_CALL_ID = #{vslCallId} 
				</if>
				<if test="workYmd != null">
					AND
					WORK_YMD = #{workYmd}
				</if>
				<if test="shftId != null and shftId != ''">
					AND
					SHFT_ID = #{shftId}
				</if>
				<if test="cgTpCd != null and cgTpCd != ''">
					AND
					CG_TP_CD = #{cgTpCd} 
				</if>
				<if test="hatchNo != null and hatchNo != ''">
					AND
					HATCH_NO = #{hatchNo} 
				</if>
				<if test="hatchDrtCd != null and hatchDrtCd != ''">
					AND
					HATCH_DRT_CD = #{hatchDrtCd} 
				</if>
				<if test="eqFacNo != null and eqFacNo != ''">
					AND
					EQ_FAC_NO = #{eqFacNo}  
				</if>			
				<if test="seq != null and seq != ''">
					AND
					SEQ <![CDATA[<>]]> TO_NUMBER(#{seq})  
				</if>
				<if test="workStDt != null">
					AND
					(
					<if test="workEndDt != null">
					WORK_ST_DT IS NOT NULL AND
					WORK_END_DT IS NOT NULL AND
					(TO_DATE(#{workStDt}, 'dd/mm/yyyy hh24:mi'), TO_DATE(#{workEndDt}, 'dd/mm/yyyy hh24:mi')) OVERLAPS (NVL(WORK_ST_DT, SYSDATE), NVL(WORK_END_DT, SYSDATE))
					</if>
					<if test="workEndDt == null">
					WORK_END_DT IS NOT NULL AND 
					WORK_END_DT <![CDATA[>]]> #{workStDt}
					</if>
					)
				</if>
	</select>
	
	<update id="updateListVORItems"  parameterType="vorDryBreakBulkItem">
		UPDATE 	TMT_VSL_OPE_RPT 
		SET 	RMK =  #{rmk}
		WHERE
		    	VSL_CALL_ID = #{vslCallId}
		    	AND WORK_YMD = TO_CHAR(TO_DATE(#{workYmd}, 'DD/MM/YYYY'), 'YYYYMMDD')
		    	AND SHFT_ID = #{shftId}
	</update>
	
	<update id="updateListVORVerifyItems"  parameterType="vorDryBreakBulkItem">
		UPDATE 	TMT_VSL_OPE_RPT 
	    SET 	VERIFY_STATUS =  #{verifySt},
	            VERIFY_BY = #{verifyBy},
	            VERIFY_DATE = SYSDATE            
       	WHERE
               	VSL_CALL_ID = #{vslCallID}
               	AND WORK_YMD = TO_CHAR(TO_DATE(#{workYmd}, 'DD/MM/YYYY'), 'YYYYMMDD')
               	AND SHFT_ID = #{shftId}
	</update>
	
<select id="selectOpeJobList" parameterType="vorDryBreakBulkParm" resultType="vorDryBreakBulkItem">	
	SELECT J.VSL_CALL_ID AS VSLCALLID, 
         J.CG_NO AS CGNO,
         G.SHIPG_NOTE_NO AS BLSN,
         J.JOB_NO AS JOBNO,
         J.SDO_NO AS GRSDO,
         J.BARGE_NO AS BARGENO 
    FROM TMT_JOB J
         LEFT OUTER JOIN TMT_GR G 			ON J.VSL_CALL_ID = G.VSL_CALL_ID AND J.CG_NO = G.GR_NO
         LEFT OUTER JOIN TMT_SHIPG_NOTE S 	ON G.VSL_CALL_ID = S.VSL_CALL_ID AND G.SHIPG_NOTE_NO = S.SHIPG_NOTE_NO
	WHERE J.VSL_CALL_ID = #{vslCallId}
		<!-- AND J.BARGE_NO IS NOT NULL -->
		AND J.SDO_NO IS NOT NULL
UNION ALL 
	SELECT JB.VSL_CALL_ID AS VSLCALLID,
         JB.CG_NO AS CGNO,
         B.BL_NO AS BLSN,
         JB.JOB_NO AS JOBNO,
         JB.SDO_NO AS GRSDO,
         JB.BARGE_NO AS BARGENO 
	FROM TMT_JOB JB
         LEFT OUTER JOIN TMT_BL B			ON JB.VSL_CALL_ID = B.VSL_CALL_ID AND JB.CG_NO = B.BL_NO
	WHERE JB.VSL_CALL_ID = #{vslCallId}
		<!-- AND JB.BARGE_NO IS NOT NULL -->
		AND JB.SDO_NO IS NOT NULL
</select>


<select id="selectHandlingServicePDFReportList" parameterType="vorDryBreakBulkParm" resultType="vorDryBreakBulkItem">
SELECT HSR.*
FROM (
WITH 
DISCH_SE AS (
    SELECT 
        JO.VSL_CALL_ID AS VSL_CALL_ID,
        JO.CG_NO AS CG_NO,
        JO.DELV_TP_CD,  
        F_CM_012 ('MT', 'DELVTP', JO.DELV_TP_CD) AS ACTDELVTPNM,
        JO.TSPT_TP_CD,
        F_CM_012 ('MT', 'TSPTTP', JO.TSPT_TP_CD) AS OPRSMODENM,
        SUM (JO.CG_WGT) AS MT,
        SUM (JO.CG_VOL) AS M3,
        SUM (JO.PKG_QTY) AS actualQTY,
        SUM (JO.CG_WGT) AS actualMT,
        SUM (JO.CG_VOL) AS actualM3,
        SUM (JO.PKG_QTY) AS QTY
    FROM TMT_JOB JO
    WHERE 
    JO.TSPT_TP_CD = 'SE'
    AND JO.JOB_PURP_CD IN ('VA', 'VG')
    GROUP BY JO.VSL_CALL_ID, JO.CG_NO, JO.DELV_TP_CD, JO.TSPT_TP_CD
),
DISCH_LR AS (
    SELECT
        J.VSL_CALL_ID,
        J.CG_NO,
        J.DELV_TP_CD,  
        F_CM_012 ('MT', 'DELVTP', J.DELV_TP_CD) AS ACTDELVTPNM,
        J.TSPT_TP_CD,
        F_CM_012 ('MT', 'TSPTTP', J.TSPT_TP_CD) AS OPRSMODENM,
        (
	        CASE WHEN J.DELV_TP_CD = 'I' THEN SUM(DECODE (J.DELV_TP_CD, 'I', J.CG_WGT))
	        ELSE SUM(J.CG_WGT)
	        END
        ) AS actualMT 
        ,(
	        CASE WHEN J.DELV_TP_CD = 'I' THEN SUM(DECODE (J.DELV_TP_CD, 'I', J.CG_VOL))
	        ELSE SUM(J.CG_VOL)
	        END
        ) AS actualM3 
        ,(
	        CASE WHEN J.DELV_TP_CD = 'I' THEN SUM(DECODE (J.DELV_TP_CD, 'I', J.PKG_QTY))
	        ELSE SUM(J.PKG_QTY)
	        END
        ) AS actualQty  
    FROM TMT_JOB J
    WHERE J.JOB_PURP_CD IN ('VG', 'AW') <!-- 'VB', 'AB' BARGE -->
    	AND J.TSPT_TP_CD = 'LR'		<!-- LORRY  -->
    GROUP BY J.VSL_CALL_ID, J.CG_NO ,J.DELV_TP_CD ,J.TSPT_TP_CD
    ORDER BY J.CG_NO
),
LOADING AS (
    SELECT 
        SUM (JO.CG_WGT) AS MT,
        SUM (JO.CG_VOL) AS M3,
        SUM (JO.PKG_QTY) AS QTY,
        JO.VSL_CALL_ID AS VSL_CALL_ID,
        JO.CG_NO AS CG_NO
    FROM TMT_JOB JO
    WHERE JO.JOB_PURP_CD IN ('WA', 'AV', 'GV', 'GW')
    GROUP BY JO.VSL_CALL_ID, JO.CG_NO
    ORDER BY JO.CG_NO
),
DS_INFO AS (
    SELECT  BL.VSL_CALL_ID AS VSLCALLID,
            BL.VSL_CD,
            BL.BL_NO AS BLNO,
            BL.LOT_NO AS LOTNO, 
            '' AS SNNO,       
            BL.MF_DOC_ID AS MFDOCID,
            BL.STAT_CD,
            BL.PKG_TP_CD pkgTpCd, 
            (SELECT S_CD_NM FROM TMT_CD_MSTD WHERE L_CD = 'MT' AND  M_CD ='PKGTP' AND S_CD = BL.PKG_TP_CD AND ROWNUM = 1) PKGTPNM,
            BL.CATG_CD AS CATGCD,
            F_CM_001('MT', 'CATGTP', BL.CATG_CD) AS catgCdNm,
            BL.CMDT_CD AS CMDTCD,
            F_GET_CMDT_DESC(BL.CMDT_CD) AS CMDTCDNM,
            BL.POL,
            (SELECT PORT_NM FROM TMT_PORT_MST WHERE BL.POL = (CNTRY_CD || PORT_CD) AND ROWNUM=1) AS polNm,
            BL.POD,
            (SELECT PORT_NM FROM TMT_PORT_MST WHERE BL.POD = (CNTRY_CD || PORT_CD) AND ROWNUM=1) AS podNm,
            BL.DELV_TP_CD,
            F_CM_001 ('MT', 'DELVTP', BL.DELV_TP_CD) AS DELVTPNM,
            BL.CG_TP_CD,
            F_CM_001 ('MT', 'CGTP', BL.CG_TP_CD) AS CGTPCDNM,
            BL.SHPR AS SHPR,
            (SELECT ENG_SNM FROM TMT_PTNR WHERE BL.SHPR = PTNR_CODE AND ROWNUM=1) AS shprNm,
            BL.CNSNE AS CNSNE,
            (SELECT ENG_SNM FROM TMT_PTNR WHERE BL.CNSNE = PTNR_CODE AND ROWNUM=1) AS cnsneNm,
            NVL (BL.CG_WGT, 0.0) AS docMT,
            NVL (BL.CG_VOL, 0.0) AS docM3,
            NVL (BL.PKG_QTY, 0) AS docQty
    FROM TMT_BL BL 
    WHERE BL.CG_TP_CD NOT IN ('RCV') 
),
LD_INFO AS (
    SELECT  
        SN.VSL_CALL_ID AS VSLCALLID,
        SN.VSL_CD,
        '' AS BLNO,
        SN.LOT_NO AS LOTNO,
        SN.SHIPG_NOTE_NO AS SNNO,
        SN.MF_DOC_ID AS MFDOCID,
        SN.STAT_CD,
        SN.PKG_TP_CD pkgTpCd, 
        (SELECT S_CD_NM FROM TMT_CD_MSTD WHERE L_CD = 'MT' AND  M_CD ='PKGTP' AND S_CD = SN.PKG_TP_CD AND ROWNUM = 1) PKGTPNM,
        SN.CATG_CD AS CATGCD,
        F_CM_001('MT', 'CATGTP', SN.CATG_CD) AS catgCdNm,
        SN.CMDT_CD AS CMDTCD,
        F_GET_CMDT_DESC(SN.CMDT_CD) AS CMDTCDNM,
        SN.POL AS POL,
        (SELECT PORT_NM FROM TMT_PORT_MST WHERE SN.POL = (CNTRY_CD || PORT_CD) AND ROWNUM=1) AS polNm,
        SN.POD AS POD,
        (SELECT PORT_NM FROM TMT_PORT_MST WHERE SN.POD = (CNTRY_CD || PORT_CD) AND ROWNUM=1) AS podNm,
        SN.DELV_TP_CD,
        F_CM_001 ('MT', 'DELVTP', SN.DELV_TP_CD) AS DELVTPNM,
        SN.CG_TP_CD,
        F_CM_001 ('MT', 'CGTP', SN.CG_TP_CD) AS CGTPCDNM,
        SN.SHPR AS SHPR,
        (SELECT ENG_SNM FROM TMT_PTNR WHERE SN.SHPR = PTNR_CODE AND ROWNUM=1) AS shprNm,
        SN.CNSNE AS CNSNE,
        (SELECT ENG_SNM FROM TMT_PTNR WHERE SN.CNSNE = PTNR_CODE AND ROWNUM=1) AS cnsneNm,
        SN.CG_WGT AS docMT,
        SN.CG_VOL AS docM3,
        SN.PKG_QTY AS docQty
    FROM TMT_SHIPG_NOTE SN 
    WHERE SN.CG_TP_CD NOT IN ('RCV')
)
SELECT DS.*, 
        C.TSPT_TP_CD,
        F_CM_012 ('MT', 'TSPTTP', C.TSPT_TP_CD) AS tsptTpNm,
        TO_CHAR (V.ATB, 'DD/MM/YYYY HH24:MI') AS ATB,
        TO_CHAR (V.ATU, 'DD/MM/YYYY HH24:MI') AS ATU, 
        (
	        CASE WHEN C.TSPT_TP_CD = 'LR' THEN NVL (DISCH_LR.actualMT, 0.0) 
	        ELSE NVL (DISCH_SE.actualMT, 0.0) 
	        END
        ) AS actualMT,
        (
	        CASE WHEN C.TSPT_TP_CD = 'LR' THEN NVL (DISCH_LR.actualM3, 0.0) 
	        ELSE NVL (DISCH_SE.actualM3, 0.0) 
	        END
        ) AS actualM3,
        (
	        CASE WHEN C.TSPT_TP_CD = 'LR' THEN NVL (DISCH_LR.actualQty, 0.0) 
	        ELSE NVL (DISCH_SE.actualQty, 0.0) 
	        END
        ) AS actualQty
		,PART.VSL_NM AS VSLNM
		,DECODE(V.INB_VOY || ' / ' || V.OUTB_VOY, ' / ', '',V.INB_VOY || ' / ' || V.OUTB_VOY) AS VOYAGE
FROM DS_INFO DS 
    LEFT JOIN TMT_CG_MST C ON DS.VSLCALLID = C.VSL_CALL_ID AND DS.BLNO = C.CG_NO
    LEFT JOIN TMT_DO D ON DS.VSLCALLID = D.VSL_CALL_ID AND DS.BLNO = D.BL_NO
    LEFT JOIN DISCH_SE ON DS.VSLCALLID = DISCH_SE.VSL_CALL_ID AND DS.BLNO = DISCH_SE.CG_NO
    LEFT JOIN DISCH_LR ON DS.VSLCALLID = DISCH_LR.VSL_CALL_ID AND DS.BLNO = DISCH_LR.CG_NO
    LEFT JOIN TMT_VSL_SCH V ON DS.VSLCALLID = V.VSL_CALL_ID
    LEFT JOIN TMT_VSL_PART PART ON PART.VSL_CD = DS.VSL_CD
WHERE DS.CG_TP_CD IN ('BBK', 'DBN')
<if test="vslCallId != null and vslCallId != ''">
	AND DS.VSLCALLID = #{vslCallId} 
</if>
         AND DS.STAT_CD = 'AP'  
         AND PART.VSL_TP NOT IN ('BRGE')
UNION ALL
SELECT LD.*,
    C.TSPT_TP_CD,
    F_CM_012 ('MT', 'TSPTTP', C.TSPT_TP_CD) AS tsptTpNm,
    TO_CHAR (V.ATB, 'DD/MM/YYYY HH24:MI') AS ATB,
    TO_CHAR (V.ATU, 'DD/MM/YYYY HH24:MI') AS ATU,
    NVL (LOADING.MT, 0.0) AS actualMT,
    NVL (LOADING.M3, 0.0) AS actualM3,
    NVL (LOADING.QTY, 0) AS actualQty
	,PART.VSL_NM AS VSLNM
	,DECODE(V.INB_VOY || ' / ' || V.OUTB_VOY, ' / ', '',V.INB_VOY || ' / ' || V.OUTB_VOY) AS VOYAGE
FROM LD_INFO LD
INNER JOIN TMT_GR GR ON LD.VSLCALLID = GR.VSL_CALL_ID AND LD.SNNO = GR.SHIPG_NOTE_NO
INNER JOIN LOADING ON GR.VSL_CALL_ID = LOADING.VSL_CALL_ID AND GR.GR_NO = LOADING.CG_NO
LEFT JOIN TMT_CG_MST C ON GR.VSL_CALL_ID = C.VSL_CALL_ID AND GR.GR_NO = C.CG_NO
LEFT OUTER JOIN TMT_VSL_SCH V ON LD.VSLCALLID = V.VSL_CALL_ID
LEFT JOIN TMT_VSL_PART PART ON PART.VSL_CD = LD.VSL_CD
WHERE LD.CG_TP_CD IN ('BBK', 'DBN')
<if test="vslCallId != null and vslCallId != ''">
	AND LD.VSLCALLID = #{vslCallId} 
</if>
        AND LD.STAT_CD = 'AP'
        AND PART.VSL_TP NOT IN ('BRGE')
) HSR
ORDER BY HSR.VSLCALLID, HSR.BLNO, HSR.SNNO, HSR.DOCMT,HSR.DOCM3, HSR.DOCQTY, HSR.MFDOCID
</select>

<select id="selectHandlingServicePDFReportList1" parameterType="vorDryBreakBulkParm" resultType="vorDryBreakBulkItem">	
WITH 
MODE_OPE AS (
SELECT A.L_CD AS lcd,
         C.L_CD_NM AS lcdNm,
         A.M_CD AS mcd,
         B.M_CD_NM AS mcdNm,
         A.S_CD AS scd,
         A.S_CD_NM AS scdNm 
FROM TMT_CD_MSTD A, TMT_CD_MSTM B, TMT_CD_MSTL C
WHERE     A.L_CD = C.L_CD
         AND B.L_CD = C.L_CD
         AND A.M_CD = B.M_CD
         AND C.L_CD = 'MT'
         AND B.M_CD = 'TSPTTP'
         AND C.USE_YN = 'Y'
         AND B.USE_YN = 'Y'
         AND A.S_CD_USE = 'Y'
ORDER BY A.L_CD, A.M_CD, A.S_CD
),
STORED AS (
    SELECT 
        SUM (JO.CG_WGT) AS MT,
        SUM (JO.CG_VOL) AS M3,
        SUM (JO.PKG_QTY) AS QTY,
        JO.VSL_CALL_ID AS VSL_CALL_ID,
        JO.CG_NO AS CG_NO
    FROM TMT_JOB JO
    WHERE JO.JOB_PURP_CD = 'AW'
<!-- 	<if test="vslCallId != null and vslCallId != ''">
	AND JO.VSL_CALL_ID = #{vslCallId} 
	</if> -->
    GROUP BY JO.VSL_CALL_ID, JO.CG_NO
),
DISCH AS (
    SELECT 
        SUM (JO.CG_WGT) AS MT,
        SUM (JO.CG_VOL) AS M3,
        SUM (JO.PKG_QTY) AS QTY,
        JO.VSL_CALL_ID AS VSL_CALL_ID,
        JO.CG_NO AS CG_NO
    FROM TMT_JOB JO
    WHERE JO.JOB_PURP_CD IN ('VA', 'VG', 'VB')
<!--     <if test="vslCallId != null and vslCallId != ''">
	AND JO.VSL_CALL_ID = #{vslCallId} 
	</if> -->
    GROUP BY JO.VSL_CALL_ID, JO.CG_NO
),
LOADING AS (
    SELECT 
        SUM (JO.CG_WGT) AS MT,
        SUM (JO.CG_VOL) AS M3,
        SUM (JO.PKG_QTY) AS QTY,
        JO.VSL_CALL_ID AS VSL_CALL_ID,
        JO.CG_NO AS CG_NO
    FROM TMT_JOB JO
    WHERE JO.JOB_PURP_CD IN ('WA', 'AV', 'GV', 'BV', 'GW')
<!--     <if test="vslCallId != null and vslCallId != ''">
	AND JO.VSL_CALL_ID = #{vslCallId} 
	</if> -->
    GROUP BY JO.VSL_CALL_ID, JO.CG_NO
),
DS_INFO AS (
	SELECT  BL.VSL_CALL_ID AS VSLCALLID,
			BL.VSL_CD,
	        BL.BL_NO AS BLNO,
	        BL.LOT_NO AS LOTNO, 
	        '' AS SNNO,       
	        BL.MF_DOC_ID AS MFDOCID,
	        BL.STAT_CD AS STAT_CD,
	        BL.PKG_TP_CD pkgTpCd,
	        (SELECT S_CD_NM FROM TMT_CD_MSTD WHERE L_CD = 'MT' AND  M_CD ='PKGTP' AND S_CD = BL.PKG_TP_CD AND ROWNUM = 1) PKGTPNM,
	        BL.TSPT_TP_CD AS tsptTpCd,	<!-- Mode of Operation -->
			F_CM_001 ('MT', 'TSPTTP', BL.TSPT_TP_CD) AS tsptTpNm,
	        BL.CATG_CD AS CATGCD,
	        F_CM_001('MT', 'CATGTP', BL.CATG_CD) AS catgCdNm,
	        BL.CMDT_CD AS CMDTCD,
	        F_GET_CMDT_DESC(BL.CMDT_CD) AS CMDTCDNM,
	        BL.POL,
	        (SELECT PORT_NM FROM TMT_PORT_MST WHERE BL.POL = (CNTRY_CD || PORT_CD) AND ROWNUM=1) AS polNm,
	        BL.POD,
	        (SELECT PORT_NM FROM TMT_PORT_MST WHERE BL.POD = (CNTRY_CD || PORT_CD) AND ROWNUM=1) AS podNm,
	        BL.DELV_TP_CD,
	        F_CM_001 ('MT', 'DELVTP', BL.DELV_TP_CD) AS DELVTPNM,
	        BL.CG_TP_CD,
	        F_CM_001 ('MT', 'CGTP', BL.CG_TP_CD) AS CGTPCDNM,
	        BL.SHPR AS SHPR,
	        (SELECT ENG_SNM FROM TMT_PTNR WHERE BL.SHPR = PTNR_CODE AND ROWNUM=1) AS shprNm,
	        BL.CNSNE AS CNSNE,
	        (SELECT ENG_SNM FROM TMT_PTNR WHERE BL.CNSNE = PTNR_CODE AND ROWNUM=1) AS cnsneNm,
	        NVL (BL.CG_WGT, 0.0) AS docMT,
	        NVL (BL.CG_VOL, 0.0) AS docM3,
	        NVL (BL.PKG_QTY, 0) AS docQty
	FROM TMT_BL BL 
	WHERE BL.CG_TP_CD NOT IN ('RCV')
	<!-- <if test="vslCallId != null and vslCallId != ''">
		AND BL.VSL_CALL_ID = #{vslCallId} 
	</if> -->
),
LD_INFO AS (
	SELECT  
	    SN.VSL_CALL_ID AS VSLCALLID,
	    SN.VSL_CD,
	    '' AS BLNO,
	    SN.LOT_NO AS LOTNO,
	    SN.SHIPG_NOTE_NO AS SNNO,
	    SN.MF_DOC_ID AS MFDOCID,
	    SN.STAT_CD AS STAT_CD,
	    SN.PKG_TP_CD pkgTpCd,
	    (SELECT S_CD_NM FROM TMT_CD_MSTD WHERE L_CD = 'MT' AND  M_CD ='PKGTP' AND S_CD = SN.PKG_TP_CD AND ROWNUM = 1) PKGTPNM,
	    SN.TSPT_TP_CD AS tsptTpCd,	<!-- Mode of Operation -->
		F_CM_001 ('MT', 'TSPTTP', SN.TSPT_TP_CD) AS tsptTpNm,
	    SN.CATG_CD AS CATGCD,
	    F_CM_001('MT', 'CATGTP', SN.CATG_CD) AS catgCdNm,
	    SN.CMDT_CD AS CMDTCD,
	    F_GET_CMDT_DESC(SN.CMDT_CD) AS CMDTCDNM,
	    SN.POL AS POL,
	    (SELECT PORT_NM FROM TMT_PORT_MST WHERE SN.POL = (CNTRY_CD || PORT_CD) AND ROWNUM=1) AS polNm,
	    SN.POD AS POD,
	    (SELECT PORT_NM FROM TMT_PORT_MST WHERE SN.POD = (CNTRY_CD || PORT_CD) AND ROWNUM=1) AS podNm,
	    SN.DELV_TP_CD,
	    F_CM_001 ('MT', 'DELVTP', SN.DELV_TP_CD) AS DELVTPNM,
	    SN.CG_TP_CD,
	    F_CM_001 ('MT', 'CGTP', SN.CG_TP_CD) AS CGTPCDNM,
	    SN.SHPR AS SHPR,
	    (SELECT ENG_SNM FROM TMT_PTNR WHERE SN.SHPR = PTNR_CODE AND ROWNUM=1) AS shprNm,
	    SN.CNSNE AS CNSNE,
	    (SELECT ENG_SNM FROM TMT_PTNR WHERE SN.CNSNE = PTNR_CODE AND ROWNUM=1) AS cnsneNm,
	    SN.CG_WGT AS docMT,
	    SN.CG_VOL AS docM3,
	    SN.PKG_QTY AS docQty
	FROM TMT_SHIPG_NOTE SN 
	WHERE SN.CG_TP_CD NOT IN ('RCV')
)
SELECT DS.*,
        TO_CHAR (V.ATB, 'DD/MM/YYYY HH24:MI') AS ATB,
        TO_CHAR (V.ATU, 'DD/MM/YYYY HH24:MI') AS ATU,
	<!-- TO_CHAR (C.HDL_IN_ST_DT, 'DD/MM/YYYY HH24:MI') AS HDLINSTDT,
	DECODE ( C.HDL_OUT_END_DT, NULL, TO_CHAR (C.HDL_OUT_ST_DT, 'DD/MM/YYYY HH24:MI'),
	TO_CHAR (C.HDL_OUT_END_DT, 'DD/MM/YYYY HH24:MI')) AS HDLOUTDT,
	C.STAT_CD AS STAT,
	NVL (C.STAT_CD, 'RS') STATCD,
	F_CM_012 ('MT', 'CGSTATUS', NVL (C.STAT_CD, 'RS')) STATNM, -->
        NVL (DISCH.MT, 0.0) AS actualMT,
        NVL (DISCH.M3, 0.0) AS actualM3,
        NVL (DISCH.QTY, 0) AS actualQty
FROM DS_INFO DS
    LEFT JOIN TMT_CG_MST C ON DS.VSLCALLID = C.VSL_CALL_ID AND DS.BLNO = C.CG_NO
    LEFT JOIN TMT_DO D ON DS.VSLCALLID = D.VSL_CALL_ID AND DS.BLNO = D.BL_NO
    LEFT JOIN DISCH ON DS.VSLCALLID = DISCH.VSL_CALL_ID AND DS.BLNO = DISCH.CG_NO
    LEFT JOIN TMT_VSL_SCH V ON DS.VSLCALLID = V.VSL_CALL_ID
    LEFT JOIN TMT_VSL_PART PART ON PART.VSL_CD = DS.VSL_CD
WHERE DS.CG_TP_CD IN ('BBK', 'DBN')
<if test="vslCallId != null and vslCallId != ''">
	AND DS.VSLCALLID = #{vslCallId} 
</if>
	AND C.STAT_CD = 'OD'
	AND PART.VSL_TP NOT IN ('BRGE')
	<!-- AND DS.LOTNO = '210223' -->
UNION ALL
SELECT LD.*,
    TO_CHAR (V.ATB, 'DD/MM/YYYY HH24:MI') AS ATB,
    TO_CHAR (V.ATU, 'DD/MM/YYYY HH24:MI') AS ATU,
    NVL (LOADING.MT, 0.0) AS actualMT,
    NVL (LOADING.M3, 0.0) AS actualM3,
    NVL (LOADING.QTY, 0) AS actualQty
FROM LD_INFO LD
	INNER JOIN TMT_GR GR ON LD.VSLCALLID = GR.VSL_CALL_ID AND LD.SNNO = GR.SHIPG_NOTE_NO
	INNER JOIN LOADING ON GR.VSL_CALL_ID = LOADING.VSL_CALL_ID AND GR.GR_NO = LOADING.CG_NO
	LEFT JOIN TMT_CG_MST C ON GR.VSL_CALL_ID = C.VSL_CALL_ID AND GR.GR_NO = C.CG_NO
	LEFT JOIN TMT_VSL_SCH V ON LD.VSLCALLID = V.VSL_CALL_ID
	LEFT JOIN TMT_VSL_PART PART ON PART.VSL_CD = LD.VSL_CD
WHERE LD.CG_TP_CD IN ('BBK', 'DBN')
<if test="vslCallId != null and vslCallId != ''">
	AND LD.VSLCALLID = #{vslCallId} 
</if>
	AND LD.STAT_CD = 'AP'
	AND PART.VSL_TP NOT IN ('BRGE')
        <!--  AND LD.LOTNO = '21022023' -->
</select>
	

<select id="selectROROCForm1ReprotList" parameterType="vorDryBreakBulkParm" resultType="vorDryBreakBulkItem">
SELECT
	F1.VSLCALLID,
	F1.VSL_CD,
	F1.BLNO,
	F1.LOTNO, 
	F1.SNNO,       
	F1.MFDOCID,
	F1.STAT_CD,
	F1.PKGTPCD,
	F1.PKGTPNM,
	F1.CATGCD,
	F1.CATGCDNM,
	F1.CMDTCD,
	F1.CMDTCDNM,
	F1.DELV_TP_CD,
	F1.DELVTPNM,
	F1.CGTPCDNM,
	F1.SHPR,
	F1.SHPRNM,
	F1.CNSNE,
	F1.CNSNENM,
	F1.DOCMT,
	F1.DOCM3,
	F1.DOCQTY,
	F1.VSLNM,
	F1.VOYAGE, 
	F1.ATB,
	F1.ATU,
	F1.ACTUALMT,
	F1.ACTUALM3,
	F1.ACTUALQTY
FROM (
WITH 
MODE_OPE AS (
	SELECT A.L_CD AS lcd,
	         C.L_CD_NM AS lcdNm,
	         A.M_CD AS mcd,
	         B.M_CD_NM AS mcdNm,
	         A.S_CD AS scd,
	         A.S_CD_NM AS scdNm 
	FROM TMT_CD_MSTD A, TMT_CD_MSTM B, TMT_CD_MSTL C
	WHERE     A.L_CD = C.L_CD
	         AND B.L_CD = C.L_CD
	         AND A.M_CD = B.M_CD
	         AND C.L_CD = 'MT'
	         AND B.M_CD = 'TSPTTP'
	         AND C.USE_YN = 'Y'
	         AND B.USE_YN = 'Y'
	         AND A.S_CD_USE = 'Y'
	ORDER BY A.L_CD, A.M_CD, A.S_CD
),
DISCH AS (
	SELECT 
			SUM (JO.CG_WGT) AS MT,
			SUM (JO.CG_VOL) AS M3,
			SUM (JO.PKG_QTY) AS QTY,
			JO.VSL_CALL_ID AS VSL_CALL_ID,
			JO.CG_NO AS CG_NO
	FROM TMT_JOB JO
	WHERE JO.JOB_PURP_CD IN ('VG', 'VB', 'AB',  'AW')
	GROUP BY JO.VSL_CALL_ID, JO.CG_NO
),
LOADING AS (
    SELECT 
			SUM (JO.CG_WGT) AS MT,
			SUM (JO.CG_VOL) AS M3,
			SUM (JO.PKG_QTY) AS QTY,
			JO.VSL_CALL_ID AS VSL_CALL_ID, 
			GR.SHIPG_NOTE_NO
	FROM TMT_JOB JO
	LEFT JOIN TMT_GR GR ON JO.VSL_CALL_ID = GR.VSL_CALL_ID AND JO.CG_NO = GR.GR_NO
	WHERE JO.JOB_PURP_CD IN ('WA', 'AV', 'GV', 'BV', 'GW')
	GROUP BY JO.VSL_CALL_ID, GR.SHIPG_NOTE_NO
),
DS_INFO AS (
	SELECT  BL.VSL_CALL_ID AS VSLCALLID,
	        BL.VSL_CD,
	        BL.BL_NO AS BLNO,
	        BL.LOT_NO AS LOTNO, 
	        '' AS SNNO,       
	        BL.MF_DOC_ID AS MFDOCID,
	        BL.STAT_CD AS STAT_CD,
	        BL.PKG_TP_CD pkgTpCd,
	        (SELECT S_CD_NM FROM TMT_CD_MSTD WHERE L_CD = 'MT' AND  M_CD ='PKGTP' AND S_CD = BL.PKG_TP_CD AND ROWNUM = 1) PKGTPNM,
	        BL.CATG_CD AS CATGCD,
	        F_CM_001('MT', 'CATGTP', BL.CATG_CD) AS catgCdNm,
	        BL.CMDT_CD AS CMDTCD,
	        F_GET_CMDT_DESC(BL.CMDT_CD) AS CMDTCDNM,
	        BL.TSPT_TP_CD AS tsptTpCd,
	        BL.DELV_TP_CD,
	        F_CM_001 ('MT', 'DELVTP', BL.DELV_TP_CD) AS DELVTPNM,
	        BL.CG_TP_CD,
	        F_CM_001 ('MT', 'CGTP', BL.CG_TP_CD) AS CGTPCDNM,
	        BL.SHPR AS SHPR,
	        (SELECT ENG_SNM FROM TMT_PTNR WHERE BL.SHPR = PTNR_CODE AND ROWNUM=1) AS shprNm,
	        BL.CNSNE AS CNSNE,
	        (SELECT ENG_SNM FROM TMT_PTNR WHERE BL.CNSNE = PTNR_CODE AND ROWNUM=1) AS cnsneNm,
	        BL.POD,
	        NVL (BL.CG_WGT, 0.0) AS docMT,
	        NVL (BL.CG_VOL, 0.0) AS docM3,
	        NVL (BL.PKG_QTY, 0) AS docQty
	FROM TMT_BL BL 
	WHERE BL.CG_TP_CD NOT IN ('RCV') 
),
LD_INFO AS (
	SELECT  
	    SN.VSL_CALL_ID AS VSLCALLID,
	    SN.VSL_CD,
	    '' AS BLNO,
	    SN.LOT_NO AS LOTNO,
	    SN.SHIPG_NOTE_NO AS SNNO,
	    SN.MF_DOC_ID AS MFDOCID,
	    SN.STAT_CD AS STAT_CD,
	    SN.PKG_TP_CD pkgTpCd,
	    (SELECT S_CD_NM FROM TMT_CD_MSTD WHERE L_CD = 'MT' AND  M_CD ='PKGTP' AND S_CD = SN.PKG_TP_CD AND ROWNUM = 1) PKGTPNM,
	    SN.CATG_CD AS CATGCD,
	    F_CM_001('MT', 'CATGTP', SN.CATG_CD) AS catgCdNm,
	    SN.CMDT_CD AS CMDTCD,
	    F_GET_CMDT_DESC(SN.CMDT_CD) AS CMDTCDNM,
	    SN.TSPT_TP_CD AS tsptTpCd,
	    SN.DELV_TP_CD,
	    F_CM_001 ('MT', 'DELVTP', SN.DELV_TP_CD) AS DELVTPNM,
	    SN.CG_TP_CD,
	    F_CM_001 ('MT', 'CGTP', SN.CG_TP_CD) AS CGTPCDNM,
	    SN.SHPR AS SHPR,
	    (SELECT ENG_SNM FROM TMT_PTNR WHERE SN.SHPR = PTNR_CODE AND ROWNUM=1) AS shprNm,
	    SN.CNSNE AS CNSNE,
	    (SELECT ENG_SNM FROM TMT_PTNR WHERE SN.CNSNE = PTNR_CODE AND ROWNUM=1) AS cnsneNm,
	    SN.POL,
	    SN.CG_WGT AS docMT,
	    SN.CG_VOL AS docM3,
	    SN.PKG_QTY AS docQty
	FROM TMT_SHIPG_NOTE SN 
	WHERE SN.CG_TP_CD NOT IN ('RCV')
)
SELECT DS.*,
		PART.VSL_NM AS VSLNM,
		DECODE(V.INB_VOY || ' / ' || V.OUTB_VOY, ' / ', '',V.INB_VOY || ' / ' || V.OUTB_VOY) AS VOYAGE,
		<!-- NVL(C.PORT_OF_DIS, DS.POD) AS POD,
        (SELECT PORT_NM FROM TMT_PORT_MST WHERE NVL(C.PORT_OF_DIS, DS.POD) = (CNTRY_CD || PORT_CD) AND ROWNUM=1) AS podNm,
        '' AS POL,
        '' AS POLNM, -->
        TO_CHAR (V.ATB, 'DD/MM/YYYY HH24:MI') AS ATB,
        TO_CHAR (V.ATU, 'DD/MM/YYYY HH24:MI') AS ATU,
        <!-- DISCH.TSPT_TP_CD AS tsptTpCd,
        F_CM_001 ('MT', 'TSPTTP', NVL(DISCH.TSPT_TP_CD, DS.TSPTTPCD)) AS tsptTpNm, -->
        NVL (DISCH.MT, 0.0) AS actualMT,
        NVL (DISCH.M3, 0.0) AS actualM3,
        NVL (DISCH.QTY, 0) AS actualQty
FROM DISCH
    LEFT JOIN DS_INFO DS ON DS.VSLCALLID = DISCH.VSL_CALL_ID AND DS.BLNO = DISCH.CG_NO
    LEFT JOIN TMT_CG_MST C ON DS.VSLCALLID = C.VSL_CALL_ID AND DS.BLNO = C.CG_NO
    LEFT JOIN TMT_DO D ON DS.VSLCALLID = D.VSL_CALL_ID AND DS.BLNO = D.BL_NO
    LEFT JOIN TMT_VSL_SCH V ON DS.VSLCALLID = V.VSL_CALL_ID
    LEFT JOIN TMT_VSL_PART PART ON PART.VSL_CD = DS.VSL_CD
WHERE DS.CG_TP_CD IN ('BBK', 'DBN')
<if test="vslCallId != null and vslCallId != ''">
	AND DS.VSLCALLID = #{vslCallId} 
</if>
UNION ALL
SELECT LD.*,
	PART.VSL_NM AS VSLNM,
	DECODE(V.INB_VOY || ' / ' || V.OUTB_VOY, ' / ', '',V.INB_VOY || ' / ' || V.OUTB_VOY) AS VOYAGE,
    <!-- '' AS POD,
    '' AS PODNM,
    NVL(C.PORT_OF_LOAD, LD.POL) AS POL, 
    (SELECT PORT_NM FROM TMT_PORT_MST WHERE NVL(C.PORT_OF_LOAD, LD.POL) = (CNTRY_CD || PORT_CD) AND ROWNUM=1) AS polNm,  -->
    TO_CHAR (V.ATB, 'DD/MM/YYYY HH24:MI') AS ATB,
    TO_CHAR (V.ATU, 'DD/MM/YYYY HH24:MI') AS ATU,
    <!-- LOADING.TSPT_TP_CD AS tsptTpCd,
    F_CM_001 ('MT', 'TSPTTP', NVL(LOADING.TSPT_TP_CD, LD.TSPTTPCD)) AS tsptTpNm, -->
    NVL (LOADING.MT, 0.0) AS actualMT,
    NVL (LOADING.M3, 0.0) AS actualM3,
    NVL (LOADING.QTY, 0) AS actualQty
FROM LOADING
    LEFT JOIN LD_INFO LD ON LD.VSLCALLID = LOADING.VSL_CALL_ID AND LD.SNNO = LOADING.SHIPG_NOTE_NO 
    LEFT JOIN TMT_VSL_SCH V ON LOADING.VSL_CALL_ID = V.VSL_CALL_ID
    LEFT JOIN TMT_VSL_PART PART ON PART.VSL_CD = LD.VSL_CD
WHERE LD.CG_TP_CD IN ('BBK', 'DBN')
<if test="vslCallId != null and vslCallId != ''">
	AND LD.VSLCALLID = #{vslCallId} 
</if>
) F1
ORDER BY
	F1.VSLCALLID,
	F1.BLNO,
	F1.SNNO,
	F1.CMDTCDNM,
    F1.DOCMT,
    F1.DOCM3,
    F1.DOCQTY
</select>


<select id="selectROROCForm2ReprotList" parameterType="vorDryBreakBulkParm" resultType="vorDryBreakBulkItem">
SELECT
	F1.VSLCALLID,
	F1.VSL_CD,
	F1.BLNO,
	F1.LOTNO, 
	F1.SNNO,       
	F1.MFDOCID,
	F1.STAT_CD,
	F1.PKGTPCD,
	F1.PKGTPNM,
	F1.CATGCD,
	F1.CATGCDNM,
	F1.CMDTCD,
	F1.CMDTCDNM,
	F1.DELV_TP_CD,
	F1.DELVTPNM,
	F1.CGTPCDNM,
	F1.SHPR,
	F1.SHPRNM,
	F1.CNSNE,
	F1.CNSNENM,
	F1.DOCMT,
	F1.DOCM3,
	F1.DOCQTY,
	F1.VSLNM,
	F1.VOYAGE, 
	F1.PODNM,
	F1.POL, 
	F1.POLNM, 
	F1.ATB,
	F1.ATU,
	F1.TSPTTPCD,
	F1.TSPTTPNM, 
	F1.ACTUALMT,
	F1.ACTUALM3,
	F1.ACTUALQTY,
	F1.GRSDO,
	F1.SDONO,
	F1.GRNO
FROM (
WITH 
		BARGE_DISCH AS
		( 
			SELECT 
					SUM (JO.CG_WGT) AS MT,
					SUM (JO.CG_VOL) AS M3,
					SUM (JO.PKG_QTY) AS QTY,
					JO.TSPT_TP_CD, 
					JO.VSL_CALL_ID AS VSL_CALL_ID,
					JO.CG_NO AS CG_NO,
					JO.SDO_NO AS SDO_NO,
					JO.BARGE_NO
			FROM TMT_JOB JO
			WHERE JO.JOB_PURP_CD IN ('VG', 'VB', 'AB', 'AW')    
			AND JO.BARGE_NO = #{vslCallId} 
			GROUP BY JO.VSL_CALL_ID, JO.CG_NO, JO.TSPT_TP_CD, JO.SDO_NO, JO.BARGE_NO  
		),
		BARGE_LOADING AS
		(
			SELECT 
					SUM (JO.CG_WGT) AS MT,
					SUM (JO.CG_VOL) AS M3,
					SUM (JO.PKG_QTY) AS QTY,
					JO.TSPT_TP_CD, 
					JO.VSL_CALL_ID AS VSL_CALL_ID,
					JO.CG_NO AS CG_NO,
					JO.SDO_NO AS SDO_NO,
					JO.BARGE_NO
			FROM TMT_JOB JO
			WHERE JO.JOB_PURP_CD IN ('WA', 'AV', 'GV', 'BV', 'GW') 
			AND JO.BARGE_NO = #{vslCallId} 
			GROUP BY JO.VSL_CALL_ID, JO.CG_NO, JO.TSPT_TP_CD, JO.SDO_NO, JO.BARGE_NO 
		),
		BARGE_TS_LOADING AS
		( 
			SELECT
					SUM (JO.CG_WGT) AS MT,
					SUM (JO.CG_VOL) AS M3,
					SUM (JO.PKG_QTY) AS QTY,
					JO.TSPT_TP_CD, 
					JO.VSL_CALL_ID AS VSL_CALL_ID,
					JO.CG_NO AS CG_NO,
					JO.SDO_NO AS SDO_NO,
					JO.BARGE_NO
			FROM TMT_JOB JO
			WHERE JO.JOB_PURP_CD IN ('AV' ) 
			AND JO.BARGE_NO = #{vslCallId} 
			GROUP BY JO.VSL_CALL_ID, JO.CG_NO, JO.TSPT_TP_CD, JO.SDO_NO, JO.BARGE_NO
		),
		DISCH AS
		(
		    SELECT 
					SUM (JO.CG_WGT) AS MT,
					SUM (JO.CG_VOL) AS M3,
					SUM (JO.PKG_QTY) AS QTY,
					JO.TSPT_TP_CD, 
					JO.VSL_CALL_ID AS VSL_CALL_ID,
					JO.CG_NO AS CG_NO,
					JO.SDO_NO AS SDO_NO,
					JO.BARGE_NO
		    FROM TMT_JOB JO
		    WHERE JO.JOB_PURP_CD IN ('VG', 'VB', 'AB', 'AW')
		    AND JO.VSL_CALL_ID = #{vslCallId} 
		    GROUP BY JO.VSL_CALL_ID, JO.CG_NO, JO.TSPT_TP_CD, JO.SDO_NO, JO.BARGE_NO
		),
		LOADING AS
		(
			SELECT 
					SUM (JO.CG_WGT) AS MT,
					SUM (JO.CG_VOL) AS M3,
					SUM (JO.PKG_QTY) AS QTY,
					JO.TSPT_TP_CD, 
					JO.VSL_CALL_ID AS VSL_CALL_ID,
					JO.CG_NO AS CG_NO,
					JO.SDO_NO AS SDO_NO,
					JO.BARGE_NO
			FROM TMT_JOB JO
			WHERE JO.JOB_PURP_CD IN ('WA', 'AV', 'GV', 'BV', 'GW')
			AND JO.VSL_CALL_ID = #{vslCallId} 
			GROUP BY JO.VSL_CALL_ID, JO.CG_NO, JO.TSPT_TP_CD, JO.SDO_NO, JO.BARGE_NO
		),
		TS_LOADING AS
		(
			SELECT
					SUM (JO.CG_WGT) AS MT,
					SUM (JO.CG_VOL) AS M3,
					SUM (JO.PKG_QTY) AS QTY,
					JO.TSPT_TP_CD, 
					JO.VSL_CALL_ID AS VSL_CALL_ID,
					JO.CG_NO AS CG_NO,
					JO.SDO_NO AS SDO_NO,
					JO.BARGE_NO
			FROM TMT_JOB JO
			WHERE JO.JOB_PURP_CD IN ('AV' )
			AND JO.VSL_CALL_ID = #{vslCallId} 
			GROUP BY JO.VSL_CALL_ID, JO.CG_NO, JO.TSPT_TP_CD, JO.SDO_NO, JO.BARGE_NO
		),
		DS_INFO AS
		(
			SELECT
					BL.VSL_CALL_ID AS VSLCALLID,
					BL.VSL_CD,
					BL.BL_NO AS BLNO,
					BL.LOT_NO AS LOTNO, 
					'' AS SNNO,       
					BL.MF_DOC_ID AS MFDOCID,
					BL.STAT_CD AS STAT_CD,
					BL.PKG_TP_CD pkgTpCd,
					(SELECT S_CD_NM FROM TMT_CD_MSTD WHERE L_CD = 'MT' AND  M_CD ='PKGTP' AND S_CD = BL.PKG_TP_CD AND ROWNUM = 1) PKGTPNM,
					BL.CATG_CD AS CATGCD,
					F_CM_001('MT', 'CATGTP', BL.CATG_CD) AS catgCdNm,
					BL.CMDT_CD AS CMDTCD,
					F_GET_CMDT_DESC(BL.CMDT_CD) AS CMDTCDNM,
					BL.DELV_TP_CD,
					F_CM_001 ('MT', 'DELVTP', BL.DELV_TP_CD) AS DELVTPNM,
					BL.CG_TP_CD,
					F_CM_001 ('MT', 'CGTP', BL.CG_TP_CD) AS CGTPCDNM,
					BL.SHPR AS SHPR,
					(SELECT ENG_SNM FROM TMT_PTNR WHERE BL.SHPR = PTNR_CODE AND ROWNUM=1) AS shprNm,
					BL.CNSNE AS CNSNE,
					(SELECT ENG_SNM FROM TMT_PTNR WHERE BL.CNSNE = PTNR_CODE AND ROWNUM=1) AS cnsneNm,
					BL.POD AS PORT_OF_DIS,
					NVL (BL.CG_WGT, 0.0) AS docMT,
					NVL (BL.CG_VOL, 0.0) AS docM3,
					NVL (BL.PKG_QTY, 0) AS docQty
			FROM TMT_BL BL 
			WHERE BL.CG_TP_CD NOT IN ('RCV')
			ORDER BY BL.MF_DOC_ID
		),
		LD_INFO AS
		(
			SELECT  
					SN.VSL_CALL_ID AS VSLCALLID,
					SN.VSL_CD,
					'' AS BLNO,
					SN.LOT_NO AS LOTNO,
					SN.SHIPG_NOTE_NO AS SNNO,
					SN.MF_DOC_ID AS MFDOCID,
					SN.STAT_CD AS STAT_CD,
					SN.PKG_TP_CD pkgTpCd,
					(SELECT S_CD_NM FROM TMT_CD_MSTD WHERE L_CD = 'MT' AND  M_CD ='PKGTP' AND S_CD = SN.PKG_TP_CD AND ROWNUM = 1) PKGTPNM,
					SN.CATG_CD AS CATGCD,
					F_CM_001('MT', 'CATGTP', SN.CATG_CD) AS catgCdNm,
					SN.CMDT_CD AS CMDTCD,
					F_GET_CMDT_DESC(SN.CMDT_CD) AS CMDTCDNM,
					SN.DELV_TP_CD,
					F_CM_001 ('MT', 'DELVTP', SN.DELV_TP_CD) AS DELVTPNM,
					SN.CG_TP_CD,
					F_CM_001 ('MT', 'CGTP', SN.CG_TP_CD) AS CGTPCDNM,
					SN.SHPR AS SHPR,
					(SELECT ENG_SNM FROM TMT_PTNR WHERE SN.SHPR = PTNR_CODE AND ROWNUM=1) AS shprNm,
					SN.CNSNE AS CNSNE,
					(SELECT ENG_SNM FROM TMT_PTNR WHERE SN.CNSNE = PTNR_CODE AND ROWNUM=1) AS cnsneNm,
					SN.POL AS PORT_OF_LOAD,
					SN.CG_WGT AS docMT,
					SN.CG_VOL AS docM3,
					SN.PKG_QTY AS docQty
			FROM TMT_SHIPG_NOTE SN 
			WHERE SN.CG_TP_CD NOT IN ('RCV')
			ORDER BY SN.MF_DOC_ID
		)
		SELECT
				DS.VSLCALLID,
				DS.VSL_CD,
				DS.BLNO,
				DS.LOTNO, 
				DS.SNNO,       
				DS.MFDOCID,
				DS.STAT_CD,
				DS.pkgTpCd,
				DS.PKGTPNM,
				DS.CATGCD,
				DS.catgCdNm,
				DS.CMDTCD,
				DS.CMDTCDNM,
				DS.DELV_TP_CD,
				DS.DELVTPNM,
				DS.CG_TP_CD,
				DS.CGTPCDNM,
				DS.SHPR,
				DS.shprNm,
				DS.CNSNE,
				DS.cnsneNm,
				DS.PORT_OF_DIS,
				NVL (D.D_MT, 0.0) AS docMT,
				NVL (D.D_M3, 0.0) AS docM3,
				NVL (D.D_QTY, 0) AS docQty,
				BDS.SDO_NO AS GRSDO,
				BDS.SDO_NO AS SDONO,
				'' AS GRNO,
				NVL(C.PORT_OF_DIS, DS.PORT_OF_DIS) AS POD,
				(SELECT PORT_NM FROM TMT_PORT_MST WHERE NVL(C.PORT_OF_DIS, DS.PORT_OF_DIS) = (CNTRY_CD || PORT_CD) AND ROWNUM=1) AS podNm,
				'' AS POL,
				'' AS POLNM,
				TO_CHAR (V.ATB, 'DD/MM/YYYY HH24:MI') AS ATB,
				TO_CHAR (V.ATU, 'DD/MM/YYYY HH24:MI') AS ATU, 
				BDS.TSPT_TP_CD AS tsptTpCd,   
				F_CM_001 ('MT', 'TSPTTP', BDS.TSPT_TP_CD) AS tsptTpNm, 
				NVL (BDS.MT, 0.0) AS actualMT,
				NVL (BDS.M3, 0.0) AS actualM3,
				NVL (BDS.QTY, 0) AS actualQty
				,PART.VSL_NM AS VSLNM
				,DECODE(V.INB_VOY || ' / ' || V.OUTB_VOY, ' / ', '',V.INB_VOY || ' / ' || V.OUTB_VOY) AS VOYAGE
		FROM DS_INFO DS
			INNER JOIN TMT_DO DO ON DO.VSL_CALL_ID = DS.VSLCALLID AND DO.BL_NO = DS.BLNO
			LEFT JOIN BARGE_DISCH BDS ON BDS.VSL_CALL_ID = DS.VSLCALLID AND DS.BLNO = BDS.CG_NO
			LEFT JOIN TMT_DO_DTL D ON D.SDO_NO = BDS.SDO_NO  AND D.BL_NO = DS.BLNO AND DS.VSLCALLID = D.VSL_CALL_ID 
			LEFT JOIN TMT_CG_MST C ON DS.VSLCALLID = C.VSL_CALL_ID AND DS.BLNO = C.CG_NO
			LEFT JOIN TMT_VSL_SCH V ON DS.VSLCALLID = V.VSL_CALL_ID
			LEFT JOIN TMT_VSL_PART PART ON PART.VSL_CD = DS.VSL_CD
		WHERE DS.CG_TP_CD IN ('DBE', 'BBK', 'DBN')
			AND BDS.SDO_NO IS NOT NULL
			AND D.DELV_TP_CD = 'D' 
			<if test="vslCallId != null and vslCallId != ''">
				AND BDS.BARGE_NO = #{vslCallId} 
			</if>
UNION ALL
		SELECT 
				LD.VSLCALLID,
				LD.VSL_CD,
				'' AS BLNO,
				LD.LOTNO,
				LD.SNNO,
				LD.MFDOCID,
				LD.STAT_CD,
				LD.pkgTpCd,
				LD.PKGTPNM,
				LD.CATGCD,
				LD.catgCdNm,
				LD.CMDTCD,
				LD.CMDTCDNM,
				LD.DELV_TP_CD,
				LD.DELVTPNM,
				LD.CG_TP_CD,
				LD.CGTPCDNM,
				LD.SHPR,
				LD.shprNm,
				LD.CNSNE,
				LD.cnsneNm,
				LD.PORT_OF_LOAD,
				GR.CG_WGT AS docMT,
				GR.CG_VOL AS docM3,
				GR.PKG_QTY AS docQty,
				BLD.CG_NO AS GRSDO,
				'' AS SDONO,
				GR.GR_NO AS GRNO,
				'' AS POD,
				'' AS PODNM,
				NVL(C.PORT_OF_LOAD, LD.PORT_OF_LOAD) AS POL, 
				(SELECT PORT_NM FROM TMT_PORT_MST WHERE NVL(C.PORT_OF_LOAD, LD.PORT_OF_LOAD) = (CNTRY_CD || PORT_CD) AND ROWNUM=1) AS polNm, 
				TO_CHAR (V.ATB, 'DD/MM/YYYY HH24:MI') AS ATB,
				TO_CHAR (V.ATU, 'DD/MM/YYYY HH24:MI') AS ATU,
				BLD.TSPT_TP_CD AS tsptTpCd,
				F_CM_001 ('MT', 'TSPTTP', BLD.TSPT_TP_CD) AS tsptTpNm, 
				NVL (BLD.MT, 0.0) AS actualMT,
				NVL (BLD.M3, 0.0) AS actualM3,
				NVL (BLD.QTY, 0) AS actualQty
				,PART.VSL_NM AS VSLNM
				,DECODE(V.INB_VOY || ' / ' || V.OUTB_VOY, ' / ', '',V.INB_VOY || ' / ' || V.OUTB_VOY) AS VOYAGE
		FROM LD_INFO LD
				INNER JOIN TMT_GR GR ON LD.VSLCALLID = GR.VSL_CALL_ID AND LD.SNNO = GR.SHIPG_NOTE_NO
				INNER JOIN BARGE_LOADING BLD ON GR.VSL_CALL_ID = BLD.VSL_CALL_ID AND GR.GR_NO = BLD.CG_NO
				LEFT JOIN TMT_CG_MST C ON GR.VSL_CALL_ID = C.VSL_CALL_ID AND GR.GR_NO = C.CG_NO
				LEFT JOIN TMT_VSL_SCH V ON LD.VSLCALLID = V.VSL_CALL_ID
				LEFT JOIN TMT_VSL_PART PART ON PART.VSL_CD = LD.VSL_CD
		WHERE LD.CG_TP_CD IN ('DBE', 'BBK', 'DBN')
			AND BLD.CG_NO IS NOT NULL
			AND LD.DELV_TP_CD = 'D'
			<if test="vslCallId != null and vslCallId != ''">
			AND BLD.BARGE_NO = #{vslCallId} 
			</if>
UNION ALL
		SELECT
				DS.VSLCALLID,
				DS.VSL_CD,
				DS.BLNO,
				DS.LOTNO, 
				DS.SNNO,       
				DS.MFDOCID,
				DS.STAT_CD,
				DS.pkgTpCd,
				DS.PKGTPNM,
				DS.CATGCD,
				DS.catgCdNm,
				DS.CMDTCD,
				DS.CMDTCDNM,
				DS.DELV_TP_CD,
				DS.DELVTPNM,
				DS.CG_TP_CD,
				DS.CGTPCDNM,
				DS.SHPR,
				DS.shprNm,
				DS.CNSNE,
				DS.cnsneNm,
				DS.PORT_OF_DIS,
				NVL (D.D_MT, 0.0) AS docMT,
				NVL (D.D_M3, 0.0) AS docM3,
				NVL (D.D_QTY, 0) AS docQty,
				DISCH.SDO_NO AS GRSDO,
				DISCH.SDO_NO AS SDONO,
				'' AS GRNO,
				NVL(C.PORT_OF_DIS, DS.PORT_OF_DIS) AS POD,
				(SELECT PORT_NM FROM TMT_PORT_MST WHERE NVL(C.PORT_OF_DIS, DS.PORT_OF_DIS) = (CNTRY_CD || PORT_CD) AND ROWNUM=1) AS podNm,
				'' AS POL,
				'' AS POLNM,
				TO_CHAR (V.ATB, 'DD/MM/YYYY HH24:MI') AS ATB,
				TO_CHAR (V.ATU, 'DD/MM/YYYY HH24:MI') AS ATU, 
				DISCH.TSPT_TP_CD AS tsptTpCd,   
				F_CM_001 ('MT', 'TSPTTP', DISCH.TSPT_TP_CD) AS tsptTpNm, 
				NVL (DISCH.MT, 0.0) AS actualMT,
				NVL (DISCH.M3, 0.0) AS actualM3,
				NVL (DISCH.QTY, 0) AS actualQty
				,PART.VSL_NM AS VSLNM
				,DECODE(V.INB_VOY || ' / ' || V.OUTB_VOY, ' / ', '',V.INB_VOY || ' / ' || V.OUTB_VOY) AS VOYAGE
		FROM DS_INFO DS
				INNER JOIN TMT_DO DO ON DO.VSL_CALL_ID = DS.VSLCALLID AND DO.BL_NO = DS.BLNO
				LEFT JOIN DISCH ON DISCH.VSL_CALL_ID = DS.VSLCALLID AND DS.BLNO = DISCH.CG_NO
				LEFT JOIN TMT_DO_DTL D ON D.SDO_NO = DISCH.SDO_NO  AND D.BL_NO = DS.BLNO AND DS.VSLCALLID = D.VSL_CALL_ID 
				LEFT JOIN TMT_CG_MST C ON DS.VSLCALLID = C.VSL_CALL_ID AND DS.BLNO = C.CG_NO
				LEFT JOIN TMT_VSL_SCH V ON DS.VSLCALLID = V.VSL_CALL_ID
				LEFT JOIN TMT_VSL_PART PART ON PART.VSL_CD = DS.VSL_CD
		WHERE DS.CG_TP_CD IN ('DBE', 'BBK', 'DBN')
				AND DISCH.SDO_NO IS NOT NULL
				AND D.DELV_TP_CD = 'D'
			      <!-- AND D.TSPT_TP_CD = 'SE' -->
				<if test="vslCallId != null and vslCallId != ''">
					AND DISCH.VSL_CALL_ID = #{vslCallId} 
				</if>
UNION ALL
		/* Rehandle */
		SELECT
				DS.VSLCALLID,
				DS.VSL_CD,
				DS.BLNO,
				DS.LOTNO,
				DS.SNNO,
				DS.MFDOCID,
				DS.STAT_CD,
				DS.pkgTpCd,
				DS.PKGTPNM,
				DS.CATGCD,
				DS.catgCdNm,
				DS.CMDTCD,
				DS.CMDTCDNM,
				DS.DELV_TP_CD,
				DS.DELVTPNM,
				DS.CG_TP_CD,
				DS.CGTPCDNM,
				DS.SHPR,
				DS.shprNm,
				DS.CNSNE,
				DS.cnsneNm,
				DS.PORT_OF_DIS,
				NVL (DS.docMT, 0.0) AS docMT,
				NVL (DS.docM3, 0.0) AS docM3,
				NVL (DS.docQty, 0) AS docQty,
				DISCH.SDO_NO AS GRSDO,
				DISCH.SDO_NO AS SDONO,
				'' AS GRNO,
				NVL (C.PORT_OF_DIS, DS.PORT_OF_DIS) AS POD,
				(SELECT PORT_NM
				   FROM TMT_PORT_MST
				  WHERE     NVL (C.PORT_OF_DIS, DS.PORT_OF_DIS) =
				               (CNTRY_CD || PORT_CD)
				        AND ROWNUM = 1)
				   AS podNm,
				'' AS POL,
				'' AS POLNM,
				TO_CHAR (V.ATB, 'DD/MM/YYYY HH24:MI') AS ATB,
				TO_CHAR (V.ATU, 'DD/MM/YYYY HH24:MI') AS ATU,
				DISCH.TSPT_TP_CD AS tsptTpCd,
				F_CM_001 ('MT', 'TSPTTP', DISCH.TSPT_TP_CD) AS tsptTpNm,
				NVL (DISCH.MT, 0.0) AS actualMT,
				NVL (DISCH.M3, 0.0) AS actualM3,
				NVL (DISCH.QTY, 0) AS actualQty
				,PART.VSL_NM AS VSLNM
				,DECODE(V.INB_VOY || ' / ' || V.OUTB_VOY, ' / ', '',V.INB_VOY || ' / ' || V.OUTB_VOY) AS VOYAGE
		FROM DS_INFO DS 
				LEFT JOIN DISCH ON DISCH.VSL_CALL_ID = DS.VSLCALLID AND DS.BLNO = DISCH.CG_NO 
				LEFT JOIN TMT_CG_MST C ON DS.VSLCALLID = C.VSL_CALL_ID AND DS.BLNO = C.CG_NO
				LEFT JOIN TMT_VSL_SCH V ON DS.VSLCALLID = V.VSL_CALL_ID
				LEFT JOIN TMT_VSL_PART PART ON PART.VSL_CD = DS.VSL_CD
		WHERE DS.CG_TP_CD IN ('DBE', 'BBK', 'DBN')
				AND DS.CATGCD = 'T'
		 		<if test="vslCallId != null and vslCallId != ''">
					AND DISCH.VSL_CALL_ID = #{vslCallId} 
				</if>
UNION ALL
		SELECT 
				LD.VSLCALLID,
				LD.VSL_CD,
				'' AS BLNO,
				LD.LOTNO,
				LD.SNNO,
				LD.MFDOCID,
				LD.STAT_CD,
				LD.pkgTpCd,
				LD.PKGTPNM,
				LD.CATGCD,
				LD.catgCdNm,
				LD.CMDTCD,
				LD.CMDTCDNM,
				LD.DELV_TP_CD,
				LD.DELVTPNM,
				LD.CG_TP_CD,
				LD.CGTPCDNM,
				LD.SHPR,
				LD.shprNm,
				LD.CNSNE,
				LD.cnsneNm,
				LD.PORT_OF_LOAD,
				GR.CG_WGT AS docMT,
				GR.CG_VOL AS docM3,
				GR.PKG_QTY AS docQty,
				TS_LOADING.CG_NO AS GRSDO,
				'' AS SDONO,
				GR.GR_NO AS GRNO,
				'' AS POD,
				'' AS PODNM,
				NVL(C.PORT_OF_LOAD, LD.PORT_OF_LOAD) AS POL, 
				(SELECT PORT_NM FROM TMT_PORT_MST WHERE NVL(C.PORT_OF_LOAD, LD.PORT_OF_LOAD) = (CNTRY_CD || PORT_CD) AND ROWNUM=1) AS polNm, 
				TO_CHAR (V.ATB, 'DD/MM/YYYY HH24:MI') AS ATB,
				TO_CHAR (V.ATU, 'DD/MM/YYYY HH24:MI') AS ATU,
				TS_LOADING.TSPT_TP_CD AS tsptTpCd,
				F_CM_001 ('MT', 'TSPTTP', TS_LOADING.TSPT_TP_CD) AS tsptTpNm, 
				NVL (TS_LOADING.MT, 0.0) AS actualMT,
				NVL (TS_LOADING.M3, 0.0) AS actualM3,
				NVL (TS_LOADING.QTY, 0) AS actualQty
				,PART.VSL_NM AS VSLNM
				,DECODE(V.INB_VOY || ' / ' || V.OUTB_VOY, ' / ', '',V.INB_VOY || ' / ' || V.OUTB_VOY) AS VOYAGE
		FROM LD_INFO LD
				INNER JOIN TMT_GR GR ON LD.VSLCALLID = GR.VSL_CALL_ID AND LD.SNNO = GR.SHIPG_NOTE_NO
				INNER JOIN TS_LOADING ON GR.VSL_CALL_ID = TS_LOADING.VSL_CALL_ID AND GR.GR_NO = TS_LOADING.CG_NO
				LEFT JOIN TMT_CG_MST C ON GR.VSL_CALL_ID = C.VSL_CALL_ID AND GR.GR_NO = C.CG_NO
				LEFT JOIN TMT_VSL_SCH V ON LD.VSLCALLID = V.VSL_CALL_ID
				LEFT JOIN TMT_VSL_PART PART ON PART.VSL_CD = LD.VSL_CD
		WHERE LD.CG_TP_CD IN ('BBK', 'DBN') 
				AND	 TS_LOADING.CG_NO IS NOT NULL  
				AND LD.CATGCD = 'T'            
				<if test="vslCallId != null and vslCallId != ''">
					AND TS_LOADING.VSL_CALL_ID = #{vslCallId} 
				</if>
UNION ALL
		SELECT
				LD.VSLCALLID,
				LD.VSL_CD,
				'' AS BLNO,
				LD.LOTNO,
				LD.SNNO,
				LD.MFDOCID,
				LD.STAT_CD,
				LD.pkgTpCd,
				LD.PKGTPNM,
				LD.CATGCD,
				LD.catgCdNm,
				LD.CMDTCD,
				LD.CMDTCDNM,
				LD.DELV_TP_CD,
				LD.DELVTPNM,
				LD.CG_TP_CD,
				LD.CGTPCDNM,
				LD.SHPR,
				LD.shprNm,
				LD.CNSNE,
				LD.cnsneNm,
				LD.PORT_OF_LOAD,
				GR.CG_WGT AS docMT,
				GR.CG_VOL AS docM3,
				GR.PKG_QTY AS docQty,
				LOADING.CG_NO AS GRSDO,
				'' AS SDONO,
				GR.GR_NO AS GRNO,
				'' AS POD,
				'' AS PODNM,
				NVL(C.PORT_OF_LOAD, LD.PORT_OF_LOAD) AS POL, 
				(SELECT PORT_NM FROM TMT_PORT_MST WHERE NVL(C.PORT_OF_LOAD, LD.PORT_OF_LOAD) = (CNTRY_CD || PORT_CD) AND ROWNUM=1) AS polNm, 
				TO_CHAR (V.ATB, 'DD/MM/YYYY HH24:MI') AS ATB,
				TO_CHAR (V.ATU, 'DD/MM/YYYY HH24:MI') AS ATU,
				LOADING.TSPT_TP_CD AS tsptTpCd,
				F_CM_001 ('MT', 'TSPTTP', LOADING.TSPT_TP_CD) AS tsptTpNm, 
				NVL (LOADING.MT, 0.0) AS actualMT,
				NVL (LOADING.M3, 0.0) AS actualM3,
				NVL (LOADING.QTY, 0) AS actualQty
				,PART.VSL_NM AS VSLNM
				,DECODE(V.INB_VOY || ' / ' || V.OUTB_VOY, ' / ', '',V.INB_VOY || ' / ' || V.OUTB_VOY) AS VOYAGE
		FROM LD_INFO LD
				INNER JOIN TMT_GR GR ON LD.VSLCALLID = GR.VSL_CALL_ID AND LD.SNNO = GR.SHIPG_NOTE_NO
				INNER JOIN LOADING ON GR.VSL_CALL_ID = LOADING.VSL_CALL_ID AND GR.GR_NO = LOADING.CG_NO
				LEFT JOIN TMT_CG_MST C ON GR.VSL_CALL_ID = C.VSL_CALL_ID AND GR.GR_NO = C.CG_NO
				LEFT JOIN TMT_VSL_SCH V ON LD.VSLCALLID = V.VSL_CALL_ID
				LEFT JOIN TMT_VSL_PART PART ON PART.VSL_CD = LD.VSL_CD
		WHERE LD.CG_TP_CD IN ('BBK', 'DBN')
		        <!-- AND GR.TSPT_TP_CD = 'SE' -->
		        AND LD.DELV_TP_CD = 'D'
		        AND LOADING.CG_NO IS NOT NULL
				<if test="vslCallId != null and vslCallId != ''">
					AND LOADING.VSL_CALL_ID = #{vslCallId} 
				</if>
	
<!-- UNION ALL
	SELECT LD.*,
		GR.GR_NO AS GRSDO,
		'' AS SDONO,
		GR.GR_NO AS GRNO,
	    '' AS POD,
	    '' AS PODNM,
	    NVL(C.PORT_OF_LOAD, LD.PORT_OF_LOAD) AS POL, 
	    (SELECT PORT_NM FROM TMT_PORT_MST WHERE NVL(C.PORT_OF_LOAD, LD.PORT_OF_LOAD) = (CNTRY_CD || PORT_CD) AND ROWNUM=1) AS polNm, 
	    TO_CHAR (V.ATB, 'DD/MM/YYYY HH24:MI') AS ATB,
	    TO_CHAR (V.ATU, 'DD/MM/YYYY HH24:MI') AS ATU,
	    LOADING.TSPT_TP_CD AS tsptTpCd,
	    F_CM_001 ('MT', 'TSPTTP', LOADING.TSPT_TP_CD) AS tsptTpNm, 
	    NVL (LOADING.MT, 0.0) AS actualMT,
	    NVL (LOADING.M3, 0.0) AS actualM3,
	    NVL (LOADING.QTY, 0) AS actualQty
	FROM LD_INFO LD
	    INNER JOIN TMT_GR GR ON LD.VSLCALLID = GR.VSL_CALL_ID AND LD.SNNO = GR.SHIPG_NOTE_NO
	    INNER JOIN LOADING ON GR.VSL_CALL_ID = LOADING.VSL_CALL_ID AND GR.GR_NO = LOADING.CG_NO
	    LEFT JOIN TMT_CG_MST C ON GR.VSL_CALL_ID = C.VSL_CALL_ID AND GR.GR_NO = C.CG_NO
	    LEFT JOIN TMT_VSL_SCH V ON LD.VSLCALLID = V.VSL_CALL_ID
	    LEFT JOIN TMT_VSL_PART PART ON PART.VSL_CD = LD.VSL_CD
	WHERE LD.CG_TP_CD IN ('BBK', 'DBN') AND GR.TSPT_TP_CD NOT IN ('SE')
	<if test="vslCallId != null and vslCallId != ''">
		AND LD.VSLCALLID = #{vslCallId} 
	</if>-->	
<!-- SELECT DS.*,
		''  AS GRSDO,
		DISCH.SDO_NO AS SDONO,
		'' AS GRNO,
		NVL(C.PORT_OF_DIS, DS.PORT_OF_DIS) AS POD,
        (SELECT PORT_NM FROM TMT_PORT_MST WHERE NVL(C.PORT_OF_DIS, DS.PORT_OF_DIS) = (CNTRY_CD || PORT_CD) AND ROWNUM=1) AS podNm,
        '' AS POL,
        '' AS POLNM,
        TO_CHAR (V.ATB, 'DD/MM/YYYY HH24:MI') AS ATB,
        TO_CHAR (V.ATU, 'DD/MM/YYYY HH24:MI') AS ATU, 
        DISCH.TSPT_TP_CD AS tsptTpCd,   
        F_CM_001 ('MT', 'TSPTTP', DISCH.TSPT_TP_CD) AS tsptTpNm, 
        NVL (DISCH.MT, 0.0) AS actualMT,
        NVL (DISCH.M3, 0.0) AS actualM3,
        NVL (DISCH.QTY, 0) AS actualQty
FROM DS_INFO DS
    LEFT JOIN TMT_CG_MST C ON DS.VSLCALLID = C.VSL_CALL_ID AND DS.BLNO = C.CG_NO
    LEFT JOIN DISCH ON DS.VSLCALLID = DISCH.VSL_CALL_ID AND DS.BLNO = DISCH.CG_NO
    LEFT JOIN TMT_VSL_SCH V ON DS.VSLCALLID = V.VSL_CALL_ID
    LEFT JOIN TMT_VSL_PART PART ON PART.VSL_CD = DS.VSL_CD
    LEFT JOIN TMT_DO_DTL D  ON DS.VSLCALLID = D.VSL_CALL_ID AND DS.BLNO = D.BL_NO AND DISCH.SDO_NO = D.SDO_NO 
WHERE DS.CG_TP_CD IN ('DBE', 'BBK', 'DBN')
	AND D.TSPT_TP_CD NOT IN ('SE')
<if test="vslCallId != null and vslCallId != ''">
	AND DS.VSLCALLID = #{vslCallId} 
</if>
UNION ALL -->
) F1
ORDER BY F1.VSLCALLID
		, F1.MFDOCID
		, F1.GRSDO
		, F1.SDONO
		, F1.GRNO
	
</select>


<select id="selectPortDepartureReport" parameterType="vorDryBreakBulkParm" resultType="vorDryBreakBulkItem">
	WITH
NON_WORKING
AS (
	SELECT  MAX(T.VSLCALLID) AS VSLCALLID,
			SUM(T.idleTime) AS idleTime<!-- ,
			SUM(T.TOTALHRS) AS TOTALHRS -->
    FROM
    (
		SELECT  A.VSL_CALL_ID AS VSLCALLID,
				TO_CHAR ( 
					SUM( ROUND ( NVL ( F_INTERVAL_OF_HOUR ('NR', END_DT, ST_DT), 0) * 100) / 100), '99999990.00'
				) AS idleTime<!-- ,
				TO_CHAR ( 
					ROUND ( NVL ( F_INTERVAL_OF_HOUR ('NR', END_DT, ST_DT), 0) * 100) / 100, '99999990.00'
				) AS TOTALHRS -->
		FROM TMT_DLY_BRK A
		LEFT JOIN TMT_DLY_CD CD ON CD.DLY_CD = A.RSN_CD
		WHERE A.ACPT_YN = 'N' AND CD.DLY_CATG_CD IN ('V') AND CD.CHAG_YN = 'N'
		<if test="vslCallId != null and vslCallId != ''">
			AND A.VSL_CALL_ID = #{vslCallId} 
		</if>
        GROUP BY A.VSL_CALL_ID, A.END_DT, A.ST_DT  
    ) T
    GROUP BY T.VSLCALLID
),
BL_INFO AS (
    SELECT  BL.VSL_CALL_ID AS VSLCALLID,
        BL.VSL_CD,
        SUM (BL.CG_WGT) AS CG_WGT,
        SUM (BL.CG_VOL) AS CG_VOL,
        SUM (BL.PKG_QTY) AS PKG_QTY
    FROM TMT_BL BL  
    WHERE BL.CG_TP_CD NOT IN ('RCV') AND BL.STAT_CD = 'AP' 
    <if test="vslCallId != null and vslCallId != ''">
		AND BL.VSL_CALL_ID = #{vslCallId} 
	</if>
    GROUP BY BL.VSL_CALL_ID,
        BL.VSL_CD
)
,VSL_INFO AS (
    SELECT 
        V.VSL_CALL_ID AS VSLCALLID,
        V.VSL_CD,
        PART.VSL_NM AS VSLNM,
        B.ENG_SNM AS shaNm,
        B.ADDR as addr,
		PART.VSL_TP AS vslTp,
		(SELECT C.S_CD_NM FROM TMT_CD_MSTD C WHERE C.L_CD = 'VC' AND C.M_CD = 'VSLTP' AND C.S_CD = PART.VSL_TP ) vspNm ,
        DECODE(V.INB_VOY || ' / ' || V.OUTB_VOY, ' / ', '',V.INB_VOY || ' / ' || V.OUTB_VOY) AS VOYAGE,
        V.BERTH_LOC AS berthLocId,
        TO_CHAR (V.ETB, 'DD/MM/YYYY HH24:MI') AS ETB,
        TO_CHAR (V.ETU, 'DD/MM/YYYY HH24:MI') AS ETU,
		TO_CHAR (V.ATB, 'DD/MM/YYYY HH24:MI') AS ATB,
        TO_CHAR (V.ATU, 'DD/MM/YYYY HH24:MI') AS ATU,
        DECODE(V.ARRV_FWD_DRF || ' / ' || V.ARRV_AFTER_DRF, ' / ', '', V.ARRV_FWD_DRF || ' / ' || V.ARRV_AFTER_DRF) AS arrivalDraft,
        DECODE(V.DEPT_FWD_DRF || ' / ' || V.DEPT_AFTER_DRF,' / ', '',  V.DEPT_FWD_DRF || ' / ' || V.DEPT_AFTER_DRF) AS departurelDraft,
        V.ATC AS ATC1,
        V.ATW AS ATW1,
        <!-- TO_CHAR (ROUND(NVL(((V.ATC - V.ATW) * 24 ),0),2), '99999990.00') AS operatingTime, -->
        TO_CHAR (ROUND(NVL(((V.ATU - V.ATB) * 24 ),0),2), '99999990.00') AS portStayTime
    FROM TMT_VSL_SCH V
    INNER JOIN TMT_VSL_PART PART ON PART.VSL_CD = V.VSL_CD
    LEFT JOIN  TMT_AGENCY_INFO B ON V.ARRV_SA_ID = B.AGENCY_CODE
    WHERE 1=1
    <if test="vslCallId != null and vslCallId != ''">
		AND V.VSL_CALL_ID = #{vslCallId} 
	</if>
)
,DS_JOB_BY_VSL AS (  
    SELECT JO.VSL_CALL_ID, 
        NVL(SUM(JO.CG_WGT), 0)  AS MT,
        NVL (SUM(JO.CG_VOL), 0)  AS M3,
        NVL(SUM(JO.PKG_QTY), 0) AS QTY
    FROM TMT_JOB JO
    WHERE JO.JOB_PURP_CD IN ('VG', 'VB', 'VA') 
    <if test="vslCallId != null and vslCallId != ''">
		AND JO.VSL_CALL_ID = #{vslCallId} 
	</if>
    GROUP BY JO.VSL_CALL_ID 
)
,LD_JOB_BY_VSL AS (  
    SELECT JO.VSL_CALL_ID, 
        NVL(SUM(JO.CG_WGT), 0)  AS MT,
        NVL(SUM(JO.CG_VOL), 0)  AS M3,
        NVL(SUM(JO.PKG_QTY), 0) AS QTY
    FROM TMT_JOB JO
    WHERE JO.JOB_PURP_CD IN ('GV', 'BV', 'AV')
    <if test="vslCallId != null and vslCallId != ''">
		AND JO.VSL_CALL_ID = #{vslCallId} 
	</if>
    GROUP BY JO.VSL_CALL_ID 
)
,SHIP_CRANE_DS_JOB AS (		<!-- Discharging of Ship Crane  -->
    SELECT JO.VSL_CALL_ID, 
            NVL(SUM(JO.CG_WGT), 0)  AS MT,
            NVL(SUM(JO.CG_VOL), 0)  AS M3,
            NVL(SUM(JO.PKG_QTY), 0) AS QTY,
            EQ_NO  
    FROM TMT_JOB JO
    INNER JOIN TMT_EQ_FAC EQ ON EQ.EQ_FAC_NO = JO.EQ_NO  
    WHERE JO.JOB_PURP_CD IN ('VG', 'VB', 'VA')
    <if test="vslCallId != null and vslCallId != ''">
		AND JO.VSL_CALL_ID = #{vslCallId} 
	</if>
    AND EQ.EQ_TP_CD = 'SC'
    GROUP BY JO.VSL_CALL_ID, JO.EQ_NO 
)
,SHIP_CRANE_LD_JOB AS (		<!-- Loading of Ship Crane  -->
    SELECT JO.VSL_CALL_ID, 
            NVL(SUM(JO.CG_WGT), 0)  AS MT,
            NVL(SUM(JO.CG_VOL), 0)  AS M3,
            NVL(SUM(JO.PKG_QTY), 0) AS QTY,
            EQ_NO  
    FROM TMT_JOB JO
    INNER JOIN TMT_EQ_FAC EQ ON EQ.EQ_FAC_NO = JO.EQ_NO  
    WHERE JO.JOB_PURP_CD IN ('GV', 'BV', 'AV')
    <if test="vslCallId != null and vslCallId != ''">
		AND JO.VSL_CALL_ID = #{vslCallId} 
	</if>
    AND EQ.EQ_TP_CD = 'SC'
    GROUP BY JO.VSL_CALL_ID, JO.EQ_NO 
)

SELECT  VSL.*,
	TO_CHAR (WRK.idleTime, '99999990.00') AS idleTime,
	TO_CHAR (VSL.portStayTime - WRK.idleTime, '99999990.00') AS operatingTime,
	TO_CHAR (VSL.ATW1, 'DD/MM/YYYY HH24:MI') AS ATW,
	TO_CHAR (VSL.ATC1, 'DD/MM/YYYY HH24:MI') AS ATC,
	TO_CHAR(((NVL(DSJO.MT, 0) + NVL(LDJO.MT, 0)) - (NVL(DSSC.MT, 0)+NVL(LDSC.MT, 0))),'999,999,999,999.000') AS shrCrneOpr
FROM VSL_INFO VSL
	LEFT JOIN DS_JOB_BY_VSL DSJO ON DSJO.VSL_CALL_ID = VSL.VSLCALLID
	LEFT JOIN LD_JOB_BY_VSL LDJO ON LDJO.VSL_CALL_ID = VSL.VSLCALLID
	LEFT JOIN SHIP_CRANE_DS_JOB DSSC ON DSSC.VSL_CALL_ID = VSL.VSLCALLID
	LEFT JOIN SHIP_CRANE_LD_JOB LDSC ON LDSC.VSL_CALL_ID = VSL.VSLCALLID
	LEFT JOIN NON_WORKING WRK ON VSL.VSLCALLID = WRK.VSLCALLID
WHERE 1=1
<if test="vslCallId != null and vslCallId != ''">
	AND VSL.VSLCALLID = #{vslCallId} 
</if>

</select>



	
</mapper>
