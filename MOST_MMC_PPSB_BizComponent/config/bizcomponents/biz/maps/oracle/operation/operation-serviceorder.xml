<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="serviceOrder">

	<resultMap id="ServiceOrderMap" type="serviceOrderItem">
		<result column="ODR_NO" property="odrNo"/>
		<result column="CATEGORY1" property="category1"/>
		<result column="CATEGORY1_NM" property="category1Nm"/>
		<result column="CATEGORY2" property="category2"/>
		<result column="CATEGORY2_NM" property="category2Nm"/>
		<result column="CATEGORY3" property="category3"/>
		<result column="CATEGORY3_NM" property="category3Nm"/>
		<result column="SVC_DT_FMT" property="svcDtFmt"/>
		<result column="SVC_DT_TP" property="svcDtTp"/>
		<result column="DT1_CHK" property="dt1Chk"/>
		<result column="DT1_TIT" property="dt1Tit"/>
		<result column="DT1_FMT" property="dt1Fmt"/>
		<result column="DT1_TP" property="dt1Tp"/>
		<result column="DT2_CHK" property="dt2Chk"/>
		<result column="DT2_TIT" property="dt2Tit"/>
		<result column="DT2_FMT" property="dt2Fmt"/>
		<result column="DT2_TP" property="dt2Tp"/>
		<result column="SHFT_CHK" property="shftChk"/>
		<result column="UNIT_TIT" property="unitTit"/>
		<result column="UNIT_UOM" property="unitUom"/>
		<result column="UNIT_UOM_NM" property="unitUomNm"/>
		<result column="UNIT_DEC" property="unitDec"/>
		<result column="UNIT1_CHK" property="unit1Chk"/>
		<result column="UNIT1_TIT" property="unit1Tit"/>
		<result column="UNIT1_UOM" property="unit1Uom"/>
		<result column="UNIT1_UOM_NM" property="unit1UomNm"/>
		<result column="UNIT1_DEC" property="unit1Dec"/>
		<result column="UNIT2_CHK" property="unit2Chk"/>
		<result column="UNIT2_TIT" property="unit2Tit"/>
		<result column="UNIT2_UOM" property="unit2Uom"/>
		<result column="UNIT2_UOM_NM" property="unit2UomNm"/>
		<result column="UNIT2_DEC" property="unit2Dec"/>
		<result column="PAY_TP_CD" property="payTpCd"/>
		<result column="PAY_TP_NM" property="payTpNm"/>
		<result column="PRC_TP_CD" property="prcTpCd"/>
		<result column="PRC_TP_NM" property="prcTpNm"/>
		<result column="PRC_TP_DESC" property="prcTpDesc"/>
		<result column="LOC_CHK" property="locChk"/>
		<result column="RMK_CHK" property="rmkChk"/>
		<result column="CMDTY_CHK" property="cmdtyChk"/>
		<result column="EQ_DIV_CD" property="eqDivCd"/>
		<result column="EQ_DIV_CD_NM" property="eqDivCdNm"/>
		<result column="ODR_NO" property="odrNo"/>
		<result column="VSL_CALL_ID" property="vslCallId"/>
		<result column="VSL_NM" property="vslNm"/>
		<result column="STAT_CD" property="statCd"/>
		<result column="STAT_NM" property="statNm"/>
		<result column="PAYER" property="payer"/>
		<result column="PAYER_NM" property="payerNm"/>
		<result column="SVC_DT_FM" property="svcDtFm"/>
		<result column="SVC_DT_TO" property="svcDtTo"/>
		<result column="DT1_FM" property="dt1Fm"/>
		<result column="DT1_TO" property="dt1To"/>
		<result column="DT2_FM" property="dt2Fm"/>
		<result column="DT2_TO" property="dt2To"/>
		<result column="SHFT_ID" property="shftId"/>
		<result column="SHFT_NM" property="shftNm"/>
		<result column="UNIT" property="unit"/>
		<result column="UNIT1" property="unit1"/>
		<result column="UNIT2" property="unit2"/>
		<result column="CAPA_CD" property="capaCd"/>
		<result column="CAPA_DESCR" property="capaDescr"/>
		<result column="LOC" property="loc"/>
		<result column="LOC_ID" property="locId"/>
		<result column="CMDTY_CD" property="cmdtyCd"/>
		<result column="CMDTY_NM" property="cmdtyNm"/>
		<result column="COM_CMDTY_CD" property="comCmdtyCd"/>
		<result column="COM_CMDTY_NM" property="comCmdtyNm"/>
		<result column="REQ_RMK" property="reqRmk"/>
		<result column="RMK" property="rmk"/>
		<result column="COM_CHK" property="comChk"/>
		<result column="COM_SVC_DT_FM" property="comSvcDtFm"/>
		<result column="COM_SVC_DT_TO" property="comSvcDtTo"/>
		<result column="COM_DT1_FM" property="comDt1Fm"/>
		<result column="COM_DT1_TO" property="comDt1To"/>
		<result column="COM_DT2_FM" property="comDt2Fm"/>
		<result column="COM_DT2_TO" property="comDt2To"/>
		<result column="COM_SHFT_ID" property="comShftId"/>
		<result column="COM_SHFT_NM" property="comShftNm"/>
		<result column="COM_UNIT" property="comUnit"/>
		<result column="COM_UNIT1" property="comUnit1"/>
		<result column="COM_UNIT2" property="comUnit2"/>
		<result column="COM_CAPA_CD" property="comCapaCd"/>
		<result column="COM_CAPA_DESCR" property="comCapaDescr"/>
		<result column="COM_LOC" property="comLoc"/>
		<result column="COM_RMK" property="comRmk"/>
		<result column="SUMIT_BY" property="sumitBy"/>
		<result column="SUMIT_DT" property="sumitDt"/>
		<result column="APPRV_BY" property="apprvBy"/>
		<result column="APPRV_DT" property="apprvDt"/>
		<result column="REJ_BY" property="rejBy"/>
		<result column="REJ_DT" property="rejDt"/>
		<result column="CNCL_BY" property="cnclBy"/>
		<result column="CNCL_DT" property="cnclDt"/>
		<result column="COM_BY" property="comBy"/>
		<result column="COM_DT" property="comDt"/>
		<result column="OWNER_YN" property="ownerYn"/>
		<result column="VIEW_TYPE" property="viewType"/>
		<result column="USER_ROLE" property="userRole"/>
		<result column="COM_LOC_ID" property="comLocId"/>
		<result column="REQ_DOC_NO" property="reqDocNo"/>
		<result column="REQ_UNIT_NO" property="reqUnitNo"/>
		<result column="COM_DOC_NO" property="comDocNo"/>
		<result column="COM_UNIT_NO" property="comUnitNo"/>
		<result column="STAFF_CD" property="userId"/>
	</resultMap>
	
	<select id="selectSvcOdrNo" parameterType="serviceOrderParm" resultMap="ServiceOrderMap">
		SELECT ('ODR'||TO_CHAR(SYSDATE, 'YYMM')||'-'||TRIM(TO_CHAR(NVL(MAX(TO_NUMBER(SUBSTR(ODR_NO, -4, 4))+1), 1),'0000'))) AS ODR_NO
		FROM TMT_SVC_ODR
		WHERE SUBSTR(ODR_NO, 1, 7) = ('ODR'||TO_CHAR(SYSDATE, 'YYMM'))
	</select>

	<sql id="sqlServiceOrderInfo">
		SELECT /*serviceOrder.sqlServiceOrderInfo*/
			   A.ODR_NO
		     , A.VSL_CALL_ID
		     , (SELECT VSL_NM FROM TMT_VSL_SCH VS, TMT_VSL_PART VP WHERE VS.VSL_CALL_ID = A.VSL_CALL_ID AND VS.VSL_CD = VP.VSL_CD) VSL_NM
		     , STAT_CD
		     , F_CM_012('MT', 'DOCSTAT', STAT_CD) STAT_NM
		     , NVL((SELECT (USER_ID || '/' || ENG_NM) FROM TMT_USER_INFO WHERE USER_ID = SUMIT_BY), SUMIT_BY) SUMIT_BY
		     , TO_CHAR(SUMIT_DT, 'DD/MM/YYYY HH24:MI') SUMIT_DT
		     , NVL((SELECT (USER_ID || '/' || ENG_NM) FROM TMT_USER_INFO WHERE USER_ID = APPRV_BY), APPRV_BY) APPRV_BY
		     , TO_CHAR(APPRV_DT, 'DD/MM/YYYY HH24:MI') APPRV_DT
		     , NVL((SELECT (USER_ID || '/' || ENG_NM) FROM TMT_USER_INFO WHERE USER_ID = REJ_BY), REJ_BY) REJ_BY
		     , TO_CHAR(REJ_DT, 'DD/MM/YYYY HH24:MI') REJ_DT
		     , NVL((SELECT (USER_ID || '/' || ENG_NM) FROM TMT_USER_INFO WHERE USER_ID = CNCL_BY), CNCL_BY) CNCL_BY
		     , TO_CHAR(CNCL_DT, 'DD/MM/YYYY HH24:MI') CNCL_DT
		     , NVL((SELECT (USER_ID || '/' || ENG_NM) FROM TMT_USER_INFO WHERE USER_ID = COM_BY), COM_BY) COM_BY
		     , TO_CHAR(COM_DT, 'DD/MM/YYYY HH24:MI') COM_DT
		     , PAYER
		     , NVL((SELECT MAX(ENG_SNM) FROM TMT_AGENCY_INFO WHERE AGENCY_CODE = PAYER), NVL((SELECT MAX(ENG_SNM) FROM TMT_PTNR WHERE PTNR_CODE = PAYER), ' ')) PAYER_NM
		     , CATEGORY1
		     , F_CM_012('MT', 'SVCORDCTG1', CATEGORY1) CATEGORY1_NM
		     , CATEGORY2
		     , F_CM_012('MT', 'SVCORDCTG2', CATEGORY2) CATEGORY2_NM
		     , CATEGORY3
		     , F_CM_012('MT', 'SVCORDCTG3', CATEGORY3) CATEGORY3_NM
		     , SVC_DT_FMT
		     , SVC_DT_TP
		     , DT1_CHK
		     , DT1_TIT
		     , DT1_FMT
		     , DT1_TP
		     , DT2_CHK
		     , DT2_TIT
		     , DT2_FMT
		     , DT2_TP
		     , SHFT_CHK
		     , UNIT_TIT
		     , UNIT_UOM
		     , F_CM_012('MT', 'UOMTP', UNIT_UOM) UNIT_UOM_NM
		     , UNIT_DEC
		     , UNIT1_CHK
		     , UNIT1_TIT
		     , UNIT1_UOM
		     , F_CM_012('MT', 'UOMTP', UNIT1_UOM) UNIT1_UOM_NM
		     , UNIT1_DEC
		     , UNIT2_CHK
		     , UNIT2_TIT
		     , UNIT2_UOM
		     , F_CM_012('MT', 'UOMTP', UNIT2_UOM) UNIT2_UOM_NM
		     , UNIT2_DEC
		     , EQ_DIV_CD
		     , F_CM_012('MT', 'EQFCTPCD', A.EQ_DIV_CD)	EQ_DIV_CD_NM
		     , NVL(CAPA_CD, '') CAPA_CD
		     , (SELECT CAPA_DESCR FROM TMT_EQ_CAPA WHERE CAPA_CD = A.CAPA_CD AND EQ_TP_CD = A.EQ_DIV_CD) CAPA_DESCR
		     , PAY_TP_CD
		     , F_CM_012('MT', 'PAYTP', PAY_TP_CD)		PAY_TP_NM
		     , PRC_TP_CD
		     , F_CM_012('MT', 'ODRPRCTP', PRC_TP_CD)	PRC_TP_NM
			 , (SELECT S_CD_DESC FROM TMT_CD_MSTD WHERE L_CD = 'MT' AND M_CD = 'ODRPRCTP' AND S_CD = PRC_TP_CD) PRC_TP_DESC
		     , LOC_CHK
		     , RMK_CHK
		     , CMDTY_CHK
		     , DECODE(SVC_DT_FMT, 'd/m/Y', TO_CHAR(SVC_DT_FM, 'DD/MM/YYYY'), TO_CHAR(SVC_DT_FM, 'DD/MM/YYYY HH24:MI')) SVC_DT_FM
		     , DECODE(SVC_DT_FMT, 'd/m/Y', TO_CHAR(SVC_DT_TO, 'DD/MM/YYYY'), TO_CHAR(SVC_DT_TO, 'DD/MM/YYYY HH24:MI')) SVC_DT_TO
		     , DECODE(DT1_FMT, 'd/m/Y', TO_CHAR(DT1_FM, 'DD/MM/YYYY'), TO_CHAR(DT1_FM, 'DD/MM/YYYY HH24:MI'))	DT1_FM
		     , DECODE(DT1_FMT, 'd/m/Y', TO_CHAR(DT1_TO, 'DD/MM/YYYY'), TO_CHAR(DT1_TO, 'DD/MM/YYYY HH24:MI'))	DT1_TO
		     , DECODE(DT2_FMT, 'd/m/Y', TO_CHAR(DT2_FM, 'DD/MM/YYYY'), TO_CHAR(DT2_FM, 'DD/MM/YYYY HH24:MI'))	DT2_FM
		     , DECODE(DT2_FMT, 'd/m/Y', TO_CHAR(DT2_TO, 'DD/MM/YYYY'), TO_CHAR(DT2_TO, 'DD/MM/YYYY HH24:MI'))	DT2_TO
		     , SHFT_ID
		     , (SELECT SH.SHFT_NM FROM TMT_SHFT SH WHERE SH.SHFT_ID = A.SHFT_ID) SHFT_NM
		     , UNIT
		     , UNIT1
		     , UNIT2
		     , LOC_ID
		     , REQ_RMK
		     , COM_CHK
		     , CMDTY_CD
		     , F_GET_CMDT_DESC(CMDTY_CD) CMDTY_NM
		     , COM_CMDTY_CD COM_CMDTY_CD
		     , F_GET_CMDT_DESC(COM_CMDTY_CD) COM_CMDTY_NM
		     , DECODE(SVC_DT_FMT, 'd/m/Y', TO_CHAR(COM_SVC_DT_FM, 'DD/MM/YYYY'), TO_CHAR(COM_SVC_DT_FM, 'DD/MM/YYYY HH24:MI'))	COM_SVC_DT_FM
		     , DECODE(SVC_DT_FMT, 'd/m/Y', TO_CHAR(COM_SVC_DT_TO, 'DD/MM/YYYY'), TO_CHAR(COM_SVC_DT_TO, 'DD/MM/YYYY HH24:MI'))	COM_SVC_DT_TO
		     , DECODE(DT1_FMT, 'd/m/Y', TO_CHAR(COM_DT1_FM, 'DD/MM/YYYY'), TO_CHAR(COM_DT1_FM, 'DD/MM/YYYY HH24:MI')) COM_DT1_FM
		     , DECODE(DT1_FMT, 'd/m/Y', TO_CHAR(COM_DT1_TO, 'DD/MM/YYYY'), TO_CHAR(COM_DT1_TO, 'DD/MM/YYYY HH24:MI')) COM_DT1_TO
		     , DECODE(DT2_FMT, 'd/m/Y', TO_CHAR(COM_DT2_FM, 'DD/MM/YYYY'), TO_CHAR(COM_DT2_FM, 'DD/MM/YYYY HH24:MI')) COM_DT2_FM
		     , DECODE(DT2_FMT, 'd/m/Y', TO_CHAR(COM_DT2_TO, 'DD/MM/YYYY'), TO_CHAR(COM_DT2_TO, 'DD/MM/YYYY HH24:MI')) COM_DT2_TO
		     , NVL (com_shft_id, decode(com_svc_dt_fm, null,null, F_GET_SHIFT_CD (com_svc_dt_fm))) COM_SHFT_ID
		     , (SELECT MAX (SH.SHFT_NM) FROM TMT_SHFT SH WHERE SH.SHFT_ID = NVL(A.COM_SHFT_ID, DECODE(A.COM_SVC_DT_FM, null,null, F_GET_SHIFT_CD (A.COM_SVC_DT_FM)))) COM_SHFT_NM
		     , COM_UNIT
		     , COM_UNIT1
		     , COM_UNIT2
		     , NVL(COM_CAPA_CD, '') COM_CAPA_CD
		     , (SELECT CAPA_DESCR FROM TMT_EQ_CAPA WHERE CAPA_CD = A.COM_CAPA_CD AND EQ_TP_CD = A.EQ_DIV_CD) COM_CAPA_DESCR
		     , COM_LOC_ID
		     , COM_RMK
		     , RMK
		     , DECODE(CRT_BY, #{userId}, 'Y', 'N') OWNER_YN
		     , VERSION
		     , REQ_DOC_NO
	       	 , COM_DOC_NO
	         , REQ_UNIT_NO
	         , COM_UNIT_NO
	         , STAFF_CD 
		FROM  TMT_SVC_ODR A
		WHERE  A.ODR_NO IS NOT NULL
		<if test="vslCallId != null and vslCallId != ''">
			AND A.VSL_CALL_ID = #{vslCallId}
		</if>
		<if test="svcDtFm != null and svcDtFm != ''">
			<if test="svcDtTo != null and svcDtTo != ''">
				AND SVC_DT_FM BETWEEN TO_DATE(#{svcDtFm}||' 00:00','DD/MM/YYYY HH24:MI') AND TO_DATE(#{svcDtTo}||' 23:59','DD/MM/YYYY HH24:MI')
			</if>
			<if test="svcDtTo == null or svcDtTo == ''">
				AND SVC_DT_FM &gt; TO_DATE(#{svcDtFm}||' 00:00','DD/MM/YYYY HH24:MI')
			</if>
		</if>
		<if test="svcDtFm == null or svcDtFm == ''">
			<if test="svcDtTo != null and svcDtTo != ''">
				AND SVC_DT_FM &lt; TO_DATE(#{svcDtTo}||' 23:59','DD/MM/YYYY HH24:MI')
			</if>
		</if>
		<if test="shftId != null and shftId != ''">
			AND SHFT_ID = #{shftId}
		</if>
		<if test="statCd != null and statCd != ''">
			AND STAT_CD = #{statCd}
		</if>
		<if test="category1 != null and category1 != ''">
			AND CATEGORY1 = #{category1}
		</if>
		<if test="category2 != null and category2 != ''">
			AND CATEGORY2 = #{category2}
		</if>
		<if test="category3 != null and category3 != ''">
			AND CATEGORY3 = #{category3}
		</if>
		<if test="alertYn == 'Y'">
			AND STAT_CD = 'SU'
			AND (SYSDATE - SUMIT_DT) &lt;= 180
		</if>
	</sql>

	<select id="selectRoadBunkeringList" parameterType="serviceOrderParm" resultMap="ServiceOrderMap">
		<include refid="sqlServiceOrderInfo"/>
		AND CATEGORY1 = 'SM'
		AND CATEGORY2 = 'MSM003'
		AND STAT_CD IN ('AP', 'CP')
		AND PRC_TP_CD IN ('A','C')
	</select>

	<select id="selectServiceOrderInfo" parameterType="serviceOrderParm" resultMap="ServiceOrderMap">
		<include refid="sqlServiceOrderInfo"/>
		AND SUMIT_BY = #{userId}
		<if test="userRole == 'CS'">
			UNION ALL
			<include refid="sqlServiceOrderInfo"/>
			AND SUMIT_BY &lt;&gt; #{userId}
			AND STAT_CD &lt;&gt; 'CA'
			AND PRC_TP_CD IN ('A','C')
		</if>
		<if test="userRole == 'PS'">
			UNION ALL
			<include refid="sqlServiceOrderInfo"/>
			AND SUMIT_BY &lt;&gt; #{userId}
			AND STAT_CD &lt;&gt; 'CA'
			AND PRC_TP_CD IN ('B','C')
		</if>
		<if test="userRole == 'BS'">
			UNION ALL
			<include refid="sqlServiceOrderInfo"/>
			AND STAT_CD &lt;&gt; 'CA'
			AND SUMIT_BY &lt;&gt; #{userId}
		</if>
		ORDER BY A.ODR_NO DESC
	</select>

	<select id="selectServiceOrderItem" parameterType="serviceOrderParm" resultMap="ServiceOrderMap">
		/*serviceOrder.selectServiceOrderItem*/
		<include refid="sqlServiceOrderInfo"/>
		AND A.ODR_NO = #{odrNo}
	</select>
	
	<select id = "selectShippingNoteItems"  parameterType = "serviceOrderParm" resultType = "serviceOrderItem">
		SELECT /*serviceOrder.selectShippingNoteItems*/
			SHIPG_NOTE_NO                                        AS CD,
			SHIPG_NOTE_NO                                        AS CDNM
		FROM TMT_SHIPG_NOTE S
		WHERE VSL_CALL_ID = #{vslCallId}
		AND S.CG_TP_CD NOT IN ('RCV','RMA')
	</select>
	
	<select id = "selectBLItems"  parameterType = "serviceOrderParm" resultType = "serviceOrderItem">
		SELECT /*serviceOrder.selectBLItems*/
			NVL(B.PARENT_ID, BL_NO)								AS CD,
			NVL(B.PARENT_ID, BL_NO)								AS CDNM
		FROM TMT_VSL_SCH A, TMT_BL B
		WHERE A.VSL_CALL_ID = #{vslCallId}
		AND A.VSL_CALL_ID = B.VSL_CALL_ID
		AND A.CALL_SEQ = B.CALL_SEQ
		AND A.CALL_YEAR = B.CALL_YEAR
		AND A.VSL_CD = B.VSL_CD
		AND B.CG_TP_CD NOT IN ('RCV','RMA')
	</select>
	
	<select id = "selectBLSNItems"  parameterType = "serviceOrderParm" resultType = "serviceOrderItem">
		SELECT /*serviceOrder.selectBLSNItems*/
			VSL_CALL_ID											AS VSLCALLID,
			BL_NO												AS BLSNNO
		FROM TMT_BL 
		WHERE PARENT_ID = #{blSNNo}
		AND CG_TP_CD = 'RBK'
		UNION ALL 
		SELECT     
			VSL_CALL_ID 										AS VSLCALLID,
			<!-- PARENT_ID											AS BLSNNO -->
			''													AS BLSNNO
		FROM TMT_SHIPG_NOTE
		WHERE SHIPG_NOTE_NO = #{blSNNo}
		AND CG_TP_CD = 'RBK'
	</select>
	
	<insert id="insertServiceOrderItem"  parameterType="serviceOrderItem">
		INSERT /*serviceOrder.insertServiceOrderItem*/
		INTO TMT_SVC_ODR(
			ODR_NO, CATEGORY1, CATEGORY2, CATEGORY3, SVC_DT_FMT, SVC_DT_TP,
			DT1_CHK, DT1_TIT, DT1_FMT, DT1_TP,
			DT2_CHK, DT2_TIT, DT2_FMT, DT2_TP, SHFT_CHK,
			UNIT_TIT, UNIT_UOM, UNIT_DEC,
			UNIT1_CHK, UNIT1_TIT, UNIT1_UOM, UNIT1_DEC,
			UNIT2_CHK, UNIT2_TIT, UNIT2_UOM, UNIT2_DEC,
			PAY_TP_CD, PRC_TP_CD, LOC_CHK, RMK_CHK, CMDTY_CHK,
			VSL_CALL_ID, PAYER, STAT_CD, CRT_BY, CRT_DT, SUMIT_BY, SUMIT_DT,
			SVC_DT_FM, SVC_DT_TO, DT1_FM, DT1_TO, DT2_FM, DT2_TO,
			SHFT_ID, UNIT, UNIT1, UNIT2, EQ_DIV_CD, CAPA_CD, LOC_ID, REQ_RMK, CMDTY_CD,
			OPE_CLASS_CD, REQ_DOC_NO, COM_DOC_NO, REQ_UNIT_NO, COM_UNIT_NO,
			UPDATE_TIME, STAFF_CD, VERSION, RMK
		) VALUES (
			#{odrNo}, #{category1}, #{category2}, #{category3}, #{svcDtFmt}, #{svcDtTp},
			#{dt1Chk},
	        DECODE(#{dt1Chk}, 'Y', #{dt1Tit}, NULL),
	        DECODE(#{dt1Chk}, 'Y', #{dt1Fmt}, NULL),
	        DECODE(#{dt1Chk}, 'Y', #{dt1Tp}, NULL),
			#{dt2Chk},
	        DECODE(#{dt1Chk}, 'Y', #{dt2Tit}, NULL),
	        DECODE(#{dt1Chk}, 'Y', #{dt2Fmt}, NULL),
	        DECODE(#{dt1Chk}, 'Y', #{dt2Tp}, NULL),
	        #{shftChk}, #{unitTit}, #{unitUom}, #{unitDec},
			#{unit1Chk},
			DECODE(#{unit1Chk}, 'Y', #{unit1Tit}, NULL),
			DECODE(#{unit1Chk}, 'Y', #{unit1Uom}, NULL),
			DECODE(#{unit1Chk}, 'Y', #{unit1Dec}, NULL),
			#{unit2Chk},
			DECODE(#{unit2Chk}, 'Y', #{unit2Tit}, NULL),
			DECODE(#{unit2Chk}, 'Y', #{unit2Uom}, NULL),
			DECODE(#{unit2Chk}, 'Y', #{unit2Dec}, NULL),
			#{payTpCd}, #{prcTpCd}, #{locChk}, #{rmkChk}, #{cmdtyChk},
			#{vslCallId}, #{payer}, #{statCd}, #{userId}, SYSDATE, #{userId}, SYSDATE,
			TO_DATE(#{svcDtFm}, 'DD/MM/YYYY HH24:MI'),
			DECODE(#{svcDtTp}, 'Y', TO_DATE(#{svcDtTo}, 'DD/MM/YYYY HH24:MI'), NULL),
			DECODE(#{dt1Chk}, 'Y', TO_DATE(#{dt1Fm}, 'DD/MM/YYYY HH24:MI'), NULL),
			DECODE(#{dt1Chk}, 'Y', DECODE(#{dt1Tp}, 'Y', TO_DATE(#{dt1To}, 'DD/MM/YYYY HH24:MI'), NULL), NULL),
			DECODE(#{dt2Chk}, 'Y', TO_DATE(#{dt2Fm}, 'DD/MM/YYYY HH24:MI'), NULL),
			DECODE(#{dt2Chk}, 'Y', DECODE(#{dt2Tp}, 'Y', TO_DATE(#{dt2To}, 'DD/MM/YYYY HH24:MI'), NULL), NULL),
			DECODE(#{shftChk}, 'Y', #{shftId}, NULL),
	        ${unit},
			DECODE(#{unit1Chk}, 'Y', ${unit1}, NULL),
			DECODE(#{unit2Chk}, 'Y', ${unit2}, NULL),
	        #{eqDivCd}, #{capaCd}, #{locId}, #{reqRmk}, #{cmdtyCd},
	        #{opeClassCd}, #{reqDocNo}, #{comDocNo}, #{reqUnitNo}, #{comUnitNo},
			SYSDATE, #{userId}, #{newVersion}, #{rmk}
		)
	</insert>
	
	<update id="updateServiceOrderItem"  parameterType="serviceOrderItem">
		UPDATE /*serviceOrder.updateServiceOrderItem*/
		TMT_SVC_ODR SET 
			STAT_CD = #{statCd},
			<if test="statCd == 'SU'">
				PAYER = #{payer},
				SVC_DT_FM = TO_DATE(#{svcDtFm}, 'DD/MM/YYYY HH24:MI'),
				SVC_DT_TO = TO_DATE(#{svcDtTo}, 'DD/MM/YYYY HH24:MI'),
				DT1_FM = TO_DATE(#{dt1Fm}, 'DD/MM/YYYY HH24:MI'),
				DT1_TO = TO_DATE(#{dt1To}, 'DD/MM/YYYY HH24:MI'),
				DT2_FM = TO_DATE(#{dt2Fm}, 'DD/MM/YYYY HH24:MI'),
				DT2_TO = TO_DATE(#{dt2To}, 'DD/MM/YYYY HH24:MI'),
				SHFT_ID = #{shftId},
				UNIT = #{unit},
				UNIT1 = #{unit1},
				UNIT2 = #{unit2},
				EQ_DIV_CD = #{eqDivCd},
				CAPA_CD = #{capaCd},
				LOC_ID = #{locId},
				REQ_RMK = #{reqRmk},
				CMDTY_CD = #{cmdtyCd},
				SUMIT_BY = #{userId},
				SUMIT_DT = SYSDATE,
			</if>
			<if test="statCd == 'CA'">
				CNCL_BY = #{userId},
				CNCL_DT = SYSDATE,
			</if>
			<if test="statCd == 'AP'">
				RMK = #{rmk},
				APPRV_BY = #{userId},
				APPRV_DT = SYSDATE,
			</if>
			<if test="statCd == 'RJ'">
				RMK = #{rmk},
				REJ_BY = #{userId},
				REJ_DT = SYSDATE,
			</if>
			<if test="statCd == 'CP'">
				COM_CHK = #{comChk},
				COM_SVC_DT_FM = TO_DATE(#{comSvcDtFm}, 'DD/MM/YYYY HH24:MI'),
				COM_SVC_DT_TO = TO_DATE(#{comSvcDtTo}, 'DD/MM/YYYY HH24:MI'),
				COM_DT1_FM = TO_DATE(#{comDt1Fm}, 'DD/MM/YYYY HH24:MI'),
				COM_DT1_TO = TO_DATE(#{comDt1To}, 'DD/MM/YYYY HH24:MI'),
				COM_DT2_FM = TO_DATE(#{comDt2Fm}, 'DD/MM/YYYY HH24:MI'),
				COM_DT2_TO = TO_DATE(#{comDt2To}, 'DD/MM/YYYY HH24:MI'),
				<if test="comShftId != null and comShftId != ''">
					COM_SHFT_ID = #{comShftId},
				</if>
				<if test="comShftId == null or comShftId == ''">
					<if test="comSvcDtFm != null and comSvcDtFm != ''">
						COM_SHFT_ID = F_GET_SHIFT_CD(TO_DATE(#{comSvcDtFm}, 'DD/MM/YYYY HH24:MI')),
					</if>
				</if>
				COM_UNIT = #{comUnit},
				COM_UNIT1 = #{comUnit1},
				COM_UNIT2 = #{comUnit2},
				COM_CAPA_CD = #{comCapaCd},
				COM_LOC_ID = #{comLocId},
				COM_RMK = #{comRmk},
				COM_BY = #{userId},
				COM_CMDTY_CD = #{comCmdtyCd},
				COM_DT = SYSDATE,
			</if>
			COM_DOC_NO= #{comDocNo},
			COM_UNIT_NO = #{comUnitNo},
			UPDATE_TIME = SYSDATE,
			STAFF_CD = #{userId},
			VERSION = #{newVersion}
		WHERE ODR_NO = #{odrNo}
	</update>

	<delete id="deleteServiceOrderItem"  parameterType="serviceOrderItem">
		DELETE FROM TMT_SVC_ODR /* ServiceOrder.xml  deleteServiceOrderItem  AD107 */
		 WHERE ODR_NO = #{odrNo}
	</delete>
	
</mapper>
